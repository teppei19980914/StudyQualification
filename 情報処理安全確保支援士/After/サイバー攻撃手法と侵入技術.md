# サイバー攻撃手法と侵入技術 ― 水飲み場型攻撃/コネクトバック通信/サイドチャネル攻撃/Pass-the-Hash/Adversarial Examplesの体系的整理

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年秋の情報処理安全確保支援士に向けて勉強中です。
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。
**本記事は学習した内容を記載しています。**

## 該当問題

[情報セキュリティスペシャリスト平成24年春期 午前Ⅱ 問8](https://www.sc-siken.com/kakomon/24_haru/am2_8.html)
[情報セキュリティスペシャリスト平成25年春期 午前Ⅱ 問5](https://www.sc-siken.com/kakomon/25_haru/am2_5.html)
[情報セキュリティスペシャリスト平成27年秋期 午前Ⅱ 問8](https://www.sc-siken.com/kakomon/27_aki/am2_8.html)
[情報処理安全確保支援士令和2年秋期 午前Ⅱ 問4](https://www.sc-siken.com/kakomon/02_aki/am2_4.html)
[情報処理安全確保支援士令和3年秋期 午前Ⅱ 問1](https://www.sc-siken.com/kakomon/03_aki/am2_1.html)
[情報処理安全確保支援士令和5年春期 午前Ⅱ 問2](https://www.sc-siken.com/kakomon/05_haru/am2_2.html)
[情報処理安全確保支援士令和5年秋期 午前Ⅱ 問12](https://www.sc-siken.com/kakomon/05_aki/am2_12.html)
[情報処理安全確保支援士令和7年春期 午前Ⅱ 問8](https://www.sc-siken.com/kakomon/07_haru/am2_8.html)

## サイバー攻撃の全体像

ネットワークや情報システムに対して不正な行為を行い、情報のCIA(機密性・完全性・可用性)を損なう行為の総称です。

### サイバー攻撃の分類

IPAは、サイバー攻撃を大きく次の4分類で把握していることを求めます。

1. 初期侵入系
2. 内部活動
3. 目的達成
4. 持続性確保

#### 初期侵入系

攻撃の最初の入り口に使われる手法です。

1. マルウェア配布(ウィルス・トロイ・ランサムウェア)
2. フィッシング/スピアフィッシング
3. 脆弱性攻撃(SQLi, XSS, RCE, Log4Shell など)
4. パスワード攻撃(辞書攻撃・総当たり)
5. 不正な外部デバイス(USB等)

#### 内部活動

侵入後に攻撃者が行う行為のことです。

1. バックドア設置(コネクトバック通信など)
2. 権限昇格(Privilege Escalation)
3. 内部スキャン(他ホストを調査)
4. ラテラルムーブメント(横展開)
5. ログ消去・痕跡隠蔽(Timestomping など)

#### 目的達成

侵入によって達成しようとする主目的です。

1. 情報窃取(個人情報・顧客情報・機密データ)
2. 改ざん(Web改ざん・設定ファイル改ざん)
3. 破壊(ランサムウェア暗号化)
4. サービス妨害(DDoS)
5. 金銭要求(身代金要求)

#### 持続性確保

長期間にわたり内部に潜伏するための活動です。

1. C&Cサーバとの継続通信(コネクトバック/Beaconing)
2. タスク登録・レジストリ改変による永続化
3. 更新機能付きマルウェア

### サイバーキルチェーン(ライフサイクル)

1. 偵察(Reconnaissance)
2. 武器化(Weaponization)
3. 配送(Delivery)
4. 悪用(Exploitation)/インストール(Installation)
5. C&C通信(Command & Control) -- コネクトバックはこの段階
6. 目的実行(Actions on Objectives)

## 水飲み場型攻撃(Watering Hole Attack)

### 定義

水飲み場型攻撃とは、**攻撃者がターゲット組織のユーザが日常的に利用している Web サイトを侵害し、その利用を通じてマルウェア感染させる攻撃手法**です。

名前の由来：

- 野生動物が水飲み場に集まる習性を利用するように、"ターゲットが訪れると分かっている場所(サイト)"に罠を仕掛けることに由来しています。

### 攻撃の流れ(MITRE ATT&CK: T1189)

1. 攻撃者が標的企業の社員がよくアクセスするサイトを調査
2. その Web サイトに対して脆弱性攻撃やパスワード窃取により改ざん
3. 改ざんページにマルウェア配布スクリプトを設置
4. 標的企業のユーザがそのサイトにアクセス
5. ブラウザやプラグインの脆弱性を悪用し感染
6. 攻撃者が内部ネットワーク侵害へと横展開(Lateral Movement)

### 水飲み場型攻撃の特徴

- **標的型(Targeted Attack)である**
- メールではなく Web 経由で感染
- 社外の Web サイトが攻撃点となる
- 感染に気付きにくい
- APT 攻撃(高度持続的攻撃)の一部として利用されやすい

### 具体的な攻撃例(実在の事例)

- 国内外の政府機関サイト改ざんによる標的型攻撃
- ソフトウェア企業のサイトに不正 iframe を埋め込み感染
- ゼロデイ脆弱性を使った攻撃が高頻度で利用

APT 攻撃グループ(例：APT10, Lazarus)がよく使用します。

### 対策(IPA/NIST SP800-30)

#### Web ブラウザ側の対策

- ブラウザ/プラグインを最新に保つ
- Flash や Java を無効化
- URL フィルタリング(不正サイト遮断)
- スクリプト制御(NoScript 等)
- サンドボックス実行(Chrome/Edge)

#### 組織側の対策

- EDR(Endpoint Detection & Response)
- Proxy での不正通信検知
- 社員のアクセス先ドメイン監査
- 改ざんサイトが判明した場合の迅速なブロック

#### Web サイト運営側の対策

- CMS(WordPress など)の脆弱性対策
- パスワード強化/多要素認証
- Web サーバの脆弱性管理
- 改ざん検知ツール(WAF, Integrity Monitor)

## ドライブバイダウンロード(Drive-by Download)

### 定義(OWASP)

ドライブバイダウンロードとは、利用者が Web サイトを閲覧しただけで、**意図せずマルウェアがダウンロード/実行される攻撃**です。
ユーザ操作(クリック/保存)を必要としない点が特徴です。

### 典型的な攻撃手法

- ブラウザの脆弱性(Chrome/IE/Firefox)
- プラグインの脆弱性(Flash, Java, Silverlight)
- アドネットワーク経由の悪性広告(Malvertising)
- スクリプトによる exploit kit 呼び出し

### 代表的な Exploit Kit

| Exploit Kit | 特徴 |
|--------------|------|
| Angler EK | Flash/IE 脆弱性を攻撃、最盛期に流行 |
| Nuclear EK | 暗号化通信により検知困難 |
| Blackhole EK | 初期の大規模攻撃ツール |

### 水飲み場攻撃とドライブバイダウンロードの関係

水飲み場型攻撃の改ざんサイトではしばしば**ドライブバイダウンロードが仕掛けられています。**
すなわち、下記のような関係が成り立ちます。

- 水飲み場型攻撃 = 侵害された信頼サイトで待ち伏せ
- ドライブバイダウンロード = 感染手口

### 周辺知識

#### APT(Advanced Persistent Threat)

標的型攻撃の総称です。長期間/継続的な侵害活動を行います。

#### マルウェア配布の手口

- マルバタイジング(Malvertising)
- Fake Update(偽更新)
- ソーシャルエンジニアリングによる誘導

#### ゼロデイ攻撃

未知の脆弱性が使われるため、防御が困難です。

## コネクトバック通信

マルウェアに感染した内部ネットワークの端末などが、自ら外部の攻撃者のサーバに接続する通信方式です。
「リバースシェル」や「リバースコネクション」とも呼ばれます。

### 特徴

通常、企業ネットワークでは下記のようなFWが設定されています。

- 外部 → 内部(インバウンド通信)：原則ブロック
- 内部 → 外部(アウトバウンド通信)：業務で必要となるため許可

上記の構成は、外部からの不正アクセスを防ぐことを目的とした境界防御の基本です。
しかし、コネクトバックは内部から外部の攻撃者サーバにアクセスするため、こうした境界防御をすり抜けてしまうという大きな強みがあります。

したがって、**そもそもマルウェアに感染しない**ことを前提に、*EDR(Endpoint Detection and Response)* を前提とする必要があります。

### 周辺知識

|用語|内容|
|:----|:----|
|C&Cサーバ(Command & Control)|攻撃者が遠隔操作するための司令室|
|Beaconing(ビーコン通信)|一定間隔で攻撃者に"生存報告"を送る仕組み(高度なAPT攻撃で多用)|
|ゼロトラスト|「内部は安全」という前提を破壊する思想|
|暗号化されたコネクトバック(HTTPS/DoH)|通信が暗号化されていることで、解析が困難となり、IDS/IPSで内容確認ができない|
|EDR (Endpoint Detection and Response)|各エンドポイント (PC、サーバ等) の挙動を監視|
|ネットワークセグメンテーション|内部ネットワークを複数の論理/物理セグメントに分割|
|プロキシサーバ/Firewall|アウトバウンドを含めた通信の入り口に設置し、不要通信を制限・ログ取得|
|ラテラルムーブメント|一台の侵害からネットワーク内部を横展開し、他ホストやサーバを次々に侵害する動き|

## サイドチャネル攻撃(Side-Channel Attack)

### 定義

サイドチャネル攻撃とは、**暗号アルゴリズムそのものではなく、実装が漏らす物理的特徴を観測して秘密情報を推定する攻撃です**。

使用されるサイドチャネル例：

- **処理時間(Timing)**
- **電力消費(Power Consumption)**
- **電磁放射(EM Emission)**
- **キャッシュ動作(Cache Access/Branch Prediction)**
- **音響ノイズ(Acoustic)**
- **温度変化**
- **DRAM残留(Cold Boot Attack)**

暗号理論が安全でも、**実装が情報漏洩を起こす**と攻撃が成立してしまいます。

### タイミング攻撃(Timing Attack)

タイミング攻撃は、処理の実行時間の差から秘密情報(特に秘密鍵)を推定する手法です。

#### 典型的な例：RSA の平方式処理

RSA の `square-and-multiply`(平方/乗算)処理は、秘密鍵のビットに応じて計算手順が変化します。

- 0ビット → square のみ
- 1ビット → square + multiply

この違いが **実行時間差として観測可能** になり、攻撃者は距離が離れたネットワーク越しでも鍵を推定できるケースがあります。

**実際に Kocher(1996)が RSA の秘密鍵の抽出に成功した歴史的攻撃です。**

### 電力解析(Power Analysis Attack)

#### SPA(Simple Power Analysis)

電力波形の形状から処理分岐を読み取ります。

#### DPA(Differential Power Analysis)

統計解析を駆使し微弱な電力差から秘密鍵を抽出します。
**実世界のICカード攻撃で最も実用的です。**

### 電磁波解析(EMA)

チップの処理に伴う電磁放射を専用センサで受信し、内部状態を再構築します。

### キャッシュ攻撃(Cache Side-Channel)

CPUキャッシュの「ヒット/ミス」による時間差を利用します。

- AES の S-box 参照時間から鍵推定
- Spectre/Meltdown 系の投機実行攻撃
- Flush+Reload/Prime+Probe など有名手法が多数

### 音響攻撃(Acoustic Cryptanalysis)

RSA 計算中の CPU コイルの音を分析し秘密鍵を復元します。

### Cold Boot Attack

DRAM は電源断後も数秒〜数分残留します。
冷却すると残留時間が伸び、鍵情報が読み取られます。

### タイミング攻撃の対策

タイミング攻撃防止はサイドチャネル対策の中核です。

#### 定数時間実装(Constant-Time Implementation)

処理時間が秘密情報に依存しないよう設計します。

例：

- `if (bit == 1)` といった条件分岐を排除
- テーブル参照(S-boxなど)を同一パターンに固定
- RSA の「恒等時間モンゴメリ乗算」
- ECDH の「Montgomery Ladder」(RFC 7748)

RFC 7748(X25519/X448)は定数時間実装を強制する仕様です。

#### ランダム化(Blinding/Randomization)

##### RSA Blinding

RSA の演算にランダム値を掛けて処理分岐の揺らぎを吸収します。

##### ECC Blinding

楕円曲線スカラー値に乱数を加えます。
ランダム性により処理時間の相関を破壊します。

#### ノイズ付加(Noise Injection)

電力消費、時間、EMリークに揺らぎを加え、統計解析を困難にします。

#### キャッシュ対策

- キャッシュを使わない計算パターン
- キャッシュラインの分離
- Speculative Execution の制御(Spectre対策)
- Kernel Page Table Isolation(Meltdown対策)

#### 物理的対策(FIPS 140-3 HSM要件)

- 電磁シールド
- 電力線ノイズ吸収
- タンパーレジスタント筐体
- 不正開封検知
- 鍵削除機能

政府利用機関向けモジュールは FIPS 140-3 認証が必須です。

### FIPS(Federal Information Processing Standards)

NISTが制定しているアメリカ合衆国の情報処理標準規格群です。
領域ごとに様々なセキュリティ対策基準が規定されています。

### その他の「暗号を破る」攻撃手法(体系整理)

#### 計算量ベースの攻撃

- ブルートフォース
- 辞書攻撃
- レインボーテーブル

#### 通信経路攻撃

- MITM攻撃
- リプレイ攻撃
- ダウングレード攻撃(SSL 3.0/TLS1.0強制)

#### プロトコル攻撃

- パディングオラクル攻撃
- BLEICHENBACHER攻撃(PKCS#1 v1.5)
- Lucky13(CBC)

#### 実装攻撃(Implementation Attacks)

- サイドチャネル攻撃(Timing/Power/Cache...)
- フォールト攻撃(Fault Injection)
- グリッチ攻撃(電圧/クロック異常注入)

### フォールト攻撃との違い

#### サイドチャネル攻撃

**観測** による解析をします。

#### フォールト攻撃

**故意にエラーを発生させ、その結果から鍵を推定します。**

例：

RSA CRT をエラー化し "Bellcore Attack" で秘密鍵を流出させます。

## Pass-the-Hash(PtH)攻撃とWindows NTLM認証

### 定義

Pass-the-Hash(PtH)攻撃とは、**Windowsが内部で保持する"パスワードハッシュ(NTLMハッシュ)"を盗み、そのまま認証に利用してログインする攻撃**です。

### 重要ポイント

- ハッシュ = "パスワードの代わり"として機能する
- パスワードの平文を知らなくても認証可能
- 横移動(Lateral Movement)攻撃の中心的手法
- 権限昇格/ドメイン制圧に直結する

### NTLM(New Technology LAN Manager)認証

Windows が提供するチャレンジレスポンス方式の認証プロトコルです。
現在の標準は **Kerberos** だが、互換性のため **NTLM も残存しています**。

#### NTLM の種類

- **NTLMv1**：DES ベースのチャレンジレスポンス計算と LM Hash を使用する弱い方式 → **利用非推奨**
- **NTLMv2**：HMAC-MD5 を利用した強化版(ただし PtH は防げない)

#### NTLM 認証(チャレンジレスポンス方式)

パスワード本体が送られない利点があるが**盗んだハッシュ値を使えば本人になりすますことが可能**という致命的弱点があります。

1. クライアントがログイン要求
2. サーバがチャレンジ値を送信
3. クライアントは **パスワード→NTLMハッシュ** を使い応答を生成
4. サーバ側に登録されたハッシュで検証

### Pass-the-Hash攻撃の仕組みと手順

#### 手順1：NTLMハッシュの取得

Windows の **LSASS(Local Security Authority Subsystem Service)** から資格情報を抽出します。

主なツール：

- **Mimikatz(最も有名)**
- Invoke-Mimikatz(PowerShell版)
- Metasploit(hashdump モジュール)

LSASS が保持しているもの：

- NTLM ハッシュ
- Kerberos TGT/TGS チケット
- LSA Secrets(サービスアカウント情報など)

#### 手順2：ハッシュをそのまま認証に使用

**平文パスワードが不要で認証可能です。**

例：PsExec をハッシュで実行
```
PsExec.exe \TARGET cmd.exe -u user -H <NTLMハッシュ>
```

#### 手順3：横移動(Lateral Movement)

取得した資格情報を使い、ネットワーク内の他端末へ侵入します。
最終的には **ドメインコントローラ(DC)奪取** を狙うのが典型的攻撃シナリオです。

横移動手法：

- SMB(C$/ADMIN$)
- WinRM
- WMI
- RDP

### NTLM が PtH に弱い理由(設計上の問題)

- NTLM は「パスワード」ではなく「パスワードハッシュ」を認証に使用
- **ハッシュを知っている = パスワードを知っているに等しい**
- セッションキー生成にもハッシュを使用
- Kerberos のような"チケット署名検証"の仕組みが弱い

そのため、**1 回でも侵害されると横移動が容易になります**。

### PtH 攻撃の有効な対策(Microsoft 推奨)

#### Credential Guard(Windows 10+)

VBS(仮想化基盤)により LSASS を隔離して資格情報窃取を防止します。
これは、**最も強力な防御策**です。

#### LAPS(Local Administrator Password Solution)

- PCごとに異なるローカル管理者パスワードを自動で設定
- 横移動耐性が大幅に向上
- ドメイン管理のベストプラクティス

#### 管理者アカウントの分離

- 日常操作用アカウントと特権管理用アカウントを分ける
- 特権アカウントでのログオンを最小化する

#### NTLM の無効化(Kerberos の強制)

- グループポリシーで NTLM 認証を拒否
- SMB サインを必須化
- 既存システムの互換性要検討

#### LSASS プロセス保護(RunAsPPL)

LSASS への不正読取を防止：
```
HKLM\SYSTEM\CurrentControlSet\Control\Lsa
"RunAsPPL"=dword:00000001
```

#### SMBv1 の無効化

EternalBlue 系脆弱性の悪用防止にも有効です。

### Windows 認証の比較(NTLM vs Kerberos)

| 項目 | NTLM | Kerberos |
|------|------|----------|
| 認証方式 | チャレンジレスポンス | チケット(KDC)方式 |
| 弱点 | Pass-the-Hash | Pass-the-Ticket(TGT/TGS) |
| セキュリティ強度 | 中 | 高 |
| 推奨度 | 互換性目的 | **Windowsドメインの標準方式** |

### MITRE ATT&CK との対応

| 攻撃技術 | ID | 内容 |
|----------|------|---------|
| Credential Dumping | T1003 | LSASS から資格情報を抽出 |
| Pass-the-Hash | **T1550.002** | ハッシュを使った認証なりすまし |
| Pass-the-Ticket | T1550.003 | Kerberos チケット悪用 |

### 周辺知識

#### SAM(Security Accounts Manager)

ローカル資格情報の保存場所です。
SAMデータベースも Mimikatz の標的になります。

#### Kerberos のチケット盗難(Pass-the-Ticket)

PtH の兄弟攻撃です。
TGT/TGS を盗んで成りすましを行います。

#### Protected Users グループ

- NTLM を禁止
- 資格情報キャッシュ無効
- 高セキュリティ運用向き

#### SMB サイン(Message Signing)

中間者攻撃を防止します。
NTLM 環境でも有効です。

## AIによる画像認識と Adversarial Examples 攻撃(敵対的サンプル攻撃)

### AIによる画像認識の基礎

#### 画像認識とは

画像認識とは、**画像データを入力として、物体/人物/特徴を自動的に識別/分類する技術**のことです。
代表的な応用例：

- 顔認証
- 自動運転(歩行者/信号認識)
- 医療画像診断
- 監視カメラ解析

#### 技術的背景

現代の画像認識は主に以下を用います。

- 深層学習(Deep Learning)
- 畳み込みニューラルネットワーク(CNN)

##### CNNの特徴

- 画像の「局所的特徴(エッジ/模様)」を学習
- 層を重ねることで高次特徴を抽出
- 人間の視覚に近い処理構造

#### 学習と推論

| フェーズ | 内容 |
|---|---|
| 学習 | 大量の正解付き画像からパターンを学習 |
| 推論 | 未知の画像を入力し、分類結果を出力 |

**推論時の入力は「完全に信用されている」前提**で設計されています。

### Adversarial Examples(敵対的サンプル)とは

#### 定義

**Adversarial Example** とは、人間にはほぼ同じ画像に見えますが、AIには誤認識を引き起こすよう細工された入力データを指します。

代表的根拠：

- Szegedy et al., 2013
- NIST IR 8269(AI Security)

#### 攻撃の本質

- ピクセル値を**極めて微小に改変**
- 人間の視覚では識別困難
- AIの分類結果が大きく変化

例：

- パンダ → 人間にはパンダ
- AI → テナガザルと誤認識

### なぜAIはだまされるのか

#### 高次元空間の問題

画像は以下の特徴を持ちます。

- 数万〜数百万次元のデータ
- 人間の感覚とは異なる距離尺度

**人間にとって微差でも、AIにとっては決定的差分になります。**

#### 線形近似の弱点

深層学習モデルは、局所的には線形近似として振る舞います。

- 勾配方向にノイズを加える
- 出力が大きく変化

これを悪用したのが敵対的サンプル攻撃です。

### Adversarial Examples 攻撃の手法

#### FGSM(Fast Gradient Sign Method)

- 勾配の符号方向に微小ノイズを付加
- 高速/簡易な攻撃

#### Iterative Attack

- FGSMを反復適用
- 精度は高いが計算量増加

#### Physical Adversarial Attack

- 実世界で成立する攻撃
- 標識に細工することで自動運転が誤認識

**サイバー空間に限定されない点が重要です。**

### AI特有の攻撃手法(周辺知識)

#### データポイズニング攻撃

- 学習データに不正データを混入
- モデル自体を歪める

#### モデル反転攻撃(Model Inversion)

- 出力結果から学習データを推測
- 個人情報漏えいリスク

#### モデル抽出攻撃(Model Extraction)

- API応答を大量取得
- 内部モデルを再現

### 対策技術

#### Adversarial Training

- 敵対的サンプルを含めて学習
- 一定の耐性を獲得

#### 入力検証/異常検知

- ノイズ特性の分析
- 信頼度スコアの導入

#### 多層防御の必要性

- AI単体に依存しない
- 人的確認/ルールベース併用

### 従来のセキュリティ攻撃との違い

| 観点 | 従来攻撃 | Adversarial 攻撃 |
|---|---|---|
| 攻撃対象 | OS/アプリ | 学習モデル |
| 攻撃手段 | コード/通信 | 入力データ |
| 可視性 | 比較的明確 | 人間には不可視 |
