# サイバー攻撃手法と侵入技術 ― 水飲み場型攻撃/コネクトバック通信/サイドチャネル攻撃/Pass-the-Hash/Adversarial Examplesの体系的整理

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年秋の情報処理安全確保支援士に向けて勉強中です。
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/a25279a17b210d6ed9f4)」をご参照ください。
**本記事は学習した内容を記載しています。**

## 該当問題

[情報セキュリティスペシャリスト平成24年春期 午前Ⅱ 問8](https://www.sc-siken.com/kakomon/24_haru/am2_8.html)
[情報セキュリティスペシャリスト平成25年春期 午前Ⅱ 問5](https://www.sc-siken.com/kakomon/25_haru/am2_5.html)
[情報セキュリティスペシャリスト平成27年秋期 午前Ⅱ 問8](https://www.sc-siken.com/kakomon/27_aki/am2_8.html)
[情報処理安全確保支援士令和2年秋期 午前Ⅱ 問4](https://www.sc-siken.com/kakomon/02_aki/am2_4.html)
[情報処理安全確保支援士令和3年秋期 午前Ⅱ 問1](https://www.sc-siken.com/kakomon/03_aki/am2_1.html)
[情報処理安全確保支援士令和5年春期 午前Ⅱ 問2](https://www.sc-siken.com/kakomon/05_haru/am2_2.html)
[情報処理安全確保支援士令和5年秋期 午前Ⅱ 問12](https://www.sc-siken.com/kakomon/05_aki/am2_12.html)
[情報処理安全確保支援士令和7年春期 午前Ⅱ 問8](https://www.sc-siken.com/kakomon/07_haru/am2_8.html)

## サイバー攻撃の全体像

ネットワークや情報システムに対して不正な行為を行い、情報のCIA(機密性・完全性・可用性)を損なう行為の総称です。

### サイバー攻撃の分類

IPAは、サイバー攻撃を大きく次の4分類で把握していることを求めます。

1. 初期侵入系
2. 内部活動
3. 目的達成
4. 持続性確保

#### 初期侵入系

攻撃の最初の入り口に使われる手法です。

1. マルウェア配布(ウィルス・トロイ・ランサムウェア)
2. フィッシング/スピアフィッシング
3. 脆弱性攻撃(SQLi, XSS, RCE, Log4Shell など)
4. パスワード攻撃(辞書攻撃・総当たり)
5. 不正な外部デバイス(USB等)

#### 内部活動

侵入後に攻撃者が行う行為のことです。

1. バックドア設置(コネクトバック通信など)
2. 権限昇格(Privilege Escalation)
3. 内部スキャン(他ホストを調査)
4. ラテラルムーブメント(横展開)
5. ログ消去・痕跡隠蔽(Timestomping など)

#### 目的達成

侵入によって達成しようとする主目的です。

1. 情報窃取(個人情報・顧客情報・機密データ)
2. 改ざん(Web改ざん・設定ファイル改ざん)
3. 破壊(ランサムウェア暗号化)
4. サービス妨害(DDoS)
5. 金銭要求(身代金要求)

#### 持続性確保

長期間にわたり内部に潜伏するための活動です。

1. C&Cサーバとの継続通信(コネクトバック/Beaconing)
2. タスク登録・レジストリ改変による永続化
3. 更新機能付きマルウェア

### サイバーキルチェーン(ライフサイクル)

1. 偵察(Reconnaissance)
2. 武器化(Weaponization)
3. 配送(Delivery)
4. 悪用(Exploitation)/インストール(Installation)
5. C&C通信(Command & Control) -- コネクトバックはこの段階
6. 目的実行(Actions on Objectives)

## 水飲み場型攻撃(Watering Hole Attack)

### 定義

水飲み場型攻撃とは、**攻撃者がターゲット組織のユーザが日常的に利用している Web サイトを侵害し、その利用を通じてマルウェア感染させる攻撃手法**です。

名前の由来：

- 野生動物が水飲み場に集まる習性を利用するように、"ターゲットが訪れると分かっている場所(サイト)"に罠を仕掛けることに由来しています。

### 攻撃の流れ(MITRE ATT&CK: T1189)

1. 攻撃者が標的企業の社員がよくアクセスするサイトを調査
2. その Web サイトに対して脆弱性攻撃やパスワード窃取により改ざん
3. 改ざんページにマルウェア配布スクリプトを設置
4. 標的企業のユーザがそのサイトにアクセス
5. ブラウザやプラグインの脆弱性を悪用し感染
6. 攻撃者が内部ネットワーク侵害へと横展開(Lateral Movement)

### 水飲み場型攻撃の特徴

- **標的型(Targeted Attack)である**
- メールではなく Web 経由で感染
- 社外の Web サイトが攻撃点となる
- 感染に気付きにくい
- APT 攻撃(高度持続的攻撃)の一部として利用されやすい

### 具体的な攻撃例(実在の事例)

- 国内外の政府機関サイト改ざんによる標的型攻撃
- ソフトウェア企業のサイトに不正 iframe を埋め込み感染
- ゼロデイ脆弱性を使った攻撃が高頻度で利用

APT 攻撃グループ(例：APT10, Lazarus)がよく使用します。

### 対策(IPA/NIST SP800-30)

#### Web ブラウザ側の対策

- ブラウザ/プラグインを最新に保つ
- Flash や Java を無効化
- URL フィルタリング(不正サイト遮断)
- スクリプト制御(NoScript 等)
- サンドボックス実行(Chrome/Edge)

#### 組織側の対策

- EDR(Endpoint Detection & Response)
- Proxy での不正通信検知
- 社員のアクセス先ドメイン監査
- 改ざんサイトが判明した場合の迅速なブロック

#### Web サイト運営側の対策

- CMS(WordPress など)の脆弱性対策
- パスワード強化/多要素認証
- Web サーバの脆弱性管理
- 改ざん検知ツール(WAF, Integrity Monitor)

## ドライブバイダウンロード(Drive-by Download)

### 定義(OWASP)

ドライブバイダウンロードとは、利用者が Web サイトを閲覧しただけで、**意図せずマルウェアがダウンロード/実行される攻撃**です。
ユーザ操作(クリック/保存)を必要としない点が特徴です。

### 典型的な攻撃手法

- ブラウザの脆弱性(Chrome/IE/Firefox)
- プラグインの脆弱性(Flash, Java, Silverlight)
- アドネットワーク経由の悪性広告(Malvertising)
- スクリプトによる exploit kit 呼び出し

### 代表的な Exploit Kit

| Exploit Kit | 特徴 |
|--------------|------|
| Angler EK | Flash/IE 脆弱性を攻撃、最盛期に流行 |
| Nuclear EK | 暗号化通信により検知困難 |
| Blackhole EK | 初期の大規模攻撃ツール |

### 水飲み場攻撃とドライブバイダウンロードの関係

水飲み場型攻撃の改ざんサイトではしばしば**ドライブバイダウンロードが仕掛けられています。**
すなわち、下記のような関係が成り立ちます。

- 水飲み場型攻撃 = 侵害された信頼サイトで待ち伏せ
- ドライブバイダウンロード = 感染手口

### 周辺知識

#### APT(Advanced Persistent Threat)

標的型攻撃の総称です。長期間/継続的な侵害活動を行います。

#### マルウェア配布の手口

- マルバタイジング(Malvertising)
- Fake Update(偽更新)
- ソーシャルエンジニアリングによる誘導

#### ゼロデイ攻撃

未知の脆弱性が使われるため、防御が困難です。

## ソーシャルエンジニアリング(Social Engineering)

### 定義

ソーシャルエンジニアリングとは、**技術的手段ではなく、人間の心理的な弱さ(信頼・恐怖・権威・緊急性等)を悪用して機密情報を取得する攻撃手法**です。

> 試験では「技術的な脆弱性ではなく**人的な脆弱性**を突く攻撃」として出題されます。

### 代表的な手法(試験頻出)

| 手法 | 説明 |
|---|---|
| **フィッシング(Phishing)** | 正規サービスを装った偽メール/偽サイトで認証情報等を詐取 |
| **スピアフィッシング(Spear Phishing)** | 特定の個人・組織を狙った標的型フィッシング |
| **ホエーリング(Whaling)** | 経営層・役員を標的としたスピアフィッシング |
| **スミッシング(Smishing)** | SMS を利用したフィッシング |
| **ビッシング(Vishing)** | 電話(Voice)を利用したフィッシング |
| **プリテキスティング(Pretexting)** | 偽の身分・口実を用いて情報を聞き出す(IT部門を装う等) |
| **テールゲーティング/ピギーバック** | 正規入室者の後に続いて入室する物理的侵入 |
| **ショルダーハッキング** | 背後からのぞき見してパスワード等を窃取 |
| **トラッシング(ダンプスターダイビング)** | ゴミ箱から機密文書やメモを拾い出す |

### ビジネスメール詐欺(BEC：Business Email Compromise)

ソーシャルエンジニアリングの中でも特に **金銭被害が大きい** 攻撃です。

| 項目 | 内容 |
|---|---|
| 手法 | 経営者・取引先を装ったメールで送金指示 |
| 特徴 | マルウェアを使わず、**人間の判断ミス**を誘う |
| 被害例 | 偽の振込先への送金、請求書の差し替え |
| 対策 | 送金時の電話確認、承認フローの多段化、DMARC/SPF/DKIM によるメール認証 |

### ソーシャルエンジニアリングへの対策

| 対策 | 内容 |
|---|---|
| **セキュリティ教育・訓練** | 標的型メール訓練、フィッシング対応演習 |
| **物理的セキュリティ** | 入退室管理、クリアデスクポリシー、シュレッダー利用 |
| **多要素認証(MFA)** | パスワード漏洩時の被害を限定 |
| **メール認証技術** | SPF/DKIM/DMARC の導入 |
| **インシデント報告体制** | 不審メールの報告窓口を整備 |

## マルウェアの分類と特徴

### 定義

マルウェア(Malware)とは、**悪意のある動作を行うソフトウェアの総称**です。
Malicious + Software = Malware

### マルウェアの種類(試験頻出)

| 種類 | 特徴 | 自己増殖 | 宿主の要否 |
|---|---|---|---|
| **ウイルス(Virus)** | 他のプログラムに寄生して感染を広げる | あり | **必要** |
| **ワーム(Worm)** | 単独で自己増殖し、ネットワーク経由で拡散 | あり | 不要 |
| **トロイの木馬(Trojan Horse)** | 正規ソフトを装い、裏で不正動作を行う | **なし** | 不要 |
| **ランサムウェア(Ransomware)** | データを暗号化し、復号と引き換えに身代金を要求 | 種類による | 不要 |
| **スパイウェア(Spyware)** | ユーザの行動を密かに監視し、情報を外部送信 | なし | 不要 |
| **アドウェア(Adware)** | 不要な広告を表示、情報収集を行う場合もある | なし | 不要 |
| **キーロガー(Keylogger)** | キーボード入力を記録して窃取 | なし | 不要 |
| **ルートキット(Rootkit)** | OS深部に潜伏し、自身や他のマルウェアの存在を隠蔽 | なし | 不要 |
| **ボット/ボットネット** | C&Cサーバからの指令で遠隔操作される(DDoS等に利用) | 種類による | 不要 |
| **RAT(Remote Access Trojan)** | 遠隔操作機能を持つトロイの木馬 | なし | 不要 |

> 試験では **「ウイルス=宿主が必要で自己増殖」「ワーム=単独で自己増殖」「トロイの木馬=自己増殖しない」** の区別が頻出です。

### 近年の重要なマルウェア

#### ファイルレスマルウェア(Fileless Malware)

- ディスクにファイルを保存せず、**メモリ上のみで動作**
- PowerShell、WMI、.NET Framework 等の正規ツールを悪用(Living off the Land)
- ファイルベースのウイルス対策ソフトでは**検知が困難**
- 対策：**EDR** によるプロセス挙動監視、PowerShell ログの有効化

#### Emotet

- 当初はバンキングトロジャンとして登場
- **他のマルウェアの配布基盤(ドロッパー/ローダー)** として進化
- マクロ付きWord文書をメール添付して拡散
- 感染後にTrickBot、Ryukランサムウェア等を追加ダウンロード
- 対策：マクロの無効化、メールフィルタリング、EDR

### マルウェアの機能別分類

| 機能 | 説明 | 具体例 |
|---|---|---|
| **ドロッパー(Dropper)** | 内蔵した別のマルウェアを展開・実行 | Emotet |
| **ダウンローダー(Downloader)** | 外部サーバから追加のマルウェアをダウンロード | TrickBot |
| **バックドア(Backdoor)** | 正規の認証をバイパスする裏口を設置 | RAT各種 |
| **エクスプロイト(Exploit)** | 脆弱性を悪用するコード | EternalBlue |
| **ワイパー(Wiper)** | データを破壊・消去する(身代金要求なし) | NotPetya |

## パスワード攻撃

### パスワード攻撃の分類(試験頻出)

| 攻撃手法 | 説明 | オンライン/オフライン |
|---|---|---|
| **ブルートフォース攻撃(総当たり)** | 全ての文字列の組み合わせを試行 | 両方 |
| **辞書攻撃(Dictionary Attack)** | よく使われるパスワードのリストを試行 | 両方 |
| **パスワードリスト攻撃** | **他サイトから漏洩したID/パスワードの組を別サイトに試行** | オンライン |
| **パスワードスプレー攻撃** | **多数のアカウントに対し少数のパスワードを試行**(ロックアウト回避) | オンライン |
| **クレデンシャルスタッフィング** | 漏洩した大量の認証情報を自動化ツールで一括試行 | オンライン |
| **レインボーテーブル攻撃** | ハッシュ値から元のパスワードを逆引きする事前計算テーブル | オフライン |
| **リバースブルートフォース攻撃** | **1つのパスワードに対し多数のIDを試行**(ロックアウト回避) | オンライン |

> **パスワードリスト攻撃**は「パスワードの使い回し」を悪用する攻撃であり、試験で非常に頻出です。

### オンライン攻撃 vs オフライン攻撃

| 比較項目 | オンライン攻撃 | オフライン攻撃 |
|---|---|---|
| 攻撃対象 | ログインフォーム等の認証インタフェース | 窃取したパスワードハッシュファイル |
| 速度 | 遅い(ネットワーク通信が必要) | 高速(ローカルで計算) |
| 検知 | ログ監視で検知可能 | 検知困難 |
| 対策 | アカウントロックアウト、CAPTCHA、レート制限 | ソルト付きハッシュ、ストレッチング |

### パスワード攻撃への対策

| 対策 | 効果 |
|---|---|
| **ソルト(Salt)** | レインボーテーブル攻撃の無効化(ハッシュ前にランダム値を付加) |
| **ストレッチング** | ハッシュ計算を意図的に反復し、オフライン攻撃を低速化(bcrypt, scrypt, Argon2) |
| **アカウントロックアウト** | 一定回数の失敗でアカウントをロック(ブルートフォース対策) |
| **多要素認証(MFA)** | パスワード漏洩時でも不正アクセスを防止 |
| **パスワードポリシー** | 複雑性要件、定期変更(※NIST SP800-63Bでは定期変更は非推奨) |
| **パスワードマネージャ** | サイトごとに異なるパスワードを管理(リスト攻撃対策) |

## サプライチェーン攻撃(Supply Chain Attack)

### 定義

サプライチェーン攻撃とは、**攻撃対象の組織に直接侵入するのではなく、その組織が利用するソフトウェア・ハードウェア・サービスの供給元(サプライチェーン)を経由して攻撃する手法**です。

> IPA「情報セキュリティ10大脅威」で近年常に上位にランクインしている重要テーマです。

### サプライチェーン攻撃の分類

| 分類 | 説明 | 具体例 |
|---|---|---|
| **ソフトウェアサプライチェーン攻撃** | ソフトウェアの開発・配布過程にマルウェアを混入 | SolarWinds事件(2020年)、Codecov事件 |
| **ハードウェアサプライチェーン攻撃** | 製造・流通過程でハードウェアに不正な改変 | 不正チップの埋め込み |
| **サービスサプライチェーン攻撃** | MSP(マネージドサービスプロバイダ)等の委託先を侵害 | Kaseya VSA事件(2021年) |

### ソフトウェアサプライチェーン攻撃の手法

| 手法 | 説明 |
|---|---|
| **ビルドプロセスの侵害** | CI/CDパイプラインにマルウェアを注入 |
| **正規アップデートの改ざん** | ソフトウェア更新機能を悪用して不正コードを配布 |
| **オープンソースライブラリの汚染** | npm/PyPI等のパッケージリポジトリに悪意あるパッケージを公開 |
| **タイポスクワッティング** | 正規パッケージ名に似た名前で悪意あるパッケージを公開 |
| **依存関係かく乱(Dependency Confusion)** | 内部パッケージと同名の悪意あるパッケージを公開リポジトリに登録 |

### サプライチェーン攻撃の特徴

- **正規の配布経路**を経由するため、利用者側での検知が極めて困難
- **広範囲に影響**：1つの侵害が何千もの組織に波及
- ゼロデイと組み合わされることが多い

### 対策

| 対策 | 内容 |
|---|---|
| **SBOM(Software Bill of Materials)** | ソフトウェアの構成要素(ライブラリ等)を一覧管理 |
| **コード署名の検証** | ソフトウェアの完全性と配布元の正当性を確認 |
| **委託先のセキュリティ評価** | サプライヤーのセキュリティ体制を定期的に監査 |
| **最小権限の原則** | サプライヤーに付与するアクセス権を必要最小限に |
| **ネットワーク監視** | 新規通信先やアップデート直後の異常挙動を監視 |

## コネクトバック通信

マルウェアに感染した内部ネットワークの端末などが、自ら外部の攻撃者のサーバに接続する通信方式です。
「リバースシェル」や「リバースコネクション」とも呼ばれます。

### 特徴

通常、企業ネットワークでは下記のようなFWが設定されています。

- 外部 → 内部(インバウンド通信)：原則ブロック
- 内部 → 外部(アウトバウンド通信)：業務で必要となるため許可

上記の構成は、外部からの不正アクセスを防ぐことを目的とした境界防御の基本です。
しかし、コネクトバックは内部から外部の攻撃者サーバにアクセスするため、こうした境界防御をすり抜けてしまうという大きな強みがあります。

したがって、**そもそもマルウェアに感染しない**ことを前提に、*EDR(Endpoint Detection and Response)* を前提とする必要があります。

### 周辺知識

|用語|内容|
|:----|:----|
|C&Cサーバ(Command & Control)|攻撃者が遠隔操作するための司令室|
|Beaconing(ビーコン通信)|一定間隔で攻撃者に"生存報告"を送る仕組み(高度なAPT攻撃で多用)|
|ゼロトラスト|「内部は安全」という前提を破壊する思想|
|暗号化されたコネクトバック(HTTPS/DoH)|通信が暗号化されていることで、解析が困難となり、IDS/IPSで内容確認ができない|
|EDR (Endpoint Detection and Response)|各エンドポイント (PC、サーバ等) の挙動を監視|
|ネットワークセグメンテーション|内部ネットワークを複数の論理/物理セグメントに分割|
|プロキシサーバ/Firewall|アウトバウンドを含めた通信の入り口に設置し、不要通信を制限・ログ取得|
|ラテラルムーブメント|一台の侵害からネットワーク内部を横展開し、他ホストやサーバを次々に侵害する動き|

## サイドチャネル攻撃(Side-Channel Attack)

### 定義

サイドチャネル攻撃とは、**暗号アルゴリズムそのものではなく、実装が漏らす物理的特徴を観測して秘密情報を推定する攻撃です**。

使用されるサイドチャネル例：

- **処理時間(Timing)**
- **電力消費(Power Consumption)**
- **電磁放射(EM Emission)**
- **キャッシュ動作(Cache Access/Branch Prediction)**
- **音響ノイズ(Acoustic)**
- **温度変化**
- **DRAM残留(Cold Boot Attack)**

暗号理論が安全でも、**実装が情報漏洩を起こす**と攻撃が成立してしまいます。

### タイミング攻撃(Timing Attack)

タイミング攻撃は、処理の実行時間の差から秘密情報(特に秘密鍵)を推定する手法です。

#### 典型的な例：RSA の平方式処理

RSA の `square-and-multiply`(平方/乗算)処理は、秘密鍵のビットに応じて計算手順が変化します。

- 0ビット → square のみ
- 1ビット → square + multiply

この違いが **実行時間差として観測可能** になり、攻撃者は距離が離れたネットワーク越しでも鍵を推定できるケースがあります。

**実際に Kocher(1996)が RSA の秘密鍵の抽出に成功した歴史的攻撃です。**

### 電力解析(Power Analysis Attack)

#### SPA(Simple Power Analysis)

電力波形の形状から処理分岐を読み取ります。

#### DPA(Differential Power Analysis)

統計解析を駆使し微弱な電力差から秘密鍵を抽出します。
**実世界のICカード攻撃で最も実用的です。**

### 電磁波解析(EMA)

チップの処理に伴う電磁放射を専用センサで受信し、内部状態を再構築します。

### キャッシュ攻撃(Cache Side-Channel)

CPUキャッシュの「ヒット/ミス」による時間差を利用します。

- AES の S-box 参照時間から鍵推定
- Spectre/Meltdown 系の投機実行攻撃
- Flush+Reload/Prime+Probe など有名手法が多数

### 音響攻撃(Acoustic Cryptanalysis)

RSA 計算中の CPU コイルの音を分析し秘密鍵を復元します。

### Cold Boot Attack

DRAM は電源断後も数秒〜数分残留します。
冷却すると残留時間が伸び、鍵情報が読み取られます。

### タイミング攻撃の対策

タイミング攻撃防止はサイドチャネル対策の中核です。

#### 定数時間実装(Constant-Time Implementation)

処理時間が秘密情報に依存しないよう設計します。

例：

- `if (bit == 1)` といった条件分岐を排除
- テーブル参照(S-boxなど)を同一パターンに固定
- RSA の「恒等時間モンゴメリ乗算」
- ECDH の「Montgomery Ladder」(RFC 7748)

RFC 7748(X25519/X448)は定数時間実装を強制する仕様です。

#### ランダム化(Blinding/Randomization)

##### RSA Blinding

RSA の演算にランダム値を掛けて処理分岐の揺らぎを吸収します。

##### ECC Blinding

楕円曲線スカラー値に乱数を加えます。
ランダム性により処理時間の相関を破壊します。

#### ノイズ付加(Noise Injection)

電力消費、時間、EMリークに揺らぎを加え、統計解析を困難にします。

#### キャッシュ対策

- キャッシュを使わない計算パターン
- キャッシュラインの分離
- Speculative Execution の制御(Spectre対策)
- Kernel Page Table Isolation(Meltdown対策)

#### 物理的対策(FIPS 140-3 HSM要件)

- 電磁シールド
- 電力線ノイズ吸収
- タンパーレジスタント筐体
- 不正開封検知
- 鍵削除機能

政府利用機関向けモジュールは FIPS 140-3 認証が必須です。

### FIPS(Federal Information Processing Standards)

NISTが制定しているアメリカ合衆国の情報処理標準規格群です。
領域ごとに様々なセキュリティ対策基準が規定されています。

### その他の「暗号を破る」攻撃手法(体系整理)

#### 計算量ベースの攻撃

- ブルートフォース
- 辞書攻撃
- レインボーテーブル

#### 通信経路攻撃

- MITM攻撃
- リプレイ攻撃
- ダウングレード攻撃(SSL 3.0/TLS1.0強制)

#### プロトコル攻撃

- パディングオラクル攻撃
- BLEICHENBACHER攻撃(PKCS#1 v1.5)
- Lucky13(CBC)

#### 実装攻撃(Implementation Attacks)

- サイドチャネル攻撃(Timing/Power/Cache...)
- フォールト攻撃(Fault Injection)
- グリッチ攻撃(電圧/クロック異常注入)

### フォールト攻撃との違い

#### サイドチャネル攻撃

**観測** による解析をします。

#### フォールト攻撃

**故意にエラーを発生させ、その結果から鍵を推定します。**

例：

RSA CRT をエラー化し "Bellcore Attack" で秘密鍵を流出させます。

## Pass-the-Hash(PtH)攻撃とWindows NTLM認証

### 定義

Pass-the-Hash(PtH)攻撃とは、**Windowsが内部で保持する"パスワードハッシュ(NTLMハッシュ)"を盗み、そのまま認証に利用してログインする攻撃**です。

### 重要ポイント

- ハッシュ = "パスワードの代わり"として機能する
- パスワードの平文を知らなくても認証可能
- 横移動(Lateral Movement)攻撃の中心的手法
- 権限昇格/ドメイン制圧に直結する

### NTLM(New Technology LAN Manager)認証

Windows が提供するチャレンジレスポンス方式の認証プロトコルです。
現在の標準は **Kerberos** だが、互換性のため **NTLM も残存しています**。

#### NTLM の種類

- **NTLMv1**：DES ベースのチャレンジレスポンス計算と LM Hash を使用する弱い方式 → **利用非推奨**
- **NTLMv2**：HMAC-MD5 を利用した強化版(ただし PtH は防げない)

#### NTLM 認証(チャレンジレスポンス方式)

パスワード本体が送られない利点があるが**盗んだハッシュ値を使えば本人になりすますことが可能**という致命的弱点があります。

1. クライアントがログイン要求
2. サーバがチャレンジ値を送信
3. クライアントは **パスワード→NTLMハッシュ** を使い応答を生成
4. サーバ側に登録されたハッシュで検証

### Pass-the-Hash攻撃の仕組みと手順

#### 手順1：NTLMハッシュの取得

Windows の **LSASS(Local Security Authority Subsystem Service)** から資格情報を抽出します。

主なツール：

- **Mimikatz(最も有名)**
- Invoke-Mimikatz(PowerShell版)
- Metasploit(hashdump モジュール)

LSASS が保持しているもの：

- NTLM ハッシュ
- Kerberos TGT/TGS チケット
- LSA Secrets(サービスアカウント情報など)

#### 手順2：ハッシュをそのまま認証に使用

**平文パスワードが不要で認証可能です。**

例：PsExec をハッシュで実行
```
PsExec.exe \TARGET cmd.exe -u user -H <NTLMハッシュ>
```

#### 手順3：横移動(Lateral Movement)

取得した資格情報を使い、ネットワーク内の他端末へ侵入します。
最終的には **ドメインコントローラ(DC)奪取** を狙うのが典型的攻撃シナリオです。

横移動手法：

- SMB(C$/ADMIN$)
- WinRM
- WMI
- RDP

### NTLM が PtH に弱い理由(設計上の問題)

- NTLM は「パスワード」ではなく「パスワードハッシュ」を認証に使用
- **ハッシュを知っている = パスワードを知っているに等しい**
- セッションキー生成にもハッシュを使用
- Kerberos のような"チケット署名検証"の仕組みが弱い

そのため、**1 回でも侵害されると横移動が容易になります**。

### PtH 攻撃の有効な対策(Microsoft 推奨)

#### Credential Guard(Windows 10+)

VBS(仮想化基盤)により LSASS を隔離して資格情報窃取を防止します。
これは、**最も強力な防御策**です。

#### LAPS(Local Administrator Password Solution)

- PCごとに異なるローカル管理者パスワードを自動で設定
- 横移動耐性が大幅に向上
- ドメイン管理のベストプラクティス

#### 管理者アカウントの分離

- 日常操作用アカウントと特権管理用アカウントを分ける
- 特権アカウントでのログオンを最小化する

#### NTLM の無効化(Kerberos の強制)

- グループポリシーで NTLM 認証を拒否
- SMB サインを必須化
- 既存システムの互換性要検討

#### LSASS プロセス保護(RunAsPPL)

LSASS への不正読取を防止：
```
HKLM\SYSTEM\CurrentControlSet\Control\Lsa
"RunAsPPL"=dword:00000001
```

#### SMBv1 の無効化

EternalBlue 系脆弱性の悪用防止にも有効です。

### Windows 認証の比較(NTLM vs Kerberos)

| 項目 | NTLM | Kerberos |
|------|------|----------|
| 認証方式 | チャレンジレスポンス | チケット(KDC)方式 |
| 弱点 | Pass-the-Hash | Pass-the-Ticket(TGT/TGS) |
| セキュリティ強度 | 中 | 高 |
| 推奨度 | 互換性目的 | **Windowsドメインの標準方式** |

### MITRE ATT&CK との対応

| 攻撃技術 | ID | 内容 |
|----------|------|---------|
| Credential Dumping | T1003 | LSASS から資格情報を抽出 |
| Pass-the-Hash | **T1550.002** | ハッシュを使った認証なりすまし |
| Pass-the-Ticket | T1550.003 | Kerberos チケット悪用 |

### 周辺知識

#### SAM(Security Accounts Manager)

ローカル資格情報の保存場所です。
SAMデータベースも Mimikatz の標的になります。

#### Kerberos のチケット盗難(Pass-the-Ticket)

PtH の兄弟攻撃です。
TGT/TGS を盗んで成りすましを行います。

#### Kerberos 関連攻撃の体系(試験頻出)

| 攻撃手法 | 説明 | 必要条件 |
|---|---|---|
| **Pass-the-Ticket(PtT)** | 窃取した TGT/TGS チケットを使って認証 | メモリ上のチケットの窃取 |
| **Golden Ticket攻撃** | **krbtgtアカウントのハッシュ**を使い、任意のTGTを偽造 | ドメインコントローラの侵害(krbtgtハッシュ取得) |
| **Silver Ticket攻撃** | **サービスアカウントのハッシュ**を使い、特定サービスのTGSを偽造 | サービスアカウントのハッシュ取得 |
| **Kerberoasting** | SPN(Service Principal Name)が設定されたサービスアカウントのTGSを要求し、**オフラインでパスワードクラック** | ドメインユーザの権限(特権不要) |
| **AS-REP Roasting** | Kerberos事前認証が無効なアカウントのAS-REPを取得し、オフラインでクラック | ドメインユーザの権限 |

##### Golden Ticket攻撃の詳細

- **krbtgt** はKerberos KDCが使用するサービスアカウント
- krbtgtのハッシュがあれば**任意のユーザ・任意の有効期限のTGTを偽造**可能
- ドメイン管理者権限の完全な奪取に相当
- **対策**：krbtgtパスワードの定期的なリセット(2回連続で変更が必要)

##### Kerberoasting の詳細

- **一般ユーザ権限で実行可能**なため、検知が困難
- SPNが設定されたサービスアカウントが弱いパスワードの場合に成功
- **対策**：サービスアカウントに長く複雑なパスワードを設定、gMSA(Group Managed Service Accounts)の利用

#### Protected Users グループ

- NTLM を禁止
- 資格情報キャッシュ無効
- 高セキュリティ運用向き

#### SMB サイン(Message Signing)

中間者攻撃を防止します。
NTLM 環境でも有効です。

## AIによる画像認識と Adversarial Examples 攻撃(敵対的サンプル攻撃)

### AIによる画像認識の基礎

#### 画像認識とは

画像認識とは、**画像データを入力として、物体/人物/特徴を自動的に識別/分類する技術**のことです。
代表的な応用例：

- 顔認証
- 自動運転(歩行者/信号認識)
- 医療画像診断
- 監視カメラ解析

#### 技術的背景

現代の画像認識は主に以下を用います。

- 深層学習(Deep Learning)
- 畳み込みニューラルネットワーク(CNN)

##### CNNの特徴

- 画像の「局所的特徴(エッジ/模様)」を学習
- 層を重ねることで高次特徴を抽出
- 人間の視覚に近い処理構造

#### 学習と推論

| フェーズ | 内容 |
|---|---|
| 学習 | 大量の正解付き画像からパターンを学習 |
| 推論 | 未知の画像を入力し、分類結果を出力 |

**推論時の入力は「完全に信用されている」前提**で設計されています。

### Adversarial Examples(敵対的サンプル)とは

#### 定義

**Adversarial Example** とは、人間にはほぼ同じ画像に見えますが、AIには誤認識を引き起こすよう細工された入力データを指します。

代表的根拠：

- Szegedy et al., 2013
- NIST IR 8269(AI Security)

#### 攻撃の本質

- ピクセル値を**極めて微小に改変**
- 人間の視覚では識別困難
- AIの分類結果が大きく変化

例：

- パンダ → 人間にはパンダ
- AI → テナガザルと誤認識

### なぜAIはだまされるのか

#### 高次元空間の問題

画像は以下の特徴を持ちます。

- 数万〜数百万次元のデータ
- 人間の感覚とは異なる距離尺度

**人間にとって微差でも、AIにとっては決定的差分になります。**

#### 線形近似の弱点

深層学習モデルは、局所的には線形近似として振る舞います。

- 勾配方向にノイズを加える
- 出力が大きく変化

これを悪用したのが敵対的サンプル攻撃です。

### Adversarial Examples 攻撃の手法

#### FGSM(Fast Gradient Sign Method)

- 勾配の符号方向に微小ノイズを付加
- 高速/簡易な攻撃

#### Iterative Attack

- FGSMを反復適用
- 精度は高いが計算量増加

#### Physical Adversarial Attack

- 実世界で成立する攻撃
- 標識に細工することで自動運転が誤認識

**サイバー空間に限定されない点が重要です。**

### AI特有の攻撃手法(周辺知識)

#### データポイズニング攻撃

- 学習データに不正データを混入
- モデル自体を歪める

#### モデル反転攻撃(Model Inversion)

- 出力結果から学習データを推測
- 個人情報漏えいリスク

#### モデル抽出攻撃(Model Extraction)

- API応答を大量取得
- 内部モデルを再現

### 対策技術

#### Adversarial Training

- 敵対的サンプルを含めて学習
- 一定の耐性を獲得

#### 入力検証/異常検知

- ノイズ特性の分析
- 信頼度スコアの導入

#### 多層防御の必要性

- AI単体に依存しない
- 人的確認/ルールベース併用

### 従来のセキュリティ攻撃との違い

| 観点 | 従来攻撃 | Adversarial 攻撃 |
|---|---|---|
| 攻撃対象 | OS/アプリ | 学習モデル |
| 攻撃手段 | コード/通信 | 入力データ |
| 可視性 | 比較的明確 | 人間には不可視 |

## 中間者攻撃(MITM：Man-in-the-Middle Attack)

### 定義

中間者攻撃とは、**通信を行う2者の間に攻撃者が割り込み、通信内容の盗聴・改ざんを行う攻撃**です。

### 中間者攻撃の種類

| 種類 | 説明 | 攻撃手法 |
|---|---|---|
| **ARP スプーフィング** | LAN内でARPテーブルを偽装し通信を傍受 | 偽のARP応答を送信 |
| **DNSスプーフィング** | DNS応答を偽装し偽サイトに誘導 | DNSキャッシュポイズニング等 |
| **SSL/TLS MITM** | HTTPS通信の間に入り、偽の証明書で通信を中継 | 偽のCA証明書のインストール、SSL Stripping |
| **Wi-Fi MITM(Evil Twin)** | 偽のアクセスポイントを設置し通信を傍受 | 正規APと同じSSIDで偽APを設置 |
| **BGPハイジャック** | BGPルーティング情報を改ざんし通信を迂回 | 偽の経路情報をアナウンス |

### SSL Stripping(SSLストリッピング)

- HTTPSへのリダイレクトをHTTPに差し替え、暗号化を無効化
- ユーザには通常のHTTP通信に見えるため気付きにくい
- **対策**：HSTS(HTTP Strict Transport Security)の導入、HSTSプリロードリスト

### 中間者攻撃の対策

| 対策 | 内容 |
|---|---|
| **TLS/HTTPS の強制** | 通信の暗号化により盗聴・改ざんを防止 |
| **HSTS** | ブラウザにHTTPS接続を強制させるHTTPヘッダ |
| **証明書ピンニング(Certificate Pinning)** | 特定の証明書/公開鍵のみを信頼(偽証明書を排除) |
| **DNSSEC** | DNS応答の真正性を検証 |
| **DAI(Dynamic ARP Inspection)** | ARPスプーフィングの検知・防止 |
| **VPN** | 通信経路全体を暗号化 |

## ゼロデイ攻撃(Zero-Day Attack)

### 定義

ゼロデイ攻撃とは、**ソフトウェアの脆弱性が発見されてからパッチが提供されるまでの期間(ゼロデイ)に、その脆弱性を悪用する攻撃**です。

### ゼロデイ攻撃が危険な理由

| 理由 | 説明 |
|---|---|
| パッチが存在しない | ベンダーが脆弱性を認識する前、または修正プログラムの提供前 |
| シグネチャがない | IDS/IPS やウイルス対策ソフトの検知パターンが未整備 |
| APT攻撃との組み合わせ | 国家支援型の攻撃グループが高価なゼロデイを保有・利用 |

### ゼロデイ攻撃への対策(多層防御)

| 対策 | 内容 |
|---|---|
| **仮想パッチ(WAF/IPS)** | 脆弱性の根本修正前に攻撃パターンをブロック |
| **EDR** | 未知の攻撃でもエンドポイントの異常挙動を検知 |
| **サンドボックス** | 不審なファイルを隔離環境で実行・分析 |
| **マイクロセグメンテーション** | 被害範囲をネットワークセグメント単位で限定 |
| **脅威インテリジェンス** | 最新の脆弱性情報・攻撃情報を早期に収集 |
| **ASLR/DEP** | OS レベルのメモリ保護(エクスプロイト緩和) |

### 脆弱性関連の用語整理

| 用語 | 説明 |
|---|---|
| **CVE(Common Vulnerabilities and Exposures)** | 脆弱性の一意な識別番号(例：CVE-2021-44228 = Log4Shell) |
| **CVSS(Common Vulnerability Scoring System)** | 脆弱性の深刻度スコア(0.0〜10.0) |
| **CWE(Common Weakness Enumeration)** | ソフトウェアの弱点の分類体系 |
| **NVD(National Vulnerability Database)** | NISTが運営する脆弱性情報データベース |
| **JVN(Japan Vulnerability Notes)** | JPCERT/CCとIPAが共同運営する日本の脆弱性情報サイト |
| **PoC(Proof of Concept)** | 脆弱性の悪用可能性を示す実証コード |

## サイバー攻撃手法の全体整理

### 攻撃フェーズ別の手法整理(サイバーキルチェーン対応)

| フェーズ | 手法 | 説明 |
|---|---|---|
| **偵察** | OSINT、ポートスキャン、ソーシャルエンジニアリング | 攻撃対象の情報収集 |
| **武器化** | マルウェア作成、エクスプロイト開発 | 攻撃ツールの準備 |
| **配送** | スピアフィッシング、水飲み場型攻撃、サプライチェーン攻撃 | 攻撃コードの送達 |
| **悪用** | ゼロデイ攻撃、ドライブバイダウンロード、パスワード攻撃 | 脆弱性の悪用による侵入 |
| **インストール** | マルウェア設置、ルートキット、永続化(レジストリ等) | 攻撃基盤の確立 |
| **C&C** | コネクトバック通信、Beaconing、DNS トンネリング | 遠隔操作の確立 |
| **目的実行** | 情報窃取、ランサムウェア、ラテラルムーブメント | 最終目的の達成 |

### 攻撃手法の分類別整理

| 分類 | 攻撃手法 |
|---|---|
| **人的脆弱性を突く攻撃** | フィッシング、スピアフィッシング、BEC、プリテキスティング、ショルダーハッキング |
| **認証・資格情報を狙う攻撃** | ブルートフォース、パスワードリスト攻撃、Pass-the-Hash、Golden Ticket、Kerberoasting |
| **Webを経由する攻撃** | 水飲み場型攻撃、ドライブバイダウンロード、マルバタイジング |
| **供給経路を悪用する攻撃** | サプライチェーン攻撃(ソフトウェア/ハードウェア/サービス) |
| **通信経路を悪用する攻撃** | 中間者攻撃、ARP スプーフィング、SSL Stripping、DNSスプーフィング |
| **暗号実装を狙う攻撃** | サイドチャネル攻撃(タイミング/電力/キャッシュ)、フォールト攻撃 |
| **AIを狙う攻撃** | Adversarial Examples、データポイズニング、モデル抽出攻撃 |
| **内部活動(侵入後)** | ラテラルムーブメント、権限昇格、コネクトバック通信、ログ消去 |
