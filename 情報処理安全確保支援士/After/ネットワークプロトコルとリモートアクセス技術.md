# TCP/IPの主要プロトコルからVPN・DNS・マルチキャストまでを体系的に整理

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。
**本記事は学習した内容を記載しています。**

## 該当問題

[情報セキュリティスペシャリスト平成21年春期 午前Ⅱ 問2](https://www.sc-siken.com/kakomon/21_haru/am2_2.html)
[情報セキュリティスペシャリスト平成23年秋期 午前Ⅱ 問19](https://www.sc-siken.com/kakomon/23_aki/am2_19.html)
[情報セキュリティスペシャリスト平成27年春期 午前Ⅱ 問18](https://www.sc-siken.com/kakomon/27_haru/am2_18.html)
[情報セキュリティスペシャリスト平成27年秋期 午前Ⅱ 問18](https://www.sc-siken.com/kakomon/27_aki/am2_18.html)
[情報処理安全確保支援士平成31年春期 午前Ⅱ 問19](https://www.sc-siken.com/kakomon/31_haru/am2_19.html)
[情報処理安全確保支援士令和元年秋期 午前Ⅱ 問20](https://www.sc-siken.com/kakomon/01_aki/am2_20.html)
[情報処理安全確保支援士令和2年秋期 午前Ⅱ 問19](https://www.sc-siken.com/kakomon/02_aki/am2_19.html)
[情報処理安全確保支援士令和3年秋期 午前Ⅱ 問11](https://www.sc-siken.com/kakomon/03_aki/am2_11.html)
[情報処理安全確保支援士令和4年秋期 午前Ⅱ 問18](https://www.sc-siken.com/kakomon/04_aki/am2_18.html)
[情報処理安全確保支援士令和5年秋期 午前Ⅱ 問19](https://www.sc-siken.com/kakomon/05_aki/am2_19.html)
[情報処理安全確保支援士令和6年秋期 午前Ⅱ 問19](https://www.sc-siken.com/kakomon/06_aki/am2_19.html)

## TCP(Transmission Control Protocol)

### TCPの概要

**RFC 793/RFC 1122/RFC 5681** で定義される、信頼性の高いコネクション指向型のトランスポート層プロトコルです。

主な特徴は以下のとおりです。

- コネクション型(3-way ハンドシェイク)
- 信頼性(再送制御、順序制御、誤り検出)
- フロー制御(ウィンドウ制御)
- 輻輳制御(スロースタート、輻輳回避、ファストリトランスミット)
- 全二重通信(Full-duplex)

### TCPヘッダー各フィールドの詳細

TCPヘッダーには下記フィールドが用意されています。

* Source Port
* Destination Port
* Sequence Number
* Acknowledgment Number
* Data Offset
* Control Flags
* Window Size
* Checksum
* Urgent Pointer
* Options

#### 送信元ポート番号(Source Port)

- 通信元アプリケーションを識別します
- クライアント側はエフェメラルポートを使用します

**攻撃・運用との関係**
- セッション識別(5タプル)
- ポートスキャンの対象となります

#### 宛先ポート番号(Destination Port)

- 通信先アプリケーションを識別します
- HTTP(80)、HTTPS(443) などがあります

#### シーケンス番号(Sequence Number)

- **送信データの先頭バイト番号** です
- データの順序制御・再送制御に使用します

**重要ポイント**
- 初期値(ISN)はランダムです
- 推測されると **TCPセッションハイジャック** の危険があります

#### 確認応答番号(Acknowledgment Number)

- 次に受信したいバイト番号を通知します
- ACKフラグと組み合わせて使用します

#### データオフセット(Data Offset)

- TCPヘッダー長を示します
- 単位は32bitワードです
- オプションフィールドの有無を判定するために使用します

#### フラグ(Control Flags)

TCPの状態管理の中核を担います。

| フラグ | 意味 |
|---|---|
| SYN | 接続要求 |
| ACK | 確認応答有効 |
| FIN | 正常終了 |
| RST | 異常終了 |
| PSH | 即時配送 |
| URG | 緊急データ有効 |

**試験頻出ポイント**
- SYN/ACK/FIN/RST の意味と役割が問われます
- 不正な組合せは攻撃検知に利用されます

#### ウィンドウサイズ(Window Size)

- 受信側が受信可能なデータ量です
- フロー制御の要です

**関連攻撃**
- Window サイズ枯渇攻撃

#### チェックサム(Checksum)

- TCPヘッダー＋データの誤り検出に使用します
- IP疑似ヘッダーも含みます

#### 緊急ポインタ(Urgent Pointer)

- URGフラグが立っている場合のみ有効です
- 現在ではほぼ使用されません

#### オプション(Options)

代表例は以下のとおりです。

- MSS(Maximum Segment Size)
- Window Scale
- SACK(Selective Acknowledgment)

通信効率・信頼性向上のために使用します。

### TCP 3-way ハンドシェイク(接続確立)

TCPの接続確立は以下の手続きで行われます。

```
Client → Server : SYN
Server → Client : SYN/ACK
Client → Server : ACK
```

目的は以下のとおりです。

- 初期シーケンス番号(ISN)の同期
- 双方向通信の準備完了

### TCPの接続終了(4-way ハンドシェイク)

```
FIN →
         ← ACK
         ← FIN
ACK →
```

TCPは全二重通信のため、双方が独立してFINを送る必要があります。

### 再送制御(Reliable Transmission)

TCPは誤り制御として「再送」を行います。

#### タイムアウト再送(RTO)

- ACKが返らなければ **Retransmission Timeout(RTO)** により再送します
- RTOはRTTの変動で動的に計算されます(RFC 6298)

#### 重複ACKによる高速再送(Fast Retransmit)

3つ以上連続した Duplicate ACK を受信すると、**タイムアウトを待たずに高速再送** を行います。

### フロー制御(Flow Control：受信側保護)

受信側がパンクしないための **ウィンドウ制御(Window Size)** を使用します。

- 受信側は「受信可能バッファサイズ」をウィンドウサイズとして通知します
- 送信側はその範囲内でのみ送信可能です

### 輻輳制御(Congestion Control：ネットワーク保護)

RFC 5681 による代表的アルゴリズムです。

#### スロースタート(Slow Start)

最初は送信量(cwnd)を指数的に増加させます。ネットワークの混雑を探りながら増やします。

#### 輻輳回避(Congestion Avoidance)

しきい値(ssthresh)を超えると増加ペースを線形に変更します。

#### 高速再送(Fast Retransmit)

Duplicate ACK を基に即座に再送します。

#### 高速回復(Fast Recovery)

混雑発生後も cwnd をゼロに戻さず制御し、スループット低下を軽減します。

### MSS/MTU/フラグメンテーション

#### MTU(Maximum Transmission Unit)

リンク層の最大フレームサイズです(Ethernet: 1500 byte)。

#### MSS(Maximum Segment Size)

TCPセグメントが運べる最大データ量です。
**MSS ≒ MTU - IPヘッダ - TCPヘッダ**

#### パス MTU ディスカバリ(PMTUD)

ICMP Fragmentation Needed を利用し、最適 MSS を発見する仕組みです。

### TCPのセキュリティリスクと対策

#### SYN Flood(DoS攻撃)

- 大量の SYN を送り、半開状態(SYN-RECV)を保持させる攻撃です
- 対策：SYN Cookies、ファイアウォール、SYN Backlog 拡張

#### セッションハイジャック

- シーケンス番号推測によりセッションを乗っ取ります
- 現代のランダム ISN(RFC 6528)で困難になっています

**SYNフラグ・シーケンス番号管理** が重要です。

#### Reset 攻撃(RST Spoofing)

RST を偽造して通信を強制切断する攻撃です。

### TCPとUDPの比較(試験頻出)

|項目|TCP|UDP|
|---|---|---|
|信頼性|あり|なし|
|コネクション|あり|なし|
|再送制御|あり|なし|
|速度|遅い|速い|
|用途|Web、メール|DNS、VoIP、ゲーム|
|ヘッダー|複雑|簡素|
|攻撃面|状態管理が狙われる|反射攻撃に利用|

### TCP周辺知識

#### ステルススキャン

- FIN / Xmas / Null スキャン
- フラグ挙動を悪用します

#### Nagle アルゴリズム

小さいTCPセグメントをまとめて送信することで遅延が発生します。SSH/Telnetではオフにすることがあります。

#### Delayed ACK

Nagle と組み合わせると遅延が大きくなる「相互作用問題」があります。

#### KeepAlive(TCP Keepalive)

長時間通信が無い場合、接続生存確認を行います。

#### TIME_WAIT

接続終了時に残る状態です(2MSL保持)。

## ポート番号(IANA Port Registry)

### ポート番号の分類

IANAではポート番号を以下のように分類しています。

| 区分 | 範囲 | 説明 |
|------|--------|--------|
| **Well-Known Ports** | 0--1023 | 代表プロトコル用(HTTP、SSH、Telnet等) |
| **Registered Ports** | 1024--49151 | 各アプリケーションが登録して利用 |
| **Dynamic/Private Ports** | 49152--65535 | クライアント側の動的ポート |

### 主なウェルノウンポート(IANA/RFC 準拠)

| ポート番号 | プロトコル | 用途 | 標準(RFC) |
|------------|------------|------|--------------|
| 20/21 | FTP | ファイル転送 | RFC 959 |
| 22 | SSH | セキュアリモートログイン | RFC 4251 |
| 23 | Telnet | 非暗号化リモートログイン | RFC 854 |
| 25 | SMTP | メール送信 | RFC 5321 |
| 53 | DNS | 名前解決 | RFC 1035 |
| 67/68 | DHCP | IP割当(UDP) | RFC 2131 |
| 69 | TFTP | 簡易ファイル転送 | RFC 1350 |
| 80 | HTTP | Web通信 | RFC 9110 |
| 110 | POP3 | メール受信 | RFC 1939 |
| 143 | IMAP | メール受信 | RFC 3501 |
| 443 | HTTPS | 暗号化Web通信 | RFC 9110 |

TCP23番ポートは **Well-Known Ports に属する** ため、スキャン対象として狙われやすい特徴があります。

## Telnet(RFC 854)

### Telnetの概要

Telnet は歴史の古い **仮想端末接続プロトコル** で、**RFC 854 "TELNET PROTOCOL SPECIFICATION"** によって規定されています。

RFC：https://datatracker.ietf.org/doc/html/rfc854

### Telnetの特徴

- TCP23番ポートを使用します
- 通信内容は **平文(暗号化なし)** です
- パスワードや入力内容もそのままネットワーク上に流れます
- 双方向のテキストベース通信です

### Telnetのセキュリティリスク

Telnetが今日利用されない最大の理由は「暗号化がないこと」です。

#### 主なリスク

1. **盗聴(Sniffing)によるパスワード漏洩**
2. **MITM(中間者攻撃)に弱い**
3. **セッション乗っ取りが可能**
4. **ブルートフォース攻撃の標的になりやすい**
5. **古いOS/ネットワーク機器の脆弱性悪用に使われる**

#### 推奨される代替手段(RFC 4251)

Telnetの代わりに、暗号化通信が可能な **SSH(Secure Shell、TCP22)** の利用が標準となっています。

### ファイアウォール/脆弱性管理での注意点

#### Telnet(TCP23)は外部公開しない

FWでは以下の設定が必須です。

```text
外部 → 内部：TCP23 すべて拒否
内部 → 外部：必要な場合のみ許可(基本は不要)
```

#### SSH(22番)に移行する

暗号化されているSSHを利用するのが標準的対策です。

#### ポートスキャン対策

攻撃者は以下の技術で23番をスキャンします。

* SYNスキャン
* TCP Connect スキャン
* 全ポートスキャン

FW/IPSで検知/遮断することが推奨されます。

## ARPとRARP

### ARP(Address Resolution Protocol)

#### 概要(RFC 826)

ARP は **IPアドレス → MACアドレス** を解決するプロトコルで、同一ネットワーク内で通信する際に必須となります。

#### ARPが必要となる理由

イーサネットでの通信は最終的に **MACアドレス宛て** にフレームを送信するため、IPアドレス宛ての通信であっても、宛先MACアドレスが分からなければ通信できません。

#### ARPリクエスト/リプライ

| 種類 | 説明 |
|------|------|
| **ARP Request** | ブロードキャストで「このIPの持ち主は誰？」と質問します |
| **ARP Reply** | 対応するMACアドレスをユニキャストで返信します |

#### ARPテーブル

その結果はARPキャッシュとして一定時間OSに保存されます。キャッシュの保持期間はOSによって異なります。

### ARPのセキュリティ問題

ARPは非常に単純で、**認証機能が存在しない** ため、攻撃に悪用されます。

#### ARPスプーフィング(ARP Poisoning)

攻撃者が「私はこのIPのMACアドレスです」と偽ARP返信を送ることで被害者のARPテーブルを書き換える攻撃です。

これにより、下記などが可能となります。

- MITM(中間者攻撃)
- パケット盗聴
- セッションハイジャック

#### 対策

- 静的ARP設定(小規模ネットワーク向け)
- DHCP Snooping + Dynamic ARP Inspection(スイッチ機能)
- ポートセキュリティ
- IPS/IDS による異常ARP検知

### RARP(Reverse ARP)

#### 概要(RFC 903)

RARPは、ARPの逆で **MACアドレス → IPアドレス** を解決するプロトコルです。

#### RARPが使われていた目的

IPアドレスを持たないディスクレス端末(昔のWS)などが **自分のMACアドレスを送信し、RARPサーバからIPアドレスを配布してもらう** 用途に利用されていました。

### RARPが使われなくなった理由

RARPには構造的な制約があり、現在では **BOOTP → DHCP が主流** です。

#### RARPの欠点

- 返せる情報が **IPアドレスだけ** です
- L2で動作するため **ルータを越えられません**
- 柔軟性が低く拡張不可です

#### 代替技術

| 技術 | 説明 |
|------|------|
| **BOOTP(RFC 951)** | IPに加えサブネットマスクなども提供可能です |
| **DHCP(RFC 2131)** | 動的割り当て、高い拡張性を持ち、現在の標準です |

### ARP/RARP関連の周辺知識

#### GARP(Gratuitous ARP)

自分自身のARP情報をネットワークに通知するARPのことです。

用途は以下のとおりです。

- IPアドレス重複検知
- VRRP/HSRP での仮想IP切替通知

#### Proxy ARP

ルータが別ネットワークの端末の代わりにARP応答を返す技術です。セキュリティ上推奨されません。

#### NDP(Neighbor Discovery Protocol)

IPv6 では ARP に相当するのは NDP(RFC 4861)です。ICMPv6 を利用している点が大きな特徴です。

#### DHCP

IPアドレスを自動割り当てする仕組みです。ステートレス/ステートフル機能があり、IPv6 では DHCPv6 と組み合わせることもあります。

#### VLANとARPの関係

ARPはブロードキャストであるため、**VLAN境界を越えることはありません**(L2セグメント内で完結)。

## ICMP(Internet Control Message Protocol)

### ICMPとは(RFC 792)

ICMP(Internet Control Message Protocol)は、**IP通信の制御/エラー通知/経路診断を行うプロトコル** です。RFC 792 で正式に定義されており、「IPレイヤの補助プロトコルであり、エラー報告のために使用する」と記述されています。

### ICMPの役割

- **エラーメッセージ通知**
  - 宛先到達不能
  - タイムエクシード
  - パラメータ異常
- **経路診断**
  - ping(Echo Request/Reply)
  - traceroute(Time Exceededを利用)
- **ネットワーク制御**
  - リダイレクト(経路変更指示)
  - ソースクエンチ(現在は非推奨)

### ICMPメッセージ分類(RFC 792)

ICMPメッセージは **TypeとCode** によって分類されます。

#### 代表的なICMP Type

| 種類 | Type | 内容 |
|------|------|------|
| Echo Request | 8 | ping 送信 |
| Echo Reply | 0 | ping 応答 |
| Destination Unreachable | 3 | 宛先到達不能 |
| Time Exceeded | 11 | TTL 超過(tracerouteで利用) |
| Redirect | 5 | 経路変更指示 |
| Parameter Problem | 12 | パケット構造の異常 |

### 宛先到達不能(Destination Unreachable)

Type 3 の代表的コードは以下のとおりです。

| Code | 意味 |
|------|------|
| 0 | Network Unreachable |
| 1 | Host Unreachable |
| 3 | Port Unreachable(UDP応答でよく使われます) |
| 4 | Fragmentation Needed(DF=1時) |

UDP(未接続型)では、宛先ポート未使用時に **ICMP Port Unreachable** が通知されるため、**UDPスキャンの検知** にも使われます。

### Time Exceeded(TTL超過)

TTLが0になるとルータが送信する ICMP Type 11 のことです。traceroute は次の仕組みで動作しています。

1. TTL=1 のパケット送信
2. 1番目のルータで TTL=0 → ICMP Time Exceeded
3. TTL=2 のパケット送信
4. 2番目のルータで TTL=0 → ICMP Time Exceeded

これを繰り返すことで経路を特定します。

### ICMP Redirect(経路変更指示)

ルータがホストに対して「より適切なルータがあるので、そちらへ送信せよ」と通知します。しかし、攻撃者が悪用すると **MITM攻撃(中間者攻撃)** を可能にするため、現在では **管理ネットワーク以外では禁止が推奨** されています。

### ICMP攻撃(セキュリティ観点)

#### Smurf攻撃

ブロードキャスト宛てに送信元IPを偽装した Echo Request を送信し、大量の Echo Reply を被害者に集中させる攻撃です。directed broadcast を禁止することで、Smurf攻撃を防止します。

#### ICMP Flood(DoS攻撃)

大量の Echo Request を送り、CPU負荷や帯域枯渇を狙います。ICMPレート制限することでDoS攻撃を防止できます。

#### ICMP Tunneling

ICMPペイロード内に任意データを埋めて通信する手法です。ファイアウォール回避に悪用されます。組織ではICMPを必要最小限に制限することが推奨されます。

### ICMPv6(RFC 4443)

IPv6では **ICMPv6が必須プロトコル** であり、IPv6ネットワーク制御の中核となります。

#### ICMPv6が必須となる理由

IPv4よりもICMPの重要性が高いためです。

- **近隣探索(NDP：Neighbor Discovery Protocol)** ── ARPを置き換える仕組みです
- **RA(Router Advertisement)** ── IPv6アドレス自動生成に使用します
- **MLD(Multicast Listener Discovery)** ── マルチキャスト管理に使用します

### ICMP関連の周辺知識

#### ARPとの違い

| プロトコル | 役割 |
|------------|------|
| ARP | L2アドレス解決(IPv4) |
| ICMP | IPエラー通知/診断 |
| ICMPv6(NDP) | IPv6版ARP |

#### UDPとの関係

UDPは未接続型のため、未使用ポートへのアクセスでは **ICMP Port Unreachable(Type3 Code3)** が返されます。ポートスキャンの検知に活用されます。

#### TCPとの関係

TCPはコネクション型です。3ウェイハンドシェイクの段階ではICMPではなく **RST** を返します。

#### ファイアウォールでのICMP制御

- ping応答を禁止します
- Redirectを禁止します
- Time Exceeded(traceroute)を制限します
- Fragmentation Needed(PMTUDに必須)は許可すべきです

## IPv6

### IPv6とは

IPv6(Internet Protocol version 6)は **IPv4の後継規格としてIETFが策定した次世代IPプロトコル(RFC 8200)** であり、アドレス枯渇の解消とプロトコルの簡素化が目的です。

### IPv6の主要特徴(RFC 8200)

#### 128bitの巨大アドレス空間

IPv4(32bit：約43億)に対し、IPv6は **128bit(約3.4×10³⁸)** のアドレス空間を持ちます。

#### 固定長40バイトのシンプルなヘッダ

- IPv4のヘッダを簡素化しています
- ルータでの高速処理が可能です
- チェックサムは廃止されています(上位層で実施)

#### 拡張ヘッダによる柔軟性

セキュリティ(IPsec)、ルーティング、トンネルなどを追加可能です。

#### NATを前提としない設計

IPv4のアドレス不足対策であるNATは想定していません。エンドツーエンド通信を復権する思想があります。

#### IPsecのサポート

当初 RFC 4294 で IPsec の実装が必須(MUST)とされていましたが、RFC 6434(2011年)により推奨(SHOULD)に緩和されました。

### IPv6アドレス表記(RFC 4291)

16bit × 8 ブロックを16進数で記述します。

```
2001:0db8:abcd:0012:0000:0000:0000:0001
```

省略ルールは以下のとおりです。

- 先頭ゼロ省略：`0001 → 1`
- 連続ゼロ省略：`::`(1度のみ使用)

例：

```
2001:db8:abcd:12::1
```

### IPv6アドレス種別

| 種別 | プレフィックス | 用途 |
|------|----------------|------|
| グローバルユニキャスト | 2000::/3 | 全世界で到達可能です |
| リンクローカル | fe80::/10 | 同一リンク内のみで、全インタフェースに自動設定されます |
| ユニークローカル(ULA) | fc00::/7 | 組織内専用です(IPv4プライベート相当) |
| マルチキャスト | ff00::/8 | ブロードキャストの代替です |
| ループバック | ::1 | 自身を指します |

ブロードキャストアドレスは **IPv6には存在しません**。

### IPv6の自動設定(SLAAC)

#### SLAAC(Stateless Address Auto Configuration)

ルータ広告(RA)を用いて **ステートレスにアドレスを自動設定** する方式です。

#### Interface ID の生成法

MACから生成したEUI-64は追跡されやすいため、**現在はプライバシー拡張が推奨** されています。

- **EUI-64(MACアドレスから生成)**
- **RFC 4941 プライバシーアドレス(ランダム生成)**

### IPv6に必須のICMPv6(RFC 4861)

ICMPv6 は IPv6 ネットワーク制御の中心です。以下の重要機能を持ちます。

- Neighbor Discovery(IPv4 ARPに相当)
- アドレス重複検出(DAD)
- ルータ探索(RS/RA)
- パスMTUディスカバリ(PMTUD)

**ICMPv6をFWで遮断するとネットワークが正常に動作しない** ため注意が必要です。

### IPv6のセキュリティ

#### IPv6固有のリスク

- RA偽装攻撃(偽ルータによる乗っ取り)
- DHCPv6偽装
- 拡張ヘッダ悪用(FWバイパス)
- トンネリング(6to4、Teredo)悪用

#### 対策

- RAガード
- DHCPv6ガード
- IPv6拡張ヘッダ制御
- 不要なIPv6機能を無効化

### IPv4とIPv6の比較(試験頻出)

| 項目 | IPv4 | IPv6 |
|------|------|------|
| アドレス長 | 32bit | 128bit |
| NAT | 必須に近い | 不要 |
| ブロードキャスト | あり | 廃止 |
| 自動設定 | DHCP | SLAAC/DHCPv6 |
| セキュリティ | オプション | IPsec推奨(SHOULD) |
| ICMP | 補助的 | 中核的(NDに不可欠) |

### IPv6移行技術

| 技術 | 説明 |
|------|------|
| **デュアルスタック** | IPv4/IPv6の併用です(最も一般的) |
| **6to4/ISATAP/Teredo** | IPv6をIPv4トンネル内で運ぶ方式です |
| **NAT64/DNS64** | IPv6-only環境からIPv4サーバへ接続します |

## MPLS(Multiprotocol Label Switching)

パケットにラベルを付与し、そのラベルに基づいて高速に転送する仕組みです。

### 特徴

* ラベルスイッチングにより高速転送します
* L2とL3の中間的な技術です(Layer 2.5と呼ばれます)
* ISPのVPNサービス(IP-VPN)で利用されます
* QoS(DiffServ)やトラフィックエンジニアリングに強い技術です

### MPLSの構成要素

|名称|意味|
|:----|:----|
|LSR(Label Switch Router)|MPLSラベルを見て転送するルータです|
|LER(Label Edge Router)|MPLSネットワークの入口・出口でラベル付加・削除を行います|
|FEC(Forwarding Equivalence Class)|ルーティンググループです|
|LSP(Label Switched Path)|MPLS上の経路です|

### L3VPNとL2VPN(MPLS)

|種別|仕組み|
|:----|:----|
|MPLS L3 VPN|MP-BGP で経路交換します(IP-VPN)|
|MPLS L2 VPN|VPLS、VPWSを使用します|

### NGN(Next Generation Network)

* MPLSをベースとしたキャリア網です
* QoSと制御が強力です

## PPP(Point-to-Point Protocol)

2拠点間の通信リンクでデータを送受信するためのデータリンク層プロトコルです。

### 特徴

* 認証機能(PAP/CHAP)があります
* エラー検出を行います
* LCP(リンク制御)とNCP(ネットワーク制御)で構成されています
* ダイヤルアップ接続(アナログ回線/ISDN)で使用されてきました

### PPPの構成プロトコル

|プロトコル|役割|
|:----|:----|
|LCP(Link Control Protocol)|リンクの確立・維持・切断|
|NCP(Network Control Protocol)|IP、IPXなどネットワーク層の設定|
|PAP(Password Authentication Protocol)|平文認証|
|CHAP(Challenge Handshake Authentication Protocol)|挑戦応答方式の安全な認証|

## PPPoE(PPP over Ethernet)

イーサネット上でPPPをカプセル化する方式です。

### 特徴

* 主に家庭のインターネット接続(ADSL/FTTH)で使用されます
* ISPの認証をPPPのPAP/CHAPによって実施します
* Ethernetフレーム内にPPPフレームを格納(カプセル化)します

## PPTP(Point-to-Point Tunneling Protocol)

PPPフレームをIPネットワーク上でトンネル化し、仮想専用線(VPN)を実現する技術です。

### 特徴

* PPPをGREトンネルでカプセル化します
* Microsoftが主導して普及しました
* 古いVPN技術で、現在はセキュリティ上非推奨です

### L2TP(Layer 2 Tunneling Protocol)

* PPTPとL2Fを統合した後継技術です
* 暗号化機能はないためIPsecとセットで利用します(L2TP/IPsec)

### GRE(Generic Routing Encapsulation)

* 任意のL3パケットをカプセル化します
* PPTPの内部でも使用されています

### 認証方式

|認証方式|特徴|
|:----|:----|
|PAP|平文パスワードのため非推奨です|
|CHAP|Challenge-Response方式で盗聴に強いです|
|MS-CHAPv2|PPTPで使用されますが、重大な脆弱性があります|

## SSL/TLSとSSL-VPN

### SSLとは(基礎定義)

#### SSLの定義

- RFC 6101(SSL 3.0)
- 現行標準：TLS 1.2/TLS 1.3(RFC 5246/RFC 8446)
- IPA「暗号技術ガイドライン」

**SSL(Secure Sockets Layer)とは、TCP/IP上で通信内容の盗聴/改ざん/なりすましを防止するための暗号化通信プロトコルです。**

現在は **TLS(Transport Layer Security)** が正式名称です。

### SSLが提供するセキュリティ機能(CIA観点)

| セキュリティ要件 | 実現方法 |
|---|---|
| 機密性(Confidentiality) | 共通鍵暗号による通信暗号化 |
| 完全性(Integrity) | MAC(HMAC)による改ざん検知 |
| 認証(Authentication) | デジタル証明書(X.509) |
| 否認防止(限定的) | 電子署名(主にサーバ認証) |

**通信経路の安全性を確保する仕組み** です。

### SSLの動作概要(ハンドシェイク)

#### SSL/TLS ハンドシェイクの流れ(簡略)

1. クライアント → サーバ：対応暗号方式提示
2. サーバ → クライアント：証明書送信
3. クライアント：証明書検証(CAチェーン)
4. 共通鍵生成/共有
5. 暗号化通信開始

**公開鍵暗号＋共通鍵暗号のハイブリッド方式** です。

### TLSとSSLの違い

| 項目 | SSL | TLS |
|---|---|---|
| 状態 | 廃止 | 現行標準 |
| 安全性 | 低い | 高い |
| 試験表記 | SSL | SSL/TLS |

### SSL-VPN装置とは

**SSL-VPN装置とは、SSL/TLS技術を利用して、インターネット経由で安全なリモートアクセスを提供するVPN装置です。**
(エビデンス：IPAネットワークセキュリティ解説、NIST SP 800-77)

### SSL-VPNの仕組み

#### 基本構成

```
[社外端末]
↓(HTTPS/TLS)
[SSL-VPN装置]
↓
[社内ネットワーク]
```

- 通信は **HTTPS(TCP 443)** です
- Webブラウザまたは軽量クライアントを使用します

### SSL-VPNの接続方式

| 方式 | 特徴 |
|---|---|
| クライアントレス型 | Webブラウザのみで利用可能です |
| クライアント型 | 専用ソフトを利用し高機能です |
| ポータル型 | Web画面から社内資源へアクセスします |

### SSL-VPNが選ばれる理由(試験頻出)

#### ファイアウォール越えが容易

- TCP 443(HTTPS)は多くの環境で許可済みです
- IPsec(UDP 500/4500)より制約が少ないです

外出先/公衆Wi-Fiからでも利用可能です。

#### 端末依存性が低い

- OS標準ブラウザで動作します
- 管理者権限不要な場合が多いです

### IPsec-VPNとの比較(理解必須)

| 項目 | SSL-VPN | IPsec-VPN |
|---|---|---|
| 使用層 | トランスポート層以上 | ネットワーク層 |
| 使用ポート | TCP 443 | UDP 500/4500 |
| 導入容易性 | 高い | 低い |
| 利用形態 | リモートアクセス向き | 拠点間接続向き |
| ファイアウォール通過 | 容易 | 制限されやすい |

### SSL-VPN装置のセキュリティ機能

- 利用者認証(ID/パスワード、証明書、OTP)
- アクセス制御(URL/アプリ単位)
- ログ取得/監査
- 端末チェック(ウイルス対策状況など)

### SSL-VPNの注意点/リスク

#### 利用者端末の安全性

- マルウェア感染端末からの接続
- キーロガーによる情報漏えい

**端末認証/多要素認証が重要** です。

### IPsec

* VPNの標準です
* 暗号化(ESP)
* 認証(AH)
* IKE(鍵交換)
* 企業VPNのデファクトです

## マルチキャスト

### マルチキャストの概要

1つの送信者が、特定の多数の受信者に効率的にデータを配信する方式です。RFC 1112で正式に規定され、IPv4では224.0.0.0 ~ 239.255.255.255がマルチキャストアドレスです。上記IPアドレスの範囲はClass Dに該当します。

### IPアドレス別の分類

|範囲|名称|説明|
|:----|:----|:----|
|224.0.0.0/24|ローカルネットワーク制御用|ルータプロトコル(OSPF、RIP2、HSRPなど)|
|224.0.1.0 ～|インターネット全体に拡散可能|NTPなど|
|239.0.0.0/8|組織内・プライベートマルチキャスト|社内配信など|

### IPアドレスのクラス

接続可能なホスト台数の算出では、「ホスト部をすべて「0」にしたネットワークアドレス」と「ホスト部をすべて「1」にしたブロードキャストアドレス」を2台分引きます。

|クラス|プライベートIPアドレスの範囲|ネットワーク部|ホスト部|接続可能なホスト台数|対象ネットワーク|
|:----|:----|:----|:----|:----|:----|
|A|10.0.0.0～10.255.255.255|8ビット|24ビット|16,777,214台|大規模|
|B|172.16.0.0～172.31.255.255|16ビット|16ビット|65,534台|中規模|
|C|192.168.0.0～192.168.255.255|24ビット|8ビット|254台|小規模|

**接続可能なホスト台数 = 2^ホストのビット数 - 2**

### ユニキャスト/ブロードキャスト/マルチキャストの違い

|種類|送信対象|特徴|
|:----|:----|:----|
|ユニキャスト|1対1|通常のIP通信です|
|ブロードキャスト|同一L2ネットワーク全員|ルータを越えません|
|マルチキャスト|1対多|加入者だけが受信/ルータ越え可能です|

### IGMP(Internet Group Management Protocol)

受信側がマルチキャストグループへの参加/離脱をルータに通知するプロトコルです。IGMPの役割は以下のとおりです。

1. 受信者が参加を表明します
2. ルータは配信ツリーを構築します
3. 不要になると離脱(Leave Report)を送信します

#### IGMPスヌーピング(IGMP Snooping)

Layer2スイッチが IGMP メッセージを解析して、マルチキャストフレームを必要なポートのみに転送する機能です。これにより、無駄なトラフィックをネットワーク全体に流さず、帯域の無駄遣いを防止します。

### マルチキャストルーティング(PIM)

マルチキャストはユニキャストと異なり、特別なルーティングが必要です。PIMの役割は以下のとおりです。

* マルチキャスト用の転送ツリー(配信経路)を構築します
* ルータ間のマルチキャスト経路管理を行います

#### 代表的なプロトコル

* PIM-SM(Sparse Mode)
* PIM-DM(Dense Mode)

### L2マルチキャスト(マルチキャストMACアドレス)

IPv4マルチキャストアドレスは特定の規則でMACアドレスに変換されます。

* IPマルチキャストの下位23ビットをMACに埋め込みます
* 完全な1対1マッピングではなく重複(オーバラップ)があり得ます

変換ルール：
```TEXT
01:00:5E:00:00:00 ～ 01:00:5E:7F:FF:FF
```

### TTLとマルチキャストの伝搬範囲

TTL(Time To Live)とは、寿命を表し、一般的には伝搬範囲を指しています。マルチキャストパケットにもTTLが存在し、例は下記のとおりです。

- TTL 1：ローカルネット内のみ
- TTL 32：組織内で利用
- TTL 255：Internet全体へ

**TTLを誤設定すると、局所配信のつもりが広範囲へ流れてしまうため要注意です。**

## DNS(Domain Name System)

### DNSの役割(RFC 1034/RFC 1035)

DNSは、**ドメイン名とIPアドレスなどの各種情報を対応付ける分散型データベースシステム** です。

主な役割は以下のとおりです。

- ドメイン名 → IPアドレス(A/AAAA)
- メール配送先の決定(MX)
- 権威情報/管理情報の提供(SOA)
- 各種サービス情報の提供(TXT、SRV等)

DNSは **階層構造(ルート → TLD → 権威DNS)** を持つ分散管理方式です。

### MXレコード(Mail Exchanger Record)

#### 定義と目的(RFC 5321/RFC 1035)

**MXレコード** は、**そのドメイン宛の電子メールをどのメールサーバに配送するかを指定するDNSレコード** です。つまり、「このドメインのメールは、どのサーバが受信担当か」を示す役割を持ちます。

#### MXレコードの構造

例：

```
example.com. MX 10 mail1.example.com.
example.com. MX 20 mail2.example.com.
```

構成要素は以下のとおりです。

| 要素 | 意味 |
|---|---|
| 優先度(Preference) | 数値が小さいほど優先です |
| メールサーバ名 | 実際にメールを受信するホスト名です |

#### 優先度(Preference)の意味

- 数値が **小さい方が優先** です
- 第一サーバ障害時に、第二/第三サーバへフォールバックします

例：

- `10` → プライマリ
- `20` → バックアップ

#### 試験での重要ポイント(MX)

- **MXレコードは「メール配送経路」を制御** します
- IPアドレスは直接書きません(A/AAAAで解決)
- SMTPサーバは **MXレコードを参照して配送先を決定** します

「メールサーバ自身が参照する」のではなく、**送信側SMTPサーバがDNSを引く** 点が頻出の引っかけです。

### SOAレコード(Start of Authority Record)

#### 定義(RFC 1035)

**SOAレコード** は、**そのDNSゾーンに関する「管理情報の起点」を示すレコード** です。つまり、「このゾーンの責任者は誰か」「ゾーン情報はどのように管理されているか」を定義しています。

#### SOAレコードの構造

例：

```
example.com. SOA ns1.example.com. admin.example.com. (
2024010101 ; Serial
3600 ; Refresh
900 ; Retry
604800 ; Expire
86400 ; Minimum
)
```

#### 各フィールドの意味

| フィールド | 意味 |
|---|---|
| MNAME | プライマリDNSサーバ |
| RNAME | 管理者メールアドレス(@は.で表記) |
| Serial | ゾーンファイルの版数 |
| Refresh | セカンダリDNSが更新確認する間隔 |
| Retry | 再試行間隔 |
| Expire | ゾーン情報の有効期限 |
| Minimum | ネガティブキャッシュTTL |

#### 試験で特に問われる点(SOA)

- **Serial番号が更新管理の要** です
- セカンダリDNSは **Serialの増加で変更を検知** します
- SOAは **ゾーンごとに必ず1つ存在** します

「SOAは名前解決用」ではなく、**DNS運用/同期管理用レコード** です。

### MXレコードとSOAレコードの違い(整理)

| 観点 | MX | SOA |
|---|---|---|
| 主目的 | メール配送制御 | ゾーン管理 |
| 参照主体 | 送信SMTP | DNSサーバ |
| 設定数 | 複数可 | 原則1つ |
| 試験頻度 | 高 | 非常に高 |

### DNSの主なレコード

#### A/AAAAレコード

- A：IPv4アドレスです
- AAAA：IPv6アドレスです

#### NSレコード

- ゾーンを管理する権威DNSサーバを指定します

#### CNAMEレコード

- 別名(エイリアス)定義です
- MXの参照先には **CNAMEは不可です(RFC制約)**

#### TXTレコード

- 任意文字列です
- SPF/DKIM/DMARCで利用されます

#### PTRレコード

- IP → ドメイン名(逆引きDNS)です
- メールのスパム対策で重要です

### DNSのセキュリティ観点

- **MX誤設定** → メール不達/スパム対策失敗
- **SOA Serial未更新** → DNS変更が反映されません
- **DNS自体は改ざん対策が弱い** → DNSSECで補完します

## リモートアクセス環境の情報セキュリティ

### リモートアクセス環境とは

リモートアクセスとは、**組織外(在宅/出張/モバイル)から内部ネットワークに安全に接続する仕組み** です。

主な方式は以下のとおりです。

- **VPN(Virtual Private Network)**
  - IPsec-VPN(RFC 4301)
  - SSL-VPN(TLSベース)
- **SSH(RFC 4251)**
- **リモートデスクトップ(RDP/VDI)**
- **ZTNA(Zero Trust Network Access)**

試験では特に「VPNで内部LANへ接続し、RDPで社内PCへアクセスする方式」のリスクが問われました。

### リモートアクセスの脅威(NIST SP 800-46/JPCERT)

#### 認証情報の漏洩

- パスワード単独利用
- 辞書攻撃/総当たり
- フィッシングによる窃取
- 中間者攻撃による盗聴

#### 脆弱なRDP設定

- ポート3389/TCPの直接公開
- NLA無効
- 古い暗号強度の利用
- ブルートフォース攻撃

#### マルウェア端末の接続

感染端末がVPN経由で内部へ侵入するリスクです。

#### VPN設定の不備

- 分離されていないアクセス制御(フルアクセス)
- 証明書不備によるMITM攻撃
- 暗号スイートの弱さ(DES/RC4)

### リモートアクセスで必須となる安全対策

#### 強固な認証(NIST SP 800-63B)

- **多要素認証(MFA)** の導入
  - TOTP(Google Authenticator)
  - ハードウェアトークン
  - FIDO2

VPN/RDP ともに MFA が標準です。

#### 端末の健全性確認(NIST SP 800-46)

- EDR/ウイルス対策
- OS/アプリの最新化
- 不正端末(BYOD)の排除
- デバイス証明書による端末認証

#### 通信の暗号化

**推奨暗号スイート：**

- TLS 1.2/TLS 1.3(RFC 8446)
  - AES-GCM
  - ECDHE(Perfect Forward Secrecy)

- IPsec
  - IKEv2
  - AES-GCM
  - SHA-2

#### アクセス制御

**ゼロトラストの考え方：必要最小限のみ許可** します。

例：

- RDPサーバのみアクセス許可
- 管理者ネットワークの分離
- アプリ単位の接続制御(ZTNA)

#### ログ監視/異常検知

記録するログ例は以下のとおりです。

- VPN接続ログ(成功/失敗、IP)
- RDPログ
- 認証ログ
- SIEMでの相関分析

不正兆候例は以下のとおりです。

- 同一アカウントの複数拠点同時アクセス
- 深夜帯の不審ログイン
- 失敗回数の急増

#### RDPの安全設定(NIST SP 800-114)

|設定項目|理由|
|--------|------|
|NLA有効化|認証前にセッション確立を防止します|
|3389/TCPを公開しない|ブルートフォース攻撃の主要対象です|
|VPN経由のみ許可|インターネットから遮断します|
|クリップボード無効|データ持ち出し防止です|
|アカウントロックアウト|破られる前にアカウント停止します|

### リモートアクセス方式別の比較

|方式|安全性|特徴|
|----|------|------|
|IPsec-VPN|高|組織ネットワーク全体へ接続します。企業で主流です|
|SSL-VPN|中～高|アプリ単位アクセスも可能です|
|RDP|中|設定次第で危険性があります|
|VDI|高|データは端末に残りません|
|SSH|高|管理者用途として最重要です|

### リモートアクセスの周辺知識(試験頻出)

#### Zero Trust Architecture(NIST SP 800-207)

- 「信頼しない」を前提とします
- 認証/認可を継続的に実施します
- VPNの代替として普及しています

#### SASE

- ネットワークとセキュリティのクラウド統合です
- ZTNA + SWG + CASB などで構成されます

#### BYODリスク

- 不正アプリ
- パッチ未適用
- 情報漏洩

#### SSH(RFC 4251)

- 鍵認証が推奨されます
- パスワード認証は禁止推奨です
- ポートフォワーディング機能に注意が必要です
