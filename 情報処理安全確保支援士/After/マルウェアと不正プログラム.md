# マルウェアと不正プログラム ― ウイルス分類/ダウンローダ/Mirai/検知技術/Rootkit/クリプトジャッキングの体系的整理

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年秋の情報処理安全確保支援士に向けて勉強中です。
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/a25279a17b210d6ed9f4)」をご参照ください。
**本記事は学習した内容を記載しています。**

## 該当問題

[情報セキュリティスペシャリスト平成24年秋期 午前Ⅱ 問7](https://www.sc-siken.com/kakomon/24_aki/am2_7.html)
[情報セキュリティスペシャリスト平成25年春期 午前Ⅱ 問3](https://www.sc-siken.com/kakomon/25_haru/am2_3.html)
[情報セキュリティスペシャリスト平成27年春期 午前Ⅱ 問12](https://www.sc-siken.com/kakomon/27_haru/am2_12.html)
[情報セキュリティスペシャリスト平成27年秋期 午前Ⅱ 問16](https://www.sc-siken.com/kakomon/27_aki/am2_16.html)
[情報処理安全確保支援士平成30年秋期 午前Ⅱ 問11](https://www.sc-siken.com/kakomon/30_aki/am2_11.html)
[情報処理安全確保支援士平成31年春期 午前Ⅱ 問5](https://www.sc-siken.com/kakomon/31_haru/am2_5.html)

## コンピュータウイルスの分類

### ポリモーフィック型ウイルス(Polymorphic Virus)

#### 定義

ポリモーフィック型ウイルスとは、**自己複製時に暗号化やコード変形を行い、毎回異なる形に変化するウイルス**です。
ウイルス本体は暗号化され、復号ルーチンも変形するため、シグネチャ型検知の回避を目的とします。

根拠：

- 1990年代以降、暗号化技術を利用したウイルスが登場し "polymorphic engine" として研究対象
- Symantec セキュリティレポートでも「検知回避技術の代表例」として分類

#### 特徴

- 暗号化された本体 + 変形する復号ルーチン
- シグネチャベースの検知(特定バイト列の検知)を無効化
- エンジン部分のみを改良し、多数の亜種を生成可能
- 検知には**エミュレーション**や**静的解析＋ふるまい分析**が必要

#### ポリモーフィックウイルスの代表例

- **Cascade**(1987)暗号化型ウイルスの初期例
- **Storm Worm(2007)** ポリモーフィック生成により亜種数百万以上
- 現代のマルウェア(Emotet など)も類似技術を利用

### ステルス型ウイルス(Stealth Virus)

#### 定義

ステルス型ウイルスとは、**感染の痕跡を隠蔽し、OS/アンチウイルス/ユーザから検知されにくくするウイルス**です。

#### 代表的なステルス手法

| 手法 | 内容 |
|------|-------|
| **ファイルサイズ偽装** | 感染時に元ファイルサイズを報告し、改変を隠す |
| **ディスク読込介入** | OSの I/O 要求を改ざんし、感染領域を非感染に見せる |
| **メモリ常駐型** | AV ソフトより先にロードし、検出処理を妨害 |
| **ルートキット化** | プロセス一覧/TCP接続/ファイルを隠す |

#### ステルスウイルスの例

- **Frodo 4096**(MS-DOSステルスウイルスの代表格)
- **TDL4**(高度なrootkit機能による隠蔽)

### マルチプラットホーム型ウイルス(Multi-platform/Cross-platform Virus)

#### 定義

マルチプラットホーム型ウイルスとは、**複数のOS(Windows/Linux/macOS 等)で動作するウイルス**です。

#### 特徴

- プログラム言語や共通実行環境(Java VM/Python/.NET/Flash/ブラウザ)を利用
- OS に依存しない攻撃が可能
- 標的範囲が広く、攻撃の成功率が高い
- Webベース(HTML5/JavaScript)でのマルウェアも増加

#### マルチプラットホームウイルスの例

- **Java.ByteVerify**(Java VMを悪用)
- **CrossRat**(Windows/Linux/macOS対応)
- **Script型マルウェア(JS/HTML5系)**

### メタモーフィック型ウイルス(Metamorphic Virus)

ポリモーフィックよりさらに高度な変形型です。
**復号ルーチンを持たず、ウイルス本体が毎回完全に別コードへ自動書き換え**されます。

### マクロウイルス(Macro Virus)

Excel/Word などの VBA を悪用したウイルスです。
OS に依存しないためマルチプラットホーム型の性質を持ちます。

## マルウェアの種類(全体分類)

| 種類 | 説明 |
|------|------|
| トロイの木馬 | 正規ソフトを装う不正プログラム。自律的に増殖しない |
| ワーム | 自己増殖して拡散 |
| バックドア | 遠隔操作用の裏口を作成 |
| ボット | C2から命令を受ける端末 |
| キーロガー | キー入力を盗む |
| ランサムウェア | ファイルを暗号化し金銭要求。WannaCry 等が有名 |
| ダウンローダ | **他のマルウェアを落とす役割** |
| ドロッパー | 本体を自分の内部に含んでいる |

### ダウンローダとドロッパーの違い

| 種類 | 特徴 |
|------|------|
| ダウンローダ | 感染後に本体を外部から取得 |
| ドロッパー | 本体を内部に抱えており即展開 |

## ランサムウェア（Ransomware）

### ランサムウェアの定義

ランサムウェアとは、**被害者のファイルやシステムを暗号化し、復号と引き換えに身代金（Ransom）を要求するマルウェア** です。近年の情報処理安全確保支援士試験で最も出題頻度の高いマルウェアカテゴリです。

### ランサムウェアの暗号化方式（試験頻出）

ランサムウェアは **ハイブリッド暗号方式** を使用します。

```
① 攻撃者：RSA鍵ペア（公開鍵/秘密鍵）を生成
② ランサムウェア：ファイルごとにAES共通鍵を生成しファイルを暗号化
③ ランサムウェア：AES共通鍵をRSA公開鍵で暗号化して保存
④ 攻撃者：身代金受領後にRSA秘密鍵を提供（する場合もある）
```

**試験ポイント**：ファイル暗号化には高速な **共通鍵暗号（AES）** を使用し、その共通鍵を **公開鍵暗号（RSA）** で暗号化するため、攻撃者の秘密鍵なしには復号不可能です。

### ランサムウェアの進化と分類

| 世代 | 特徴 | 代表例 |
|---|---|---|
| 第1世代：画面ロック型 | 画面をロックし身代金を要求（暗号化なし） | WinLocker |
| 第2世代：暗号化型 | ファイルを暗号化し身代金を要求 | CryptoLocker |
| 第3世代：**二重脅迫型** | 暗号化 ＋ データ窃取・公開脅迫 | **Maze、REvil、LockBit** |
| 第4世代：**多重脅迫型** | 暗号化 ＋ データ公開 ＋ DDoS脅迫 ＋ 取引先通知 | BlackCat/ALPHV |

#### 二重脅迫（ダブルエクストーション）

- **暗号化** によるシステム停止 ＋ **データ公開** による情報漏洩の二重の脅迫
- バックアップから復旧しても **窃取データの公開** が脅迫材料となる
- リークサイト（ダークウェブ）に被害組織のデータを公開する手法

**試験ポイント**：二重脅迫型では、バックアップだけでは対策として不十分であり、**データの窃取防止（出口対策）** も必要です。

### RaaS（Ransomware as a Service）

**RaaS** とは、ランサムウェアを **サービスとして提供するビジネスモデル** です。

| 役割 | 説明 |
|---|---|
| **RaaS運営者（開発者）** | ランサムウェア本体・管理パネル・リークサイトを提供 |
| **アフィリエイト（実行者）** | 実際の侵入・感染を実行。身代金の一部を報酬として受領 |

- 技術力のない攻撃者でもランサムウェア攻撃が可能
- 身代金は **暗号資産（Bitcoin/Monero）** で支払われ追跡が困難

### WannaCry（2017年：試験頻出事例）

| 項目 | 内容 |
|---|---|
| 悪用脆弱性 | **EternalBlue**（Windows SMBv1の脆弱性：MS17-010） |
| 拡散方法 | ネットワーク経由で自動拡散（**ワーム型ランサムウェア**） |
| 被害規模 | 150か国以上、20万台以上のPC |
| ポート | **TCP 445（SMB）** |
| 教訓 | パッチ適用の重要性、不要ポート（445）の閉鎖 |

**試験ポイント**：WannaCryはランサムウェアでありながら **ワーム型の自己拡散能力** を持つ点が特徴です。SMBv1の脆弱性を悪用してネットワーク内で自動感染しました。

### ランサムウェアの主な侵入経路（午後問題で頻出）

| 経路 | 説明 |
|---|---|
| **VPN機器の脆弱性** | SSL-VPN装置（FortiGate等）の未パッチ脆弱性を悪用 |
| **RDPの公開** | TCP 3389の直接公開 ＋ ブルートフォース |
| **フィッシングメール** | マクロ付きOfficeファイル、URL経由 |
| **サプライチェーン** | 取引先・MSP経由での侵入 |

### ランサムウェア対策

#### 予防策

- **3-2-1バックアップルール**：3つのコピー、2種類のメディア、1つはオフサイト保管
- **オフラインバックアップ**：ネットワークから切り離した状態で保管（ランサムウェアによる暗号化防止）
- VPN機器/RDP等のパッチ適用と設定強化
- 多要素認証（MFA）の導入
- ネットワークセグメンテーション（横展開防止）
- メールフィルタリング（マクロ付きファイルの遮断）

#### 感染時の対応

1. **ネットワークからの隔離**（感染拡大防止）
2. 被害範囲の特定
3. バックアップからの復旧
4. **身代金は支払わないことが推奨**（NISC/IPA/FBI方針）
5. インシデント報告（個人情報保護委員会への報告義務の確認）
6. フォレンジック調査による侵入経路の特定

## ダウンローダ型マルウェア(Downloader Malware)

### 定義

ダウンローダ型マルウェア(Downloader)とは、**自身は本体の一部機能しか持たず、感染後に外部サーバから追加のマルウェア(本体)をダウンロードして実行するマルウェアを指します。**
IPA では「二次感染を引き起こすマルウェア」として分類されています。

代表的な攻撃目的：

- 追加のバックドアや遠隔操作ツール(RAT)をインストールする
- ランサムウェアのダウンロード
- クレデンシャル窃取ツール(情報窃取型マルウェア)の展開
- ボットネットへの組み込み

### ダウンローダ型マルウェアの主な特徴

#### サイズが小さい

ダウンローダは本体ではなく「落としてくるだけ」のため非常に小型です。

#### ネットワーク経由で本体を取得

攻撃者のC2(Command & Control)サーバに接続し本体を取得します。

#### 感染端末を継続的に悪用できる

追加マルウェアの更新や追加感染が可能です。

#### 攻撃者が証跡を隠蔽しやすい

マルウェア本体は都度ダウンロードされるため、ファイルの痕跡が少ないです。

### ダウンローダ型マルウェアの侵入経路

#### メール添付(Emotet など)

Officeマクロ、ZIP添付、暗号化ZIPなどです。

#### Web 経由(ドライブバイダウンロード)

脆弱性を悪用しユーザ操作なしで感染します。

#### 正規ソフトを装う偽インストーラ

ユーザが自らダウンロードしてしまうパターンもあります。

#### USB などのリムーバブルメディア

### ダウンローダ型マルウェアの行動

| 攻撃段階 | Downloader の行動 | MITRE Technique |
|----------|------------------|-----------------|
| 初期感染 | 添付ファイル/脆弱性で侵入 | T1566, T1204 |
| 外部通信 | C2サーバへ接続 | T1071 |
| ダウンロード | 本体マルウェアを取得 | **T1105** |
| 実行 | 本体マルウェアを起動 | T1059 |
| 永続化 | レジストリ改ざんなど | T1547 |

### ダウンローダが落とす代表的なマルウェア

#### バックドア(RAT)

- 遠隔操作、ファイル窃取
- キーロギング
- 端末の完全制御

#### ランサムウェア

- データ暗号化
- 金銭要求

#### 情報窃取型(Credential Stealer)

- パスワード
- ブラウザデータ
- Cookie やセッション情報

#### ボット化(Bot/Botnet)

- 大量送信(スパム)
- DDoS 攻撃の踏み台化

### ダウンローダ対策(IPA「安全なパソコン利用」)

#### 入り口対策

- 添付ファイルのマクロ無効化
- URL フィルタリング
- メールゲートウェイでのマルウェア検知

#### 実行防止(EDR/AMソフト)

- 挙動監視(スクリプト/不審プロセス)
- EDR による通信先監視

#### 出口対策

- 不正通信のブロック(C2 への通信遮断)
- DNS フィルタリング
- プロキシログの監視

#### 多層防御(Defense in Depth)

- パッチ管理
- 権限最小化(ローカル管理者禁止)
- 不審通信の SIEM 監視

## マルウェア「Mirai」

### 定義

**Mirai は、IoT 機器を感染させてボットネットを構成し、大規模な DDoS 攻撃を実行するマルウェア**です。

- IPA(情報処理推進機構)
- JPCERT/CC
- 複数のセキュリティベンダ分析レポート

### 発見と社会的影響

- **2016年に大規模被害を引き起こし注目**
- DNS サービス事業者(Dyn)への攻撃で、Twitter/GitHub/Netflix などが一時利用不能に

**「IoT x DDoS」時代の象徴的マルウェアです。**

### IoT 機器を標的とする

Mirai が狙う代表例：

- ネットワークカメラ
- ルータ
- デジタルビデオレコーダ(DVR)

共通点：

- 常時インターネット接続
- OS が Linux 系
- 管理者設定が不十分

### デフォルト認証情報の悪用

Mirai の最大の特徴は下記です。

- **初期設定の ID/パスワードを総当たり**
  - admin/admin
  - root/12345
  - root/password など

**脆弱性ではなく「設定不備」を突く**点が重要です。

### 自己拡散型マルウェア

Mirai は感染後、下記のような動作をします。

1. インターネット上をスキャン
2. 他の IoT 機器を探索
3. 同様の方法で感染を拡大

**ワーム型の性質**を持ちます。

### Mirai の動作構造

#### 全体構成

Mirai は以下の要素で構成されます。

```
攻撃者
↓
C&Cサーバ
↓
Mirai感染IoT(ボット)
↓
DDoS攻撃対象
```

#### 感染から攻撃までの流れ

1. IoT 機器に侵入(Telnet/SSH)
2. Mirai 本体をダウンロード
3. C&C サーバに接続
4. 攻撃命令を待機
5. 指示に従い DDoS 攻撃を実行

### Mirai の最終目的：DDoS 攻撃

#### 実行される攻撃手法

Mirai が実行可能な攻撃例：

- TCP SYN Flood
- UDP Flood
- HTTP Flood
- GRE Flood

**単体は弱くても、数十万台規模で威力を発揮します。**

#### なぜ IoT が DDoS に向くのか

| 理由 | 説明 |
|---|---|
| 常時稼働 | 電源が切られにくい |
| 管理不十分 | パスワード未変更 |
| 世界中に分散 | トラフィック遮断が困難 |
| 台数が多い | 攻撃規模が巨大 |

### Mirai の派生と進化

Mirai のソースコードは **公開**されました。

その結果：

- 多数の亜種(派生マルウェア)が登場
- 新たな IoT マルウェアの基盤に

代表的派生：

- Okiru
- Satori
- Mozi

**Mirai は単発ではなく「系譜」を持ちます。**

### Mirai 対策(試験でも問われる)

#### 基本対策

- **初期 ID/パスワードの変更**
- 不要な Telnet/SSH の無効化
- ファームウェア更新

試験では **「脆弱性修正」より「設定変更」** が正解になることが多いです。

#### ネットワーク側対策

- ISP によるトラフィック監視
- 不審通信の遮断
- DDoS 対策サービスの導入

### IoT マルウェアの位置づけ

| 種別 | 特徴 |
|---|---|
| PCマルウェア | 情報窃取/ランサム |
| IoTマルウェア | **DDoS要員化** |
| Mirai | IoT DDoS の代表例 |

### ボットネットとの関係

Mirai は下記の特徴を持ちます。

- **ボットネット型マルウェア**
- 感染端末 = ボット
- C&C により一括制御

**「Mirai = IoT版ボットネット」です。**

## 標的型攻撃（APT：Advanced Persistent Threat）

### 標的型攻撃の定義

標的型攻撃（APT）とは、**特定の組織や個人を対象に、長期間にわたり執拗に行われる高度なサイバー攻撃** です。金銭目的のばらまき型攻撃とは異なり、**知的財産・機密情報の窃取** や **インフラ破壊** を目的とします。

### Cyber Kill Chain（Lockheed Martin モデル：試験頻出）

標的型攻撃の段階を7つのフェーズで整理したフレームワークです。

| フェーズ | 名称 | 内容 | 対策例 |
|---|---|---|---|
| 1 | **偵察（Reconnaissance）** | 標的の情報収集（SNS、Whois、DNS等） | OSINT対策、公開情報の最小化 |
| 2 | **武器化（Weaponization）** | エクスプロイト＋マルウェアの作成 | （攻撃者側のため直接防御困難） |
| 3 | **配送（Delivery）** | 標的型メール、水飲み場攻撃、USB等で配送 | メールフィルタ、URLフィルタ |
| 4 | **攻撃（Exploitation）** | 脆弱性の悪用によるコード実行 | パッチ適用、脆弱性管理 |
| 5 | **インストール（Installation）** | マルウェアのインストール・永続化 | EDR、アプリケーションホワイトリスト |
| 6 | **C2（Command & Control）** | 攻撃者との通信チャネル確立 | C2通信の検知・遮断、プロキシ監視 |
| 7 | **目的実行（Actions on Objectives）** | 情報窃取、破壊、改ざん等の目的達成 | DLP、ログ監視、異常検知 |

**試験ポイント**：Kill Chainの考え方は「**どの段階で攻撃チェーンを断ち切るか**」が重要です。早い段階で検知・遮断するほど被害を軽減できます。

### 標的型攻撃の主な手法

#### 標的型メール攻撃

- 特定の個人/組織に向けてカスタマイズされたメールを送信
- **業務関連の件名・本文** で開封を誘導（例：「請求書送付」「人事異動のお知らせ」）
- 添付ファイル（マクロ付きOffice、PDF、実行ファイル偽装）またはURL

#### 水飲み場攻撃（Watering Hole Attack）

- 標的がよく閲覧する **正規Webサイトを改ざん** し、マルウェアを仕掛ける
- 正規サイトへのアクセスで感染するため、URLフィルタでの検知が困難
- **ドライブバイダウンロード** と組み合わせて使用される

#### サプライチェーン攻撃

- ソフトウェア更新機能やMSP（マネージドサービスプロバイダ）経由で侵入
- 正規の更新チャネルを悪用するため、信頼済みソースからの感染となる
- 代表例：**SolarWinds事件（2020年）** ── 正規アップデートにバックドアを混入

### MITRE ATT&CK フレームワーク

**MITRE ATT&CK** は、攻撃者の戦術（Tactics）と技法（Techniques）を体系的に整理したナレッジベースです。

#### ATT&CK の構造

| 要素 | 説明 |
|---|---|
| **Tactics（戦術）** | 攻撃者の目的（初期アクセス、実行、永続化、権限昇格等）：14カテゴリ |
| **Techniques（技法）** | 戦術を実現する具体的手法（T1566：フィッシング等） |
| **Sub-techniques** | 技法のさらに詳細な分類 |
| **Procedures** | 特定の攻撃グループによる実際の実装例 |

#### 主要な戦術（Tactics）一覧

| ID | 戦術 | 説明 |
|---|---|---|
| TA0001 | Initial Access | 初期侵入 |
| TA0002 | Execution | コード実行 |
| TA0003 | Persistence | 永続化 |
| TA0004 | Privilege Escalation | 権限昇格 |
| TA0005 | Defense Evasion | 防御回避 |
| TA0006 | Credential Access | 認証情報窃取 |
| TA0007 | Discovery | 内部偵察 |
| TA0008 | Lateral Movement | **横展開（ラテラルムーブメント）** |
| TA0009 | Collection | 情報収集 |
| TA0010 | Exfiltration | データ持ち出し |
| TA0011 | Command and Control | C2通信 |

**試験ポイント**：午後問題では攻撃の各段階を **ATT&CKの戦術に対応付けて** 分析することが求められます。特に **横展開（Lateral Movement）** と **権限昇格（Privilege Escalation）** は頻出です。

### 標的型攻撃への多層防御

| 対策層 | 具体策 |
|---|---|
| **入口対策** | メールフィルタリング、URLフィルタ、サンドボックス |
| **内部対策** | EDR、ネットワークセグメンテーション、特権アクセス管理（PAM） |
| **出口対策** | プロキシ監視、DLP（Data Loss Prevention）、C2通信遮断 |
| **人的対策** | 標的型メール訓練、セキュリティ意識向上教育 |
| **運用対策** | SIEM/SOCによる監視、インシデント対応計画 |

## マルウェア検知技術

### マルウェア検知方式の全体像

マルウェア検知手法は、大きく以下の 5 つに分類されます。

| 検知方式 | 特徴 | 代表用途 |
|-----------|--------|-----------|
| パターンマッチング法 | 既知のウイルスに最も強い | 従来型アンチウイルスエンジン |
| チェックサム法 | 改ざん検知に強い | ファイル監視/整合性検査 |
| コンペア法 | 正常ファイルとの差分検出 | ブート領域検査 |
| ビヘイビア法 | 挙動から悪意を判断 | EDR/Sandboxing |
| ヒューリスティック法 | 未知/亜種に強い推論方式 | 次世代 AV の中核 |

### パターンマッチング法(Signature-based Detection)

#### 定義

IPA/AV-TEST などで「**既知のマルウェアの特徴的バイト列(シグネチャ)を用いた検知方式**」と定義されています。

#### 仕組み

- マルウェアから抽出した特徴バイト列をデータベース化
- ファイルを走査し、該当シグネチャと一致すれば検知

#### 利点

- 高速/誤検知が少ない
- シンプルな検知方式

#### 欠点

- 未知/変形型ウイルスには無力
- シグネチャ更新が必須

### チェックサム法(Checksum-based Detection)

#### 定義

チェックサム法とは、**ファイルから計算したチェックサム値を正常時の値と比較**し、ファイル改ざんを検知する方式です。

#### 長所

- ファイルの改変を高精度に検出
- ブート領域/重要ファイル監査で利用可能

#### 短所

- ウイルスがチェックサム計算を迂回する場合は検出不可
- 変形型ウイルスへの耐性は低い

### コンペア法(Compare Method)

#### 定義

**正常な基準ファイル(もしくはクリーンイメージ)と比較し、差分から感染を検出する方式**です。

#### 特徴

- OS のブート領域検査/システムファイル整合性検査に利用
- 正常ファイルを常に保持する必要がある
- ステルス型ウイルスが I/O を改ざんすると回避される

### ビヘイビア法(Behavior-based Detection)

#### 定義

ビヘイビア法とは、**ファイル書き込み/プロセス生成/レジストリ改変/通信などの挙動を監視し、悪意の有無を判断する方式**です。
これは現代の **EDR(Endpoint Detection & Response)** の基礎技術です。

#### 検知対象

- 未知マルウェア
- ファイルレスマルウェア
- スクリプト型攻撃

#### 欠点

- 正常動作との線引きが難しく、誤検知が発生しやすい
- コスト/監視負荷が高い

### ヒューリスティック法(Heuristic Detection)

#### 定義

ヒューリスティック法とは、**構造解析(静的)と挙動解析(動的)により、怪しい特徴を推論し未知マルウェアを検知する方式**です。
AV製品の「次世代検知エンジン」の中心技術です。

#### 静的ヒューリスティック

下記を解析し、マルウェアらしさを評価します。

- API 呼び出し
- 自己書換コード
- 暗号化ルーチン

#### 動的ヒューリスティック

- サンドボックスにより実際に実行して評価
- ランサムウェアのファイル大量暗号化などを検出

### 検知方式の比較

| 検知方式 | 既知ウイルス | 未知ウイルス | 変形型 | 誤検知 | 主な用途 |
|-----------|--------------|--------------|--------|--------|-----------|
| パターンマッチング | ◎ | × | × | 少 | 従来型 AV |
| チェックサム法 | △ | × | × | 少 | 改変検出 |
| コンペア法 | △ | × | × | 少 | ブート領域監査 |
| ビヘイビア法 | ○ | ○ | ○ | 多 | EDR/Sandbox |
| ヒューリスティック法 | ○ | ◎ | ○ | 中 | 次世代AV |

### 変形型ウイルス(Polymorphic/Metamorphic)

下記どちらもシグネチャ型を回避します。

- **ポリモーフィック**：暗号化＋復号ルーチン変形
- **メタモーフィック**：本体コードを完全書換

### サンドボックス(Sandbox)

仮想環境でマルウェアを実行し、挙動を観察する技術です。
Emotet/ランサムウェア対策で必須です。

### EDR(Endpoint Detection & Response)

端末の動作ログを収集し、攻撃チェーンを分析/可視化する新世代防御です。

### 機械学習によるマルウェア検知

未知マルウェア分類において、ヒューリスティック＋ML が主流です。

## ファイルレスマルウェア（Fileless Malware）

### ファイルレスマルウェアの定義

ファイルレスマルウェアとは、**ディスク上にマルウェアファイルを残さず、メモリ上やOS標準ツールを利用して不正活動を行うマルウェア** です。従来のファイルスキャン型アンチウイルスでは検知が困難です。

### ファイルレスマルウェアの特徴

| 特徴 | 説明 |
|---|---|
| **ディスクに痕跡なし** | 実行ファイルを作成せず、メモリ上で動作 |
| **OS標準ツールの悪用** | PowerShell、WMI、cmd.exe等の正規ツールを利用 |
| **AV検知の回避** | シグネチャベースの検知が困難 |
| **フォレンジックの困難** | 再起動でメモリ上の痕跡が消失 |

### Living off the Land（LotL）攻撃（試験頻出）

**Living off the Land（環境寄生型）** とは、攻撃者がOS標準ツールや正規ソフトウェアを悪用して攻撃を行う手法です。

#### 悪用される代表的なツール（LOLBins）

| ツール | 悪用方法 |
|---|---|
| **PowerShell** | スクリプト実行、外部からのコード取得・実行（`Invoke-Expression`等） |
| **WMI（Windows Management Instrumentation）** | リモートコマンド実行、永続化 |
| **cmd.exe / mshta.exe** | コマンド実行、HTA（HTML Application）実行 |
| **certutil.exe** | 本来は証明書管理ツールだが、ファイルダウンロードに悪用 |
| **regsvr32.exe** | プロキシ実行（AppLocker回避） |
| **rundll32.exe** | DLL実行によるコード実行 |
| **bitsadmin.exe** | バックグラウンドでのファイルダウンロード |

**試験ポイント**：これらのツールは正規のWindows標準機能であるため、**アプリケーションホワイトリストでも遮断が困難** です。対策には **PowerShellのスクリプトブロックログ** や **Constrained Language Mode** の適用が有効です。

### ファイルレスマルウェアの攻撃フロー例

```
① 標的型メール（マクロ付きOfficeファイル）
② マクロがPowerShellを起動
③ PowerShellがC2サーバからスクリプトをダウンロード
④ メモリ上でスクリプトを実行（ディスクに書き込まない）
⑤ WMIで横展開、レジストリに永続化設定
```

### ファイルレスマルウェアへの対策

| 対策 | 説明 |
|---|---|
| **PowerShellログ（スクリプトブロックログ）** | 実行されたスクリプトの内容を記録 |
| **Constrained Language Mode** | PowerShellの機能を制限 |
| **AMSI（Antimalware Scan Interface）** | スクリプト実行時にAVエンジンでスキャン |
| **EDR** | メモリ上の不審な活動を検知 |
| **マクロの無効化** | Officeマクロのデフォルト無効化 |
| **AppLocker/WDAC** | アプリケーション実行制御 |

## C2通信技術（Command and Control）

### C2通信の概要

C2（Command and Control）通信とは、**マルウェアが攻撃者のサーバ（C2サーバ）と通信し、指令を受信したりデータを送信する通信チャネル** です。

### C2通信方式の分類

| 方式 | 特徴 | 検知難易度 |
|---|---|---|
| **HTTP/HTTPS** | Webトラフィックに紛れて通信。プロキシ経由で通信可能 | 高い（正規通信との区別困難） |
| **DNS** | DNSクエリ/レスポンスにデータを埋め込む（**DNSトンネリング**） | 高い |
| **IRC** | 古典的なボットネットで使用 | 低い（特定ポートで検知可能） |
| **P2P** | ボット間で直接通信。C2サーバの単一障害点を排除 | 高い |
| **SNS/クラウド** | Twitter/Slack等の正規サービスをC2チャネルとして利用 | 非常に高い |

### DGA（Domain Generation Algorithm：試験頻出）

DGA とは、**マルウェアが通信先ドメインを動的に生成するアルゴリズム** です。

| 特徴 | 説明 |
|---|---|
| 動作 | 日時等をシードとして大量のドメイン名を自動生成 |
| 攻撃者の運用 | 生成されるドメインの一部のみを実際に登録してC2サーバとする |
| 防御側の困難 | ブラックリストによる事前ブロックが困難（ドメインが毎日変化） |
| 検知手法 | **機械学習によるDGAドメインの特徴検知**、DNSクエリパターンの異常検知 |

代表例：**Conficker** は1日あたり約50,000個のドメインを生成しました。

### Fast Flux

Fast Flux とは、**C2サーバのIPアドレスを短い間隔で頻繁に変更する技術** です。

| 種類 | 説明 |
|---|---|
| **Single Flux** | 1つのドメインに対するAレコードを短いTTLで頻繁に変更 |
| **Double Flux** | AレコードだけでなくNSレコードも頻繁に変更 |

**対策**：DNSクエリの異常監視、短TTLレコードの検知、脅威インテリジェンスの活用

### C2通信の検知と対策

| 対策 | 説明 |
|---|---|
| **プロキシログ解析** | 不審なURL・ユーザエージェント・通信パターンの検知 |
| **DNSログ監視** | 不審なDNSクエリ（長いドメイン名、DGA特徴等）の検知 |
| **IDS/IPS** | C2通信のシグネチャ検知 |
| **脅威インテリジェンス** | 既知のC2サーバIP/ドメインとの照合（IoC活用） |
| **ネットワークフォレンジック** | ビーコン通信パターン（定期的な短い通信）の検知 |

## Rootkit(ルートキット)

### 定義

**rootkit(ルートキット)**とは、OS やミドルウェアの機能をすり替え/隠蔽することで、マルウェアや不正活動の存在そのものを隠すためのコンポーネントを指します。

- 元々は Unix 系 OS の **root(管理者権限)** を奪った攻撃者が侵入を隠すために使ったツール群が語源
- 現在では Windows/Linux/macOS/モバイルOS/UEFI/ハイパーバイザなど、広いレイヤに存在しうる **「隠蔽型マルウェア」** の総称として用いられます。

### rootkit の主な目的

1. **マルウェアの存在の隠蔽(ステルス性の確保)**
2. **継続的な不正アクセス(永続化)**
3. **追加マルウェアのインストール/制御**
4. **認証情報/機密情報の窃取**

### rootkit の種類(レイヤ別整理)

rootkit は「どのレイヤを改ざん/フックするか」で分類されます。

#### ユーザモード rootkit

- DLL インジェクション/API フックなどにより、`ps`/`netstat`/タスクマネージャ等の表示から不正プロセスを隠蔽
- アプリケーション層で完結するため実装容易だが、**OS カーネルからの検査には比較的弱い**です。

#### カーネルモード rootkit

- OS カーネル空間でドライバとして動作し、システムコールテーブル(SSDT)やカーネル関数をフックして隠蔽
- プロセス/ファイル/レジストリ/ネットワーク接続を OS レベルで隠せるため、**検出が非常に困難**

代表的技術：

- **SSDT Hook**：システムコールテーブルを書き換え、特定API呼び出しを rootkit に転送
- **Inline Hook**：関数先頭の命令を書き換えジャンプさせる
- **DKOM(Direct Kernel Object Manipulation)**：カーネル内のプロセスリストなどのオブジェクトを直接書き換え、プロセスを一覧から除外

#### Bootkit/MBR/UEFI rootkit

- MBR/VBR/UEFI など **ブートプロセス**に侵入し、OS 起動前に自身をロードするタイプ
- OS の保護機構が有効になる前に動作するため、検出と除去が困難

#### ファームウェア rootkit

- HDD/SSD/ネットワーク機器/BIOS/UEFI など、**ハードウェアファームウェア**に侵入/改変されるタイプ
- OS 再インストール後も残存する可能性があり、実務では **機器交換やファーム再フラッシュ**が必要

#### ハイパーバイザ型 rootkit

- 仮想化環境の **ハイパーバイザ層**に潜り込み、ゲスト OS 全体を監視/操作
- ゲスト OS から見えないレイヤで動作するため、非常に高いステルス性

### rootkit の代表的な隠蔽テクニック

#### API/システムコールフック

- ファイル列挙/プロセス列挙/接続一覧取得 API の戻り値を書き換え、不正プロセス/不正ファイル/不正ポートを一覧から除外

#### DKOM(Direct Kernel Object Manipulation)

- `EPROCESS` などのカーネルオブジェクトのリンクリストを書き換え、対象プロセスを OS の管理テーブルから「見えなくする」

#### ドライバロード/偽装

- 正規ドライバに見せかけたカーネルドライバをロードし、カーネル権限で任意コードを実行/隠蔽処理

#### ログ改ざん

- OS ログ/監査ログ/アプリケーションログを改ざん/削除して痕跡隠滅

### rootkit の検出技術(Anti-rootkit)

#### シグネチャベース

- 既知 rootkit のバイナリパターン/ドライバ名/レジストリ値などをもとに検出
- 新種/亜種/難読化 rootkit には限界

#### 整合性検査(インテグリティチェック)

- 「**信頼できる基準状態**」と比較して改ざんを検出する方式
  - カーネルコードセクションのハッシュ
  - システムコールテーブルの整合性
  - ファイルシステムメタデータの比較
- Trusted Boot/Secure Boot/File Integrity Monitoring とも関連

#### メモリフォレンジック

- メモリダンプを取得し、下記などを解析して検出します。
  - 隠れプロセス
  - 不正ドライバ
  - フックされた関数
- Volatility などのメモリフォレンジックツールを使用

#### 挙動分析(ビヘイビアベース)

- 権限昇格/不審なドライバロード/カーネルAPI呼び出しパターンなどを監視
- EDR(Endpoint Detection & Response)が代表例で、ログ/メモリアクセス/ネットワーク等を総合的に分析

### rootkit への対策

#### 侵入を防ぐための予防策

- OS/ミドルウェア/ドライバの **最新パッチ適用**
- 不要な管理者権限の排除(最小権限の原則)
- 正規署名ドライバのみロードする設定(Driver Signing Enforcement)
- UEFI Secure Boot を有効化し、不正ブートローダを阻止
- 不審なソフトウェア/クラックツール/怪しいドライバを導入しない

#### 感染後の対応

rootkit は OS コードレベルで汚染するため、**完全駆除が非常に困難**とされます。
実務では以下の対応が推奨されることが多いです。

1. 信頼できる外部メディアから起動し、重要データをバックアップ
2. ストレージの完全初期化と OS のクリーンインストール
3. 必要に応じてファームウェア再フラッシュ/機器交換
4. 再構築後はパッチ/設定/権限などの見直しを実施

### rootkit と他マルウェアとの関係

rootkit は単独で動作する「攻撃本体」というより、**他マルウェアのステルス化/永続化を支援するモジュール**として用いられることが多いです。

#### ボットネット＋rootkit

- C2(Command & Control)通信/スパム送信/DDoS 機能を持つボットに rootkit が組み合わされる
- rootkit がボットプロセス/通信を隠蔽し、長期潜伏を実現

#### ランサムウェア＋rootkit

- 暗号化処理の前にセキュリティ製品を無効化し、自身の痕跡を隠すために rootkit を併用

#### APT 攻撃＋bootkit/UEFI rootkit

- 国家レベル/高度標的型攻撃では、ブートプロセスやファームウェアを侵害し、**数年単位の長期潜伏**を行うケースも報告されています。

### 周辺知識(rootkit関連)

#### ユーザモード/カーネルモードの違い

| 項目 | ユーザモードマルウェア | カーネルモード rootkit |
|------|------------------------|--------------------------|
| 権限 | OSの制限あり | OS全体を支配 |
| ステルス性 | 中程度 | 非常に高い |
| 検出難易度 | 中 | 高 |

#### Secure Boot/Trusted Boot

- UEFI Secure Boot：署名付きブートローダのみ起動を許可し、bootkit や UEFI rootkit を防ぐ仕組み
- Trusted/Measured Boot：TPM に起動プロセスの測定値を保存し、リモートからの検証(Remote Attestation)を可能にする

#### EDR/XDR

- 挙動/イベントログ/メモリアクセス/ネットワーク通信を統合監視し、rootkit を含む高度な脅威を検知/対応する仕組み
- 従来型 AV の「シグネチャ中心」から、**ふるまい/相関分析中心**へと移行

## 仮想通貨環境とクリプトジャッキング

### 仮想通貨環境とは

#### 定義

仮想通貨環境とは、**暗号資産(仮想通貨)の生成/管理/取引/検証を行うための技術基盤および運用環境の総称**です。
主に以下を含みます。

- ブロックチェーンネットワーク
- マイニング(採掘)環境
- ウォレット(秘密鍵管理)
- 取引所/ノード/スマートコントラクト

#### 仮想通貨の技術的前提

仮想通貨は以下の技術に依存します。

- 公開鍵暗号方式(ECDSA 等)
- ハッシュ関数(SHA-256 等)
- 分散合意アルゴリズム(PoW/PoS)
- P2P ネットワーク

これらは改ざん耐性を高める一方、**計算資源への依存度が高い**という特徴を持ちます。

### マイニングと計算資源

#### マイニングの概要

マイニングとは、**取引の正当性検証とブロック生成を行う計算作業**であり、成功すると報酬として仮想通貨が得られます。

- Proof of Work(PoW)では大量の CPU/GPU 計算が必要
- 電力/計算資源が直接コストになる

#### 攻撃者視点の問題点

- 正規マイニング：電気代/設備投資が必要
- 不正マイニング：**他人の計算資源を使えばコストゼロ**

ここで登場するのが **クリプトジャッキング**です。

### クリプトジャッキング(Cryptojacking)

#### 定義

**クリプトジャッキング(Cryptojacking)**とは、利用者の同意なく、他人のコンピュータやサーバの CPU/GPU 資源を用いて仮想通貨のマイニングを行う不正行為です。
IPA/JPCERT/CC/MITRE ATT&CK でも**不正なリソース利用型マルウェア行為**として整理されています。

#### マルウェアとの違い(試験で重要)

| 項目 | 情報窃取型マルウェア | クリプトジャッキング |
|---|---|---|
| 主目的 | 情報の盗難 | 計算資源の不正利用 |
| 痕跡 | データ漏えい | CPU 使用率上昇 |
| 被害 | 情報流出 | 性能劣化/電力消費 |
| 発覚 | 比較的早い | 気付きにくい |

### クリプトジャッキングの主な手法

#### マルウェア感染型

- メール添付
- 不正サイト
- 脆弱なサーバへの侵入

感染後、バックグラウンドで常時マイニングを実行します。

#### Webブラウザ型(スクリプト型)

- Web ページに JavaScript マイニングコードを埋め込む
- ページ閲覧中のみ CPU を使用

過去に **Coinhive** などが問題となりました。

#### クラウド/仮想環境の悪用(重要)

- IaaS の認証情報漏えい
- Kubernetes の設定不備
- 管理用 API の公開

### 被害の具体例

- サーバ応答遅延
- クラウド利用料金の急増
- CPU 温度上昇による機器劣化
- バッテリー消耗(モバイル端末)

### 対策(IPA/JPCERT)

#### 技術的対策

- EDR/挙動検知型ウイルス対策
- CPU 使用率の監視
- Web スクリプト制御(NoScript 等)
- クラウド IAM 設定の最小権限化

#### 運用的対策

- 不審な負荷増大の監視
- 利用料金アラート設定
- OS/ミドルウェアの脆弱性管理

### 関連知識

#### クラウドと仮想通貨攻撃

- IaaS は攻撃者にとって「理想的なマイニング環境」
- 認証情報漏えい = 即マイニング

#### MITRE ATT&CK との関係

- T1496(Resource Hijacking)として分類
- ランサムウェアとは異なる収益モデル

#### ランサムウェアとの比較

| 観点 | ランサムウェア | クリプトジャッキング |
|---|---|---|
| 収益 | 一時的 | 継続的 |
| 目立ちやすさ | 高い | 低い |
| 被害通知 | 必須 | 不要 |

## マルウェア解析技術

### マルウェア解析の分類

マルウェア解析は **3段階** のアプローチで行われます。

| 段階 | 名称 | 内容 | ツール例 |
|---|---|---|---|
| 第1段階 | **表層解析（Surface Analysis）** | ファイルを実行せず、外形的な情報を収集 | file、strings、VirusTotal、ハッシュ値計算 |
| 第2段階 | **静的解析（Static Analysis）** | 逆アセンブル/逆コンパイルによるコード分析 | IDA Pro、Ghidra、バイナリエディタ |
| 第3段階 | **動的解析（Dynamic Analysis）** | サンドボックス等で実際に実行し挙動を観察 | Cuckoo Sandbox、Procmon、Wireshark |

### 表層解析（Surface Analysis）

#### 主な確認項目

| 項目 | 確認内容 |
|---|---|
| **ファイルハッシュ** | MD5/SHA-256でマルウェアDB（VirusTotal等）と照合 |
| **ファイル種別** | マジックナンバーによるファイル形式特定（PE、ELF等） |
| **文字列抽出（strings）** | URL、IPアドレス、レジストリキー、APIコール名等のヒント |
| **パッカー検出** | UPX等のパッカー/難読化の有無を確認 |
| **デジタル署名** | 正規署名の有無、署名の有効性 |
| **インポートテーブル** | 使用されるWindows APIの一覧（不審なAPI呼び出しの確認） |

### 静的解析（Static Analysis）

- 逆アセンブル（Disassembly）によりアセンブリコードを分析
- 暗号化ルーチン、C2アドレスの特定、攻撃ロジックの理解
- **難読化やパッキングされている場合はアンパック** が必要

### 動的解析（Dynamic Analysis）

- サンドボックス環境（仮想マシン）でマルウェアを実行
- ファイル操作、レジストリ変更、ネットワーク通信、プロセス生成等を記録
- **実行時にのみ展開されるコード** の解析に有効

### サンドボックス回避技術（Anti-Sandbox：試験頻出）

高度なマルウェアはサンドボックスを検知し、分析を妨害します。

| 回避技術 | 手法 |
|---|---|
| **仮想環境検知** | VMwareTools/VBoxGuestAdditions等のプロセスやレジストリを確認 |
| **時間遅延** | 一定時間スリープしてから動作開始（短時間の解析を回避） |
| **ユーザ操作検知** | マウス操作やキー入力がなければ動作しない |
| **デバッガ検知** | `IsDebuggerPresent()` 等のAPI呼び出しでデバッグ環境を検知 |
| **環境チェック** | CPU数、メモリ容量、ディスク容量の少なさで仮想環境を判定 |
| **実行回数制限** | 2回目以降の実行では異なる挙動を示す |

**試験ポイント**：午後問題では「サンドボックスで検知できなかった理由」として、これらの回避技術が問われることがあります。

### IoC（Indicator of Compromise：侵害指標）

マルウェア解析の結果、以下の情報がIoCとして共有されます。

| IoC種別 | 例 |
|---|---|
| **ファイルハッシュ** | SHA-256値 |
| **IPアドレス/ドメイン** | C2サーバのアドレス |
| **URL** | マルウェア配布先URL |
| **レジストリキー** | 永続化に使用されるキー |
| **ファイルパス** | マルウェアの設置場所 |

IoC情報は **STIX/TAXII** 形式で脅威インテリジェンスとして共有されます。

## マルウェアの永続化技術（Persistence）

### 永続化の目的

永続化（Persistence）とは、**システムの再起動後もマルウェアが自動的に実行されるようにする技術** です。MITRE ATT&CK の戦術 **TA0003** に分類されます。

### 主な永続化手法（Windows環境）

| 手法 | 説明 | MITRE ID |
|---|---|---|
| **レジストリ Run キー** | `HKCU\Software\Microsoft\Windows\CurrentVersion\Run` にエントリ追加 | T1547.001 |
| **スケジュールタスク** | タスクスケジューラに不正タスクを登録 | T1053.005 |
| **サービス登録** | Windowsサービスとしてマルウェアを登録 | T1543.003 |
| **スタートアップフォルダ** | スタートアップフォルダにショートカットを配置 | T1547.001 |
| **WMIイベントサブスクリプション** | WMIイベント発生時にスクリプトを実行 | T1546.003 |
| **DLLサイドローディング** | 正規アプリケーションに不正DLLを読み込ませる | T1574.002 |
| **DLLサーチオーダーハイジャック** | DLL検索パスの優先順位を悪用 | T1574.001 |

**試験ポイント**：午後問題では「マルウェアがどのように永続化しているか」の分析が問われます。特に **レジストリRunキー** と **スケジュールタスク** は最頻出です。

### DLLサイドローディング（試験頻出）

正規のアプリケーションが特定のDLLを読み込む際に、**攻撃者が同名の不正DLLを配置** して読み込ませる手法です。

```
正規アプリ（署名済み）→ 不正DLL（同名で同ディレクトリに配置）→ マルウェア実行
```

- 正規の署名付きアプリケーション経由で実行されるため、**アプリケーションホワイトリスト** を回避可能
- EDRのプロセスツリーでは正規アプリの子プロセスとして表示される

## エクスプロイトキットとドライブバイダウンロード

### エクスプロイトキット（Exploit Kit）

エクスプロイトキットとは、**Webブラウザやプラグインの脆弱性を自動的に悪用してマルウェアをインストールするツールキット** です。

#### エクスプロイトキットの動作フロー

```
① 攻撃者：正規Webサイトを改ざん or 不正広告（マルバタイジング）を配信
② 被害者：改ざんサイトにアクセス
③ エクスプロイトキット設置サーバにリダイレクト
④ ブラウザ/プラグインの脆弱性を自動判定
⑤ 該当する脆弱性を悪用してマルウェアをインストール
```

#### 代表的なエクスプロイトキット

| 名称 | 特徴 |
|---|---|
| **Angler** | 高度な回避技術。メモリ上でのみ実行 |
| **RIG** | 現在も活動が確認される |
| **Nuclear** | Flash/Java/Silverlight等を悪用 |

### ドライブバイダウンロード（Drive-by Download）

- **ユーザの明示的な操作なし** にマルウェアがダウンロード・実行される攻撃
- Webサイトの閲覧だけで感染する
- エクスプロイトキットと組み合わせて使用される

### マルバタイジング（Malvertising）

- 正規の広告ネットワークを悪用して **不正広告を配信** する手法
- 正規サイトに表示される広告経由で感染するため、ユーザの注意だけでは防止困難
- 対策：広告ブロッカー、ブラウザ/プラグインの最新化

## Emotet（エモテット）

### Emotetの定義

**Emotet** は、**メール経由で拡散し、モジュール型構造で多機能な攻撃を行うマルウェアプラットフォーム** です。IPA/JPCERT/CCが繰り返し注意喚起を発出した、近年最も社会的影響の大きいマルウェアの一つです。

### Emotetの特徴

| 特徴 | 説明 |
|---|---|
| **返信型メール** | 窃取したメール本文を引用し、正規の返信を装う |
| **マクロ付きOffice添付** | Word/Excelのマクロで初期感染 |
| **モジュール型構造** | 追加モジュール（情報窃取、スパム送信、ラテラルムーブメント等）をダウンロード |
| **他マルウェアの配信基盤** | TrickBot、Ryuk、QakBot等の配信に利用 |
| **自動拡散** | Outlookの連絡先を窃取し、自動的に標的型メールを送信 |

### Emotetの攻撃フロー

```
① 標的型メール（返信型、マクロ付きOfficeファイル添付）
② ユーザがマクロを有効化
③ PowerShellが起動、C2サーバからEmotet本体をダウンロード
④ 情報窃取（メールアカウント、アドレス帳、認証情報）
⑤ 窃取したメール情報を使い、さらなる標的型メールを自動送信
⑥ 追加マルウェア（ランサムウェア等）のダウンロード・実行
```

### Emotetの歴史

| 年 | 出来事 |
|---|---|
| 2014年 | バンキングトロジャンとして登場 |
| 2018-2019年 | 世界的に大流行。モジュール型プラットフォームへ進化 |
| 2021年1月 | **Europolによるテイクダウン**（インフラ押収） |
| 2021年11月 | **活動再開**（TrickBot経由で復活） |
| 2022-2023年 | 新手法（OneNote添付、ショートカットファイル等）で再流行 |

### Emotet対策（IPA/JPCERT推奨）

- Officeマクロの **デフォルト無効化**
- メールの添付ファイル（特にマクロ付き）の警戒
- **PowerShellの実行ポリシー制限**
- 不審メールの組織内共有体制の構築
- EDR/メールセキュリティ製品の導入
- OSおよびOfficeの最新化

**試験ポイント**：Emotetは「ダウンローダ」「ファイルレスマルウェア」「ボットネット」「標的型攻撃」の複合的な性質を持ち、本記事の複数セクションにまたがる知識が求められます。

## 全体整理表

### マルウェア種類別整理

| 分類 | 代表例 | 自己増殖 | 主目的 | 検知の難しさ |
|---|---|---|---|---|
| ウイルス（狭義） | Cascade、マクロウイルス | あり（宿主必要） | 破壊/改ざん | 中 |
| ワーム | WannaCry、Mirai | **あり（自律拡散）** | 拡散/DDoS | 中 |
| トロイの木馬 | Emotet、RAT | なし | 情報窃取/遠隔操作 | 高 |
| ランサムウェア | LockBit、REvil | 一部あり | **身代金要求** | 中 |
| ボット | Mirai、Emotet | C2依存 | DDoS/スパム | 高 |
| ダウンローダ | Emotet（初期） | なし | 追加マルウェア取得 | 高 |
| ドロッパー | - | なし | 内蔵マルウェア展開 | 中 |
| キーロガー | - | なし | キー入力窃取 | 中 |
| Rootkit | TDL4 | なし | **隠蔽/永続化** | 非常に高 |
| スパイウェア | - | なし | 情報収集 | 中 |
| アドウェア | - | なし | 広告表示/情報収集 | 低 |

### ウイルス変形技術の比較

| 種類 | 変形対象 | 暗号化 | 検知困難度 |
|---|---|---|---|
| **ポリモーフィック** | 復号ルーチンを変形 | あり | 高 |
| **メタモーフィック** | **コード全体を書き換え** | なし（不要） | **非常に高** |
| **ステルス型** | OS I/Oを改ざんし痕跡隠蔽 | - | 高 |

### 攻撃手法とマルウェアの対応関係（午後問題対策）

| 攻撃段階（Kill Chain） | 使用されるマルウェア/技術 | 対策 |
|---|---|---|
| 偵察 | OSINT | 公開情報の最小化 |
| 配送 | 標的型メール、水飲み場、エクスプロイトキット | メールフィルタ、URLフィルタ、パッチ適用 |
| 攻撃 | エクスプロイト、マクロ | 脆弱性管理、マクロ無効化 |
| インストール | ダウンローダ、ドロッパー | EDR、アプリケーション制御 |
| C2 | DGA、Fast Flux、DNSトンネリング | プロキシ監視、DNS監視 |
| 横展開 | Pass-the-Hash、RDP悪用 | ネットワークセグメンテーション、PAM |
| 目的実行 | ランサムウェア、情報窃取、DDoS | バックアップ、DLP、DDoS対策 |

### 検知技術と対象マルウェアの対応

| 検知技術 | 既知 | 未知 | ファイルレス | Rootkit | 主な製品カテゴリ |
|---|---|---|---|---|---|
| パターンマッチング | ◎ | × | × | × | 従来型AV |
| ヒューリスティック | ○ | ◎ | △ | △ | NGAV |
| ビヘイビア（挙動） | ○ | ○ | ◎ | ○ | EDR |
| サンドボックス | ○ | ○ | △ | △ | ネットワーク型サンドボックス |
| メモリフォレンジック | ○ | ○ | ◎ | ◎ | Volatility等 |
| 整合性検査 | ○ | ○ | × | ◎ | FIM（Tripwire等） |

### 試験頻出テーマ整理

| テーマ | 午前IIポイント | 午後ポイント |
|---|---|---|
| ランサムウェア | 二重脅迫、RaaS、WannaCryの特徴 | 侵入経路分析、バックアップ設計、インシデント対応 |
| 標的型攻撃 | Kill Chain、水飲み場攻撃、サプライチェーン | 攻撃段階の分析、多層防御設計 |
| Emotet | 返信型メール、モジュール構造 | メールヘッダ分析、感染拡大防止策 |
| ファイルレス | LotL、PowerShell悪用 | ログ分析（PowerShellログ）、検知方法 |
| Rootkit | カーネルモード、DKOM | メモリフォレンジック、Secure Boot |
| ボットネット | DGA、C2通信、Mirai | DNS通信分析、ボットネットテイクダウン |
| マルウェア解析 | 表層/静的/動的解析の違い | サンドボックス回避、IoC抽出 |
| 永続化 | レジストリRun、DLLサイドローディング | 永続化箇所の特定と除去 |
