# Enhanced Open・WPA2/WPA3・IEEE 802.1X/EAP-TLSによる無線LANセキュリティの体系的整理

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年秋の情報処理安全確保支援士に向けて勉強中です。
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/a25279a17b210d6ed9f4)」をご参照ください。
**本記事は学習した内容を記載しています。**

## 該当問題

[情報セキュリティスペシャリスト平成27年春期 午前Ⅱ 問2](https://www.sc-siken.com/kakomon/27_haru/am2_2.html)
[平成25年秋期試験問題 午前Ⅱ 問4](https://www.sc-siken.com/kakomon/26_aki/am2_25.html)
[情報セキュリティスペシャリスト平成28年春期 午前Ⅱ 問18](https://www.sc-siken.com/kakomon/28_haru/am2_18.html)
[令和3年春期試験問題 午前Ⅱ 問17](https://www.sc-siken.com/kakomon/03_haru/am2_17.html)

## 無線LANの基本

### 無線LANとは

無線LAN(Wireless LAN)は、**電波を用いて端末同士/端末とアクセスポイント(AP)を接続するLAN技術** です。代表的な規格はIEEE 802.11系列です。

- 802.11a/b/g/n/ac/ax … 物理層/データリンク層の規格(周波数帯/変調方式/最大スループットなど)
- 2.4GHz/5GHz/6GHz帯を利用します(国/規制に依存)

### IEEE 802.11規格の世代比較

| 規格 | Wi-Fi世代 | 周波数帯 | 最大速度 | 特徴 |
|------|----------|---------|---------|------|
| 802.11a | - | 5GHz | 54Mbps | OFDM採用 |
| 802.11b | - | 2.4GHz | 11Mbps | 最初の普及規格 |
| 802.11g | - | 2.4GHz | 54Mbps | 802.11bと互換 |
| 802.11n | Wi-Fi 4 | 2.4GHz/5GHz | 600Mbps | MIMO導入、チャネルボンディング |
| 802.11ac | Wi-Fi 5 | 5GHz | 6.9Gbps | MU-MIMO(下り)、ビームフォーミング |
| 802.11ax | Wi-Fi 6/6E | 2.4GHz/5GHz/6GHz | 9.6Gbps | OFDMA、BSS Coloring、WPA3対応 |
| 802.11be | Wi-Fi 7 | 2.4GHz/5GHz/6GHz | 46Gbps | MLO(マルチリンク)、4096QAM |

- **Wi-Fi 6E**：Wi-Fi 6の6GHz帯拡張版です
- **802.11ax以降はWPA3対応が標準**となっています
- 試験では規格名とWi-Fi世代名の対応が問われます

### 無線LANのトポロジ

| モード | 説明 |
|--------|------|
| **インフラストラクチャモード** | AP経由で通信する一般的な形態です |
| **アドホックモード** | AP不要で端末同士が直接通信します |
| **メッシュネットワーク(802.11s)** | AP同士がメッシュ状に接続し、広範囲をカバーします |

### BSSID・ESSID

| 用語 | 説明 |
|------|------|
| **BSSID** | APのMACアドレスに相当する識別子です。1つのAPを識別します |
| **ESSID** | 複数APで共有するネットワーク名です。一般に「SSID」と呼ばれるものはESSIDを指します |
| **BSS** | 1つのAPとそれに接続する端末群です(Basic Service Set) |
| **ESS** | 複数のBSSを束ねた論理的なネットワークです(Extended Service Set) |

### 無線LAN通信の特徴

無線LAN(IEEE 802.11)は、**電波を媒体として通信する** ため、以下の性質を持ちます。

- 通信が空間に漏洩します
- 同一チャネル上の第三者が受信可能です
- 暗号化されていなければ盗聴が容易です

**「物理的に閉じた通信」ではない点が最大のリスク** です。

### 端末とAP間の通信の流れ

1. SSIDのビーコン受信
2. 認証(Authentication)
3. アソシエーション(Association)
4. データ通信

このうち **2～4の過程で暗号化の有無が決まります**。

### SSID(Service Set Identifier)

無線LANにおいて「混信」を避けるためにアクセスポイントと端末に設定するネットワーク識別子です。SSIDには最長32文字の任意の文字列を設定します。

#### 必要となった経緯

通信を行う端末とスイッチがコードで接続されている有線LANと異なり、無線LANでは1つの端末が複数のアクセスポイントと通信できてしまう「混信状態」が発生し得ます。これを回避するため、無線LANではアクセスポイントと端末にそれぞれSSIDを設定し、SSIDが一致する機器同士しか通信ができないようにアクセス制御を行っています。

### 無線LANが有線LANより難しい理由(セキュリティ面)

- 電波が **空間に漏れます**(壁/窓の外にも届きます)
- 盗聴/なりすまし/不正アクセスポイント(偽AP)が容易です
- パケットが **物理的に流出** しやすく、暗号化と認証が必須です

そのため、無線LANでは **暗号化(Confidentiality)/完全性保護(Integrity)/認証(Authentication)** がセットで問われます。

## 無線LANセキュリティの変遷(WEP → WPA → WPA2 → WPA3)

### WEP(Wired Equivalent Privacy)

- 802.11初期の標準で導入された暗号化方式です
- RC4ストリーム暗号 ＋ 24bit IV(初期化ベクトル)を使用します
- 主な問題点：
  - IVが短く再利用されやすい → キーストリーム再利用 → 暗号解読が容易です
  - 鍵管理が貧弱です(共有鍵/固定鍵)
  - CRC32による完全性保護が暗号的に弱いです

現在は **完全に使用非推奨** です。

### WPA(Wi-Fi Protected Access)

WEPの脆弱性が顕在化したのち、**暫定対策** としてWi-Fi Allianceが策定した方式です。現在はWPA2以降に移行が推奨されています。

- 暗号：TKIP(Temporal Key Integrity Protocol)
- 既存ハードウェアでのファーム更新を想定した「過渡期の方式」です

### 無線LAN暗号化方式の詳細比較

#### WEP暗号化の仕組み

```
WEP鍵(40bit/104bit) + IV(24bit) → RC4キーストリーム → XOR → 暗号文
完全性保護：CRC32(ICV) → 暗号的に弱く改ざん検知不可
```

- **IVが24bit**のため、約5,000パケットで再利用が発生します
- FMS攻撃・PTW攻撃により**数分で鍵解読が可能**です

#### TKIPの仕組み（WPAで使用）

TKIPはWEPの脆弱性を**既存ハードウェア上のソフトウェア更新**で解消するために設計されました。

| 要素 | 説明 |
|------|------|
| **鍵混合(Key Mixing)** | 一時鍵(TK)+送信元MAC+TSCから、パケットごとに異なるRC4鍵を生成します |
| **TSC(TKIP Sequence Counter)** | 48bitのシーケンス番号でリプレイ攻撃を防止します |
| **MIC(Michael)** | メッセージ完全性チェック。CRC32より強力ですが、暗号学的には脆弱です |
| **Per-Packet Key** | パケットごとに異なる鍵を使用し、WEPの鍵再利用問題を回避します |

- TKIPは**Beck-Tews攻撃**などにより脆弱性が発見され、現在は**非推奨**です
- 暗号エンジンはRC4のままであり、根本的な安全性向上には至りません

#### CCMP(Counter Mode with CBC-MAC Protocol)の仕組み（WPA2で使用）

```
PTK(Pairwise Transient Key)から導出されたTK(Temporal Key)
  ├─ CTRモード → データ暗号化(128bit AES)
  └─ CBC-MAC → 完全性保護(MIC生成)
Nonce = パケット番号(PN, 48bit) + 送信元MACアドレス + 優先度
```

- AES-128を使用し、WEP/TKIPとは根本的に異なる暗号基盤です
- **AEAD(認証付き暗号)**の一種であり、暗号化と認証を同時に提供します

#### GCMP(Galois/Counter Mode Protocol)の仕組み（WPA3で使用）

- AES-GCMベースの暗号化+認証方式です
- WPA3-Enterprise 192bitモードで**GCMP-256**が必須です
- CCMPより高速で、ハードウェアアクセラレーションとの相性が良好です

#### 暗号方式の比較表

| 項目 | WEP | TKIP(WPA) | CCMP(WPA2) | GCMP(WPA3) |
|------|-----|-----------|------------|------------|
| 暗号アルゴリズム | RC4 | RC4 | AES-128 | AES-128/256 |
| 暗号モード | ストリーム | ストリーム | CTR | GCM |
| 完全性保護 | CRC32 | Michael(MIC) | CBC-MAC | GHASH |
| IV/Nonce長 | 24bit | 48bit(TSC) | 48bit(PN) | 48bit(PN) |
| 鍵管理 | 固定共有鍵 | Per-Packet Key | PTKから導出 | PTKから導出 |
| AEAD | × | × | ○ | ○ |
| 安全性 | ×(解読可) | △(非推奨) | ○ | ◎ |

### WPA2

- IEEE 802.11iをベースにした **正式な強固セキュリティ方式** です
- 暗号：AES-CCMP(Counter Mode with CBC-MAC)を必須としています
- キーワード：**RSN(Robust Security Network)**

### WPA3

- 2018頃から導入された新世代方式です
- SAE(Simultaneous Authentication of Equals)によるパスワード認証強化を行います
- オフライン総当たり攻撃への耐性が向上しています

#### WPA3の主要な改善点

| 改善項目 | 内容 |
|---------|------|
| **SAE(Dragonfly)** | PSK認証をSAEに置き換え、オフライン辞書攻撃を防止します |
| **PMF(802.11w)必須化** | 管理フレーム保護を必須とし、Deauth攻撃等を防止します |
| **前方秘匿性(Forward Secrecy)** | セッションごとに独立した鍵を生成し、過去の通信が解読されません |
| **Enhanced Open(OWE)** | オープンネットワークでの暗号化を標準化しました |

#### SAE(Simultaneous Authentication of Equals)の仕組み

SAEは**Dragonflyプロトコル**（RFC 7664）に基づく鍵交換方式です。

```
【SAEハンドシェイク】
1. Commit Exchange（コミット交換）
   STA → AP：スカラー値 + 要素値（パスワードから導出）
   AP → STA：スカラー値 + 要素値（パスワードから導出）
   → 双方がパスワードを知っていることを証明（ゼロ知識証明に類似）

2. Confirm Exchange（確認交換）
   STA ⇔ AP：確認値を交換して認証完了
   → PMKが生成される

3. 4-way ハンドシェイク → PTK生成 → データ通信開始
```

- **パスワードが通信路上を流れない**ため、キャプチャしても辞書攻撃不可です
- 対等な立場（Equals）で相互認証を行います（WPA2-PSKはAPが検証するのみ）
- **各セッションで異なるPMKが生成**されるため、前方秘匿性を実現します

#### WPA3-Personal と WPA3-Enterprise

| 項目 | WPA3-Personal | WPA3-Enterprise |
|------|--------------|-----------------|
| 認証方式 | SAE | 802.1X/EAP |
| 暗号化 | AES-CCMP(128bit) | **GCMP-256**(192bitモード) |
| PMF | 必須 | 必須 |
| 前方秘匿性 | ○ | ○ |
| 用途 | 家庭・小規模 | 企業・政府機関 |

#### WPA3-Enterprise 192bitセキュリティモード

- **GCMP-256**（AES-256-GCM）による暗号化が必須です
- **HMAC-SHA-384**によるKDFを使用します
- **ECDSA P-384**または**RSA 3072bit以上**のサーバ証明書が必要です
- CNSA(Commercial National Security Algorithm)スイートに準拠しています
- 政府機関・金融機関などの高セキュリティ環境向けです

#### PMF(Protected Management Frames / IEEE 802.11w)

管理フレーム（Management Frame）は通常暗号化されず、攻撃の対象になります。

| 管理フレーム | 攻撃例 | PMFによる保護 |
|------------|--------|-------------|
| Deauthentication | DoS攻撃、KRACK攻撃の前段 | BIP(Broadcast Integrity Protocol)で保護 |
| Disassociation | 強制切断攻撃 | IGTK(Integrity GTK)によるMIC付与 |
| Action Frame | 不正な設定変更 | ユニキャスト管理フレームはCCMP/GCMPで暗号化 |

- WPA3では**PMFが必須**(WPA2ではオプション)です
- **IGTK(Integrity Group Temporal Key)**：ブロードキャスト管理フレームの完全性保護に使用します
- **BIP(Broadcast/Multicast Integrity Protocol)**：IGTKを使用してMICを付与する方式です

#### Dragonblood脆弱性（WPA3への攻撃）

2019年に発見されたWPA3-SAEの実装上の脆弱性群です。

| 攻撃名 | 内容 |
|--------|------|
| **サイドチャネル攻撃** | SAEのCommit処理の実行時間差からパスワード情報を推測します |
| **ダウングレード攻撃** | WPA3対応端末をWPA2モードに誘導し、従来の攻撃を適用します |
| **DoS攻撃** | SAEのCommit処理は計算コストが高く、大量送信でAPを過負荷にします |

- 対策：ファームウェアアップデート、Transition Mode(WPA2/WPA3混在)の慎重な運用が必要です

## WPA2の方式と構成要素

WPA2は主に以下を組み合わせて構成されています。

1. **利用者認証／ネットワーク認証**(誰が接続できるか)
2. **鍵交換(4-way ハンドシェイク)**
3. **トラフィック暗号化(AES-CCMP)**

### WPA2-Personal(WPA2-PSK)

- 共有パスフレーズ(Pre-Shared Key)を全クライアントで共用します
- 家庭/小規模オフィス向けです
- PSKからPMK(Pairwise Master Key)を導出し、そこからPTKを生成します

#### 注意点

- パスフレーズが短い／単純だと **辞書攻撃/総当たり攻撃** に脆弱です
- 共有鍵なので、1人でも漏洩すると全利用者に影響します

### WPA2-Enterprise(802.1X/EAP)

- 企業環境向けの強固な方式です
- 802.1X(ポートベース認証)＋ RADIUSサーバを利用します
- 各ユーザごとに認証/鍵生成が行われます

#### 主な構成要素

- サプリカント(Supplicant)：端末(クライアント)
- オーセンティケータ(Authenticator)：AP(スイッチ)
- 認証サーバ(Authentication Server)：RADIUSサーバ

#### 利用されるEAP方式の例

- EAP-TLS(クライアント証明書認証)
- PEAP(TLSトンネル＋内部でMS-CHAPv2など)

## WPA2/WPA3の鍵階層（Key Hierarchy）

無線LANセキュリティでは、複数の鍵が段階的に導出されます。この鍵階層の理解は午後問題で頻出です。

### 鍵の種類と役割

| 鍵 | 正式名称 | 役割 |
|----|---------|------|
| **MSK** | Master Session Key | 802.1X認証成功時にRADIUSサーバから提供される最上位鍵です |
| **PMK** | Pairwise Master Key | PSKから直接導出、またはMSKから導出される鍵です |
| **PTK** | Pairwise Transient Key | ユニキャスト通信に使用する一時鍵です。4-way ハンドシェイクで生成します |
| **GTK** | Group Temporal Key | マルチキャスト/ブロードキャスト通信に使用するグループ鍵です |
| **GMK** | Group Master Key | GTKの元となるマスター鍵です |

### PMKの導出方法

```
【WPA2-Personal(PSK)の場合】
PMK = PBKDF2(パスフレーズ, SSID, 4096回, 256bit)
  → パスフレーズ(8～63文字) + SSIDからPBKDF2で導出

【WPA2-Enterprise(802.1X)の場合】
EAP認証成功 → RADIUSサーバがMSKを生成 → MSKの先頭256bitがPMK
  → ユーザごとに異なるPMKが生成される
```

- PSK方式では**SSIDが同じでパスフレーズが同じならPMKも同一**になります
- Enterprise方式では**認証ごとに異なるPMK**が生成されるため、より安全です

### PTKの導出と構成

```
PTK = PRF(PMK, ANonce, SNonce, AP-MAC, STA-MAC)
  → 4-way ハンドシェイク中に両者が独立に計算

PTKの内部構成：
  ├─ KCK(Key Confirmation Key, 128bit)：MICの計算に使用
  ├─ KEK(Key Encryption Key, 128bit)：GTK配送時の暗号化に使用
  └─ TK(Temporal Key, 128bit)：実際のデータ暗号化に使用
```

- **KCK**：4-wayハンドシェイクのメッセージ認証（MIC計算）に使用します
- **KEK**：APからSTAへGTKを安全に配送する際の暗号化に使用します
- **TK**：実際のユニキャストデータフレームの暗号化（AES-CCMP/GCMP）に使用します

### GTKの導出と配布

```
GMK → GTK = PRF(GMK, GNonce, AP-MAC)
GTKはAPが生成 → 4-way ハンドシェイクのMessage 3でKEKにより暗号化して配布
```

- GTKは**APに接続する全端末で共有**されます
- GTKの更新（Group Key Handshake）は定期的に、または端末離脱時に実施されます

### 鍵階層の全体フロー

```
【PSK方式】                    【Enterprise方式】
パスフレーズ + SSID            EAP認証 → MSK
      ↓ PBKDF2                      ↓ 先頭256bit
      PMK                           PMK
       ↓ + ANonce + SNonce + MAC addresses
      PTK ─┬─ KCK (MIC計算用)
           ├─ KEK (GTK配送用)
           └─ TK  (データ暗号化用)

APが別途生成：GMK → GTK (ブロードキャスト/マルチキャスト用)
```

## 4-way ハンドシェイクの概要(IEEE 802.11i)

WPA2では、APと端末が共有しているPMK(Pairwise Master Key)から、実際にパケット暗号化に使うPTKを生成するため、**4-way ハンドシェイク** を行います。

### ステップ概要

1. **Message 1**：AP → STA
   - ランダム値ANonceを送信します

2. **Message 2**：STA → AP
   - 端末側でSNonceを生成します
   - PMK、ANonce、SNonce、MACアドレスからPTKを計算します
   - SNonceとMICをAPに送信します

3. **Message 3**：AP → STA
   - AP側でもPTKを計算し、MICを検証します
   - その後、暗号化鍵(GTKなど)を送信します

4. **Message 4**：STA → AP
   - 受信確認(ACK)を返し、セッション確立します

このハンドシェイクが正しく完了した後に、実際のデータフレームがAES-CCMPで暗号化されます。

## AES-CCMPによる暗号化/完全性保護

### CCMPとは

WEPのようなRC4＋CRC32に比べて、暗号強度/完全性ともに大幅に強化されています。

- Counter Mode with CBC-MAC
- 暗号化：AESカウンターモード
- 完全性保護：CBC-MACによるメッセージ認証

### 保護される範囲

- データフレームのペイロード部分
- 一部ヘッダの保護(完全なヘッダ保護は行われない点にも注意が必要です)

## WPA2の代表的な脅威と対策

### 弱いPSKに対するオフライン辞書攻撃

攻撃者が4-way ハンドシェイクをキャプチャすると、PSKに対する辞書攻撃/総当たり攻撃が可能となります。

#### 対策

- 長く複雑なパスフレーズ(20文字以上推奨)
- 乱数パスフレーズ＋パスワードマネージャの利用
- 可能な場合はWPA2-Enterpriseへの移行

### KRACK攻撃(Key Reinstallation Attack)

- WPA2の4-way ハンドシェイク実装の脆弱性を突く攻撃です
- 同じ鍵を再インストールさせることでnonceを再使用させ、暗号解析可能にします

#### 対策

- OS/無線LANドライバ/ファームウェアのアップデート
- AP／クライアント双方でパッチ適用

### 不正アクセスポイント(Rogue AP)/Evil Twin

- 正規APと同じSSIDを名乗る偽アクセスポイントです
- 利用者を騙して接続させ、トラフィックを盗聴/改ざんします

#### 対策

- 企業内では802.1X＋証明書を使用します
- 管理されていないAPを検出するWIPS/WIDSの利用
- 利用者教育(無料Wi-Fiのリスク周知)

### Deauthentication攻撃（認証解除攻撃）

- 攻撃者が**偽のDeauthenticationフレーム**を送信し、端末をAPから強制切断させます
- 管理フレームは通常暗号化されないため、容易に偽装可能です
- **KRACK攻撃の前段**として利用されます（再接続時のハンドシェイクをキャプチャ）

#### 攻撃の流れ

```
攻撃者 → 偽Deauth → STA強制切断
STA → 再接続試行(4-way ハンドシェイク)
攻撃者 → ハンドシェイクをキャプチャ → オフライン辞書攻撃
```

#### 対策

- **PMF(802.11w)**の有効化（WPA3では必須）
- WIDS/WIPSによるDeauthフレームの異常検知

### War Driving / War Walking

- 車両や徒歩で移動しながら、**無線LANの電波を検出・記録**する行為です
- SSIDの収集、暗号化方式の特定、GPS座標のマッピングを行います
- 暗号化なし・WEPのAPが攻撃対象として選別されます

#### 対策

- 適切な暗号化方式（WPA2/WPA3）の使用
- 電波出力の適正管理（必要最小限の範囲に制限）

### FragAttacks（Fragmentation and Aggregation Attacks）

2021年に発見された、**IEEE 802.11の設計上の脆弱性**に起因する攻撃群です。

| 脆弱性の種類 | 内容 |
|-------------|------|
| **フラグメント集約攻撃** | フラグメント化されたフレームの再組立て処理の欠陥を悪用します |
| **混合鍵攻撃** | 異なる鍵で暗号化されたフラグメントを混合させます |
| **平文注入攻撃** | 暗号化フレームに平文フラグメントを注入します |

- **WEP/WPA/WPA2/WPA3のすべてに影響**する設計上の問題です
- 対策：OS/ファームウェアのアップデート

### その他の無線LAN攻撃

| 攻撃手法 | 内容 | 対策 |
|---------|------|------|
| **Evil Twin** | 正規APと同一SSIDの偽APを設置し、接続を誘導します | 802.1X証明書認証、WIDS |
| **カルマ攻撃(KARMA)** | 端末のProbe Requestに応答し、あらゆるSSIDを名乗る偽APです | 自動接続設定の無効化 |
| **中間者攻撃(MITM)** | Evil Twin経由でAPと端末の間に割り込みます | VPN、HTTPS、証明書検証 |
| **WPS PIN攻撃** | WPS(Wi-Fi Protected Setup)のPINをブルートフォースで解読します | WPSの無効化 |
| **Hole196攻撃** | GTK(グループ鍵)を使用した内部者による攻撃です | ネットワーク監視、APアイソレーション |
| **Beacon Flood** | 大量の偽ビーコンフレームを送信してAPを妨害します | WIPS、チャネル監視 |

## Enhanced Open

### 従来の「Open(オープン)ネットワーク」

**Openネットワーク** とは、認証も暗号化も行わずに接続できる無線LANのことです。

例：

- カフェ
- 空港
- ホテル

#### Openネットワークの問題点

| 問題 | 内容 |
|---|---|
| 盗聴 | 平文通信が可能です |
| なりすまし | 悪意あるAPの設置が容易です |
| セッション窃取 | Cookie盗聴が可能です |

HTTPSを使っても、DNSや制御情報は露出します。

### Enhanced Openとは

**Enhanced Open** とは、認証を必要としないオープンネットワークでありながら、端末とAP間の通信を暗号化する方式です。

#### 公式根拠

- Wi-Fi Alliance
- IEEE 802.11-2016 + RFC 8110(OWE)

### 正式名称

Enhanced Openは技術的には **OWE(Opportunistic Wireless Encryption)** を用いた方式です。

### 認証と暗号化の分離

Enhanced Openの特徴は以下のとおりです。

| 項目 | 内容 |
|---|---|
| 利用者認証 | 行いません |
| 通信暗号化 | 行います |
| 事前共有鍵 | 不要です |

**「誰でも接続できるが、盗聴できない」** という特徴があります。

### 鍵交換方式

- Diffie-Hellman鍵交換を使用します
- 接続ごとに **一時的なセッション鍵** を生成します

特徴は以下のとおりです。

- 他の端末の通信は復号不可です
- 鍵は接続単位で異なります

### 通信イメージ

```
端末A ──(暗号化通信)── AP
端末B ──(別鍵で暗号化)── AP
```

端末Aは端末Bの通信を盗聴できません。

### WPA2/WPA3-Enterpriseとの違い

| 項目 | Enhanced Open | WPA2/WPA3 |
|---|---|---|
| 認証 | なし | あり |
| 暗号化 | あり | あり |
| 利用対象 | 公衆無線LAN | 組織LAN |
| 鍵管理 | 自動生成 | PSK/証明書 |

### 暗号化される範囲

Enhanced Openで保護されるのは下記のとおりです。

- 端末 ⇔ AP間の無線通信

保護されないものは下記のとおりです。

- AP以降の通信(インターネット側)

### 中間者攻撃への耐性

- 盗聴：防止できます
- 偽AP：完全防止は不可です

HTTPSやVPNとの併用が望ましいです。

## IEEE 802.1Xとは

IEEE 802.1Xは、**ネットワークへの不正接続を防ぐためのポートベース認証方式** です。

### 役割(IEEE 802.1Xの中心機能)

有線LAN/無線LANの物理または論理ポートに対して「認証済み端末だけをネットワークに入れる」アクセス制御を提供します。

### 3つの構成要素

IEEE 802.1Xは以下の3つから構成されます。

| 要素 | 役割 |
|------|------|
| **Supplicant(サプリカント)** | 認証を受ける端末(PC/スマホ等) |
| **Authenticator(オーセンティケータ)** | スイッチ/無線AP(認証要求を中継) |
| **Authentication Server** | RADIUSサーバ(認証判断を行う) |

### 802.1X認証フロー

IEEE 802.1Xでは、Authenticatorは端末を即座にネットワークへ通さず、**認証フェーズ成功後にポートを開放** します。

#### 認証の流れ

このフローにより、**未認証端末の通信遮断/なりすまし防止** が可能です。

1. Supplicantがネットワークに接続します
2. Authenticatorが端末にEAP-Requestを送信します
3. SupplicantとAuthentication ServerがEAPにより認証処理を行います
4. 認証成功 → Authenticatorがポートを「Authorized」に変更します
5. 通信開始します

## EAP(Extensible Authentication Protocol)とは

EAPはRFC 3748で定義される **拡張認証プロトコル** であり、認証方式(パスワード、証明書、トークンなど)を柔軟に統合できる仕組みです。

### 頻出のEAP認証方式

| EAP方式 | 特徴 |
|----------|------|
| **EAP-TLS** | クライアント証明書による最も強固な相互認証 |
| PEAP | TLSトンネル内でユーザ名/パスワードをやり取り |
| EAP-TTLS | サーバ証明書のみ必須、内部で認証方式を選択 |

### EAPがサポートする主な認証方式

|名称|概要|
|:----|:----|
|EAP-TLS|デジタル証明書によるサーバ/クライアントの相互認証です。クライアント側にはデジタル証明書を組み込んだUSBキーやICカードがよく用いられます。|
|EAP-TTLS|TLSの仕組みでサーバを認証後、TLSのセキュアな伝送路上で様々な方法を用いてクライアントを認証します。|
|PEAP|TLSの仕組みでサーバを認証後、TLSのセキュアな伝送路上でID/パスワードによるクライアント認証をします。|
|EAP-MD5|チャレンジレスポンスでクライアントのみ認証します。|
|EAP-FAST|米シスコシステムズ社が開発した規格で、TTLSとほぼ同じ仕組みです。セキュアな伝送路の確立に証明書ではなく、DH鍵交換を用いる認証モードがあります。|

## EAP-TLS(RFC 5216)とは

EAP-TLSは **クライアント証明書とサーバ証明書の双方を用いる強固な相互認証方式** です。RFC 5216によって標準化されています。

### EAP-TLSの特徴

- **公開鍵基盤(PKI)を使用した相互認証** です
- クライアント側にも証明書が必要です
- パスワード依存がないため、フィッシング/リプレイ攻撃に強いです
- WPA2-Enterprise/WPA3-Enterpriseの標準方式です

### EAP-TLSの認証フロー(TLS Handshake利用)

```
Supplicant ⇔ Authenticator ⇔ RADIUS(Server)
      |------ TLS ClientHello -------------------->|
      |<----- TLS ServerHello + Cert --------------|
      |------ Client Certificate + Verify -------->|
      |------ TLS Finished ------------------------>|
認証成功 → Authenticator がポート開放
```

#### 特徴まとめ

- 証明書により端末の真正性を保証します
- TLSにより盗聴/改ざん/リプレイを防止します
- 最も安全な802.1X認証方式として推奨されています

### 802.1X/EAP-TLSが有効な理由

| 攻撃 | EAP-TLSが防ぐ理由 |
|------|---------------------|
| パスワード盗難 | パスワードを使いません |
| なりすまし | クライアント証明書で端末識別します |
| リプレイ攻撃 | TLSのnonce/session keyにより無効化します |
| 中間者攻撃 | サーバ証明書検証により防止します |

### よく比較される方式

| 認証方式 | 安全性 | 特徴 |
|----------|--------|-------|
| **EAP-TLS** | 最高 | 相互認証、PKI利用、最強です |
| PEAP/EAP-TTLS | 高 | TLSトンネル内でパスワード認証します |
| EAP-MD5 | 低 | パスワード認証のみ、安全性低いです |

## 周辺知識

### RADIUS(Remote Authentication Dial-In User Service)

- IEEE 802.1Xで使われる認証プロトコルです
- UDP 1812(認証)、1813(アカウンティング)

### PKI(Public Key Infrastructure)

- 証明書の発行/失効管理を行います
- EAP-TLSではクライアント証明書が必須です
- CRL/OCSPによる失効確認を行います

### WPA2-Enterprise/WPA3-Enterprise

- 無線LANで802.1X + EAPを採用しています
- 企業ネットワークで一般的です

### Supplicantソフト例

- Windows ネイティブ 802.1Xクライアント
- wpa_supplicant(Linux)
- Cisco AnyConnect NAM

### WIDS/WIPS（無線侵入検知/防止システム）

#### WIDS（Wireless Intrusion Detection System）

無線LAN環境における**不正な通信や攻撃を検知**するシステムです。

| 検知対象 | 内容 |
|---------|------|
| **不正AP(Rogue AP)** | 管理外のAPをRF（電波）スキャンで検出します |
| **Evil Twin** | 正規SSIDと同一のSSIDを持つ不正APを検出します |
| **Deauth Flood** | 大量のDeauthenticationフレームを異常として検知します |
| **ポリシー違反** | WEP使用、暗号化なしなどのポリシー違反APを検出します |
| **異常トラフィック** | 通常と異なる通信パターンを検知します |

#### WIPS（Wireless Intrusion Prevention System）

WIDSの検知機能に加え、**自動的に対処（防止）を行う**システムです。

| 防止機能 | 内容 |
|---------|------|
| **不正AP封じ込め** | 不正APに接続する端末にDeauthフレームを送信して切断します |
| **接続遮断** | ポリシー違反の端末の通信を遮断します |
| **アラート通知** | 管理者にリアルタイムで通知します |

- WIPSの「封じ込め」機能は**法的な考慮**が必要です（他者のAPへの妨害の可能性）
- **センサー配置**が重要であり、フロア全体をカバーする設計が必要です

#### WIDS/WIPSの構成

```
センサーAP(モニタリング専用 or 兼用)
    ↓ 検知データ
管理サーバ(分析・アラート・ポリシー管理)
    ↓ ダッシュボード
管理者
```

### 無線LANコントローラ（WLC）

#### 概要

複数のAPを**集中管理**するためのコントローラです。大規模環境では必須の構成要素です。

| 機能 | 内容 |
|------|------|
| **AP集中管理** | 設定の一括配布、ファームウェア更新を行います |
| **認証制御** | 802.1X/RADIUS連携の一元管理を行います |
| **チャネル/出力管理** | RRM（Radio Resource Management）による自動最適化を行います |
| **ローミング制御** | AP間移動時のシームレスなハンドオフを提供します |
| **セキュリティポリシー** | SSID別のセキュリティ設定を一元管理します |

#### CAPWAP（Control and Provisioning of Wireless Access Points）

- RFC 5415で標準化された**APとWLC間の管理プロトコル**です
- **制御トンネル**（UDP 5246）：AP管理・設定用（DTLSで暗号化）
- **データトンネル**（UDP 5247）：ユーザデータの転送（暗号化はオプション）
- 類似プロトコル：LWAPP（Ciscoの旧プロトコル、CAPWAPの前身）

#### Autonomous AP と Lightweight AP

| 方式 | 説明 |
|------|------|
| **Autonomous AP** | 各APが独立して動作する方式です。小規模向きです |
| **Lightweight AP** | WLCに依存して動作する方式です。大規模向きです |
| **FlexConnect AP** | WLCとの接続断時にも一部機能を維持できるモードです |

### 無線LANセキュリティ設計

企業ネットワークにおける無線LANのセキュリティ設計は午後問題で頻出です。

#### VLAN連携によるセグメント分離

```
SSID: Corporate  → VLAN 10(社内ネットワーク) → WPA2/WPA3-Enterprise
SSID: Guest      → VLAN 20(ゲスト用)        → キャプティブポータル認証
SSID: IoT        → VLAN 30(IoTデバイス)     → WPA2-PSK + APアイソレーション
```

- **SSID-VLAN マッピング**により、同一APから異なるセキュリティレベルのネットワークを提供します
- ゲストネットワークは社内ネットワークと**完全に分離**する必要があります
- Dynamic VLANを使用し、RADIUS認証結果に基づいてVLANを動的に割り当てることも可能です

#### APアイソレーション（クライアント分離）

- 同一SSIDに接続する端末間の**直接通信を禁止**する機能です
- ゲストネットワークやIoTネットワークで有効です
- 端末間のARP Spoofing等の攻撃を防止します

#### 電波管理とセキュリティ

| 対策 | 内容 |
|------|------|
| **電波出力の制限** | 建物外への電波漏洩を最小限にします |
| **チャネル設計** | 干渉を避けつつ、適切なカバレッジを確保します |
| **指向性アンテナ** | 電波の方向を制御し、不要な範囲への漏洩を防ぎます |
| **電波遮蔽** | 窓ガラスの電波遮蔽フィルム等で物理的に対策します |

#### キャプティブポータル

- ゲスト向け無線LANで使用される**Web認証方式**です
- 端末がHTTP通信を行うと認証ページにリダイレクトされます
- 利用規約への同意、メールアドレス登録、ワンタイムパスワード等で認証します
- **通信自体は暗号化されない場合が多い**ため、Enhanced Openとの併用が推奨されます

#### 検疫ネットワーク（NAC: Network Access Control）

- 端末がネットワークに接続する前に**セキュリティ要件の充足を確認**する仕組みです
- OS/ウイルス定義ファイルの最新性、パーソナルFWの有効性等を検査します
- 要件を満たさない端末は**隔離VLAN(検疫VLAN)**に接続され、修復を促されます
- IEEE 802.1XとRADIUSを組み合わせて実装されることが多いです

### SSIDとステルスSSID

- SSIDはネットワーク識別子であり、「非公開(ステルス)」設定も可能です
- ただしビーコンを止めても、接続フレームなどからSSIDは容易に推測できるため、**セキュリティ対策とはみなされません**

### MACアドレスフィルタリング

- AP側に許可MACアドレス一覧を設定する方式です
- しかしMACアドレスは容易に偽装できるため、**補助的な対策** に留まります

### WPA3との関係

- WPA3ではEnhanced Openが標準化されています
- WPA3-Personalとは別物です

### SAEとOWEの違い

| 技術 | 用途 |
|---|---|
| SAE | パスワード認証(WPA3-Personal) |
| OWE | 認証なし暗号化(Enhanced Open) |

### 公衆無線LAN対策の全体像

| 技術 | 目的 |
|---|---|
| Enhanced Open | 無線区間盗聴防止 |
| HTTPS | 通信内容保護 |
| VPN | 全通信暗号化 |

### WPA3で追加されたポイント

- SAEによるPSK認証強化が行われています
- OWE(Opportunistic Wireless Encryption)によるオープンネットワーク暗号化が可能です
- 旧端末との後方互換性の課題があります

---

## まとめ

### 無線LANセキュリティ方式の総合比較

| 項目 | WEP | WPA | WPA2 | WPA3 | Enhanced Open |
|------|-----|-----|------|------|--------------|
| 策定時期 | 1997年 | 2003年 | 2004年 | 2018年 | 2018年 |
| 暗号アルゴリズム | RC4 | RC4 | AES | AES | AES |
| 暗号プロトコル | WEP | TKIP | CCMP | CCMP/GCMP | CCMP |
| 鍵長 | 40/104bit | 128bit | 128bit | 128/256bit | 128bit |
| 完全性保護 | CRC32 | Michael | CBC-MAC | CBC-MAC/GHASH | CBC-MAC |
| 認証(Personal) | 共有鍵 | PSK | PSK | SAE | なし |
| 認証(Enterprise) | - | 802.1X | 802.1X | 802.1X | - |
| PMF(802.11w) | × | × | オプション | **必須** | - |
| 前方秘匿性 | × | × | × | **○** | ○(OWE) |
| 安全性 | ×(使用禁止) | △(非推奨) | ○ | ◎ | ○(認証なし) |

### 認証方式の比較

| 認証方式 | 認証要素 | サーバ証明書 | クライアント証明書 | 安全性 | 導入コスト |
|---------|---------|------------|-----------------|--------|----------|
| WPA2/3-PSK | パスフレーズ | 不要 | 不要 | △ | 低 |
| WPA3-SAE | パスフレーズ | 不要 | 不要 | ○ | 低 |
| PEAP | ID/パスワード | 必要 | 不要 | ○ | 中 |
| EAP-TTLS | ID/パスワード | 必要 | 不要 | ○ | 中 |
| **EAP-TLS** | **証明書** | **必要** | **必要** | **◎** | **高** |
| EAP-FAST | ID/パスワード | 不要(PAC) | 不要 | ○ | 中 |

### 鍵階層のまとめ

| 鍵 | 導出元 | 用途 | 共有範囲 |
|----|-------|------|---------|
| MSK | EAP認証 | PMKの元(Enterprise) | RADIUS↔STA |
| PMK | PSK or MSK | PTK導出の元 | AP↔STA |
| PTK(KCK) | PMK+Nonce+MAC | ハンドシェイクMIC | AP↔STA |
| PTK(KEK) | PMK+Nonce+MAC | GTK配送暗号化 | AP↔STA |
| PTK(TK) | PMK+Nonce+MAC | ユニキャスト暗号化 | AP↔STA |
| GTK | GMK | ブロードキャスト暗号化 | AP↔全STA |
| IGTK | AP生成 | 管理フレーム保護(PMF) | AP↔全STA |

### 無線LAN攻撃と対策の対応表

| 攻撃 | 対象 | 対策 |
|------|------|------|
| WEP鍵解読(FMS/PTW) | WEP | WPA2/WPA3への移行 |
| オフライン辞書攻撃 | WPA2-PSK | 長いパスフレーズ、WPA3-SAE |
| KRACK | WPA2 | パッチ適用、WPA3移行 |
| Dragonblood | WPA3-SAE | ファームウェア更新 |
| FragAttacks | 全方式 | OS/ファームウェア更新 |
| Deauth攻撃 | 管理フレーム | PMF(802.11w)の有効化 |
| Evil Twin / Rogue AP | SSID信頼 | 802.1X証明書認証、WIDS/WIPS |
| War Driving | 電波漏洩 | 電波出力管理、暗号化必須 |
| WPS PIN攻撃 | WPS | WPS無効化 |

### 試験対策：出題テーマ別の重要度

| テーマ | 午前II | 午後 | 重要キーワード |
|--------|-------|------|--------------|
| WPA2/WPA3の暗号方式 | ★★★ | ★★ | CCMP/GCMP、AES、TKIP非推奨 |
| 802.1X/EAP認証 | ★★★ | ★★★ | サプリカント/オーセンティケータ/RADIUS |
| EAP-TLS | ★★★ | ★★★ | クライアント証明書、相互認証、PKI |
| 4-wayハンドシェイク | ★★ | ★★★ | PMK/PTK/GTK、ANonce/SNonce |
| WPA3-SAE | ★★★ | ★★ | Dragonfly、前方秘匿性、PMF必須 |
| Enhanced Open(OWE) | ★★ | ★ | DH鍵交換、認証なし暗号化 |
| KRACK攻撃 | ★★ | ★★ | Nonce再利用、パッチ適用 |
| 不正AP/Evil Twin | ★★ | ★★★ | WIDS/WIPS、証明書認証 |
| VLAN連携・セグメント分離 | ★ | ★★★ | SSID-VLANマッピング、ゲスト分離 |
| 鍵階層(PMK/PTK/GTK) | ★★ | ★★★ | KCK/KEK/TK、PSK vs Enterprise |
| WEPの脆弱性 | ★★ | ★ | RC4、IV再利用、CRC32 |
| PMF(802.11w) | ★★ | ★★ | 管理フレーム保護、IGTK、BIP |
