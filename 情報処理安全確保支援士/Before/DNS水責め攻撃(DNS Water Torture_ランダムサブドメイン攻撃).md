# DNS水責め攻撃(DNS Water Torture/ランダムサブドメイン攻撃)

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報処理安全確保支援士平成29年春期 午前Ⅱ 問6](https://www.sc-siken.com/kakomon/29_haru/am2_6.html)  

## DNS水責め攻撃とは何か

### 定義
**DNS水責め攻撃(DNS Water Torture Attack)** とは、キャッシュDNSサーバに対して **存在しないランダムなサブドメイン名** を大量に問い合わせさせることで、結果的に **権威DNSサーバへ過剰な問い合わせを集中させ、サービス不能(DoS)状態に陥らせる攻撃** です。  

別名：  

- ランダムサブドメイン攻撃
- DNS Query Flood(亜種)

## 攻撃の具体的な手口(ステップ解説)

### 攻撃の流れ(時系列)

1. 攻撃者が多数の端末(Bot)を用意  
2. 各端末がキャッシュDNSサーバに対し、以下のような問い合わせを大量送信  

```
a1x9k.example.com
b7q3m.example.com
z92ld.example.com
```

3. これらは **毎回ランダム生成されるためキャッシュに存在しない**
4. キャッシュDNSは「未キャッシュ」と判断し、**権威DNSサーバへ問い合わせを転送**
5. 権威DNSサーバが大量クエリを処理できず、応答遅延や停止が発生

### 技術的ポイント
- キャッシュDNSは **キャッシュヒット率が極端に低下**
- キャッシュが効かないため、**問い合わせが必ず権威DNSへ到達**
- 通常のDNSキャッシュ最適化が機能しない

## 攻撃の「目的」(試験で最重要)

### 直接の目的

**権威DNSサーバに過剰な負荷を与え、正規利用者の名前解決を妨害すること**です。  

### 間接的な狙い

- Webサイト、メール、API 等の **基盤インフラを機能停止させる**
- 企業/組織の **可用性(Availability)を破壊する**
- DDoS攻撃の一形態として、**検知/遮断を困難にする**

## なぜ「キャッシュDNS」が踏み台になるのか

DNSの基本仕様(RFC 1034/1035)は、下記の通りです。  

- キャッシュDNSは、下記について、必ず権威DNSへ問い合わせを行う
  - **一度も問い合わせたことのない名前**  
  - **存在しない名前(NXDOMAIN含む)**  

→ 攻撃者はこの **正当な仕様** を悪用  

## DNS水責め攻撃の特徴整理

| 観点 | 内容 |
|---|---|
| 攻撃対象 | 権威DNSサーバ |
| 踏み台 | キャッシュDNSサーバ |
| 手法 | ランダムなサブドメイン名を大量生成 |
| キャッシュ | 効かない(毎回未キャッシュ) |
| 目的 | 可用性低下/DoS |
| 種別 | DDoS攻撃(間接型) |

## 他のDNS攻撃との違い

### DNS水責め vs DNSアンプ攻撃

| 項目 | DNS水責め | DNSアンプ |
|---|---|---|
| 主目的 | 権威DNS過負荷 | 帯域枯渇 |
| 悪用点 | キャッシュ不成立 | 応答サイズ増幅 |
| 送信元IP偽装 | 不要 | 必要 |
| 反射 | しない | する |

## 対策

### 権威DNS側の対策

- **Response Rate Limiting(RRL)**
- 存在しない名前への **応答制限**
- Anycast 配置による負荷分散

### キャッシュDNS側の対策

- 異常なランダムクエリの検知
- 問い合わせレート制限
- 不正クライアントの遮断

### 運用/設計面

- 権威DNSの **冗長化**
- CDN/DNSプロバイダの活用
- 監視(NXDOMAIN率の急増検知)

## 関連知識

### NXDOMAIN

- 存在しないドメイン名への応答コード
- 水責め攻撃では NXDOMAIN が大量発生する

### Anycast DNS

- 同一IPを複数拠点に配置
- 攻撃トラフィックを地理的に分散可能

### DNSSECとの関係

- **DNSSECは水責め攻撃を防げない**
- 改ざん防止と可用性対策は別問題
