# MITB(Man-in-the-Browser)攻撃とトランザクション署名

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報処理安全確保支援士令和4年春期 午前Ⅱ 問11](https://www.sc-siken.com/kakomon/04_haru/am2_11.html)  

## MITB(Man-in-the-Browser)攻撃とは  

MITB(Man-in-the-Browser)攻撃は、**ユーザの Web ブラウザ内部にマルウェアを侵入させ、通信内容や画面情報を攻撃者が改ざんする攻撃手法**です。  
これは中間者攻撃(MITM)の発展形であり、**ブラウザ内部で起こるため、HTTPS(TLS)で通信を暗号化しても防止できません**。  

## MITB攻撃の特徴  

### HTTPS では防げない攻撃  

MITM は通信経路を盗聴しますが、MITB は下記などを攻撃者が自由に操作できます。  
つまり、TLSによる暗号化は無意味になってしまいます。  

- **通信の送信前**(ブラウザ内部)  
- **画面表示の段階**  
- **ユーザ入力情報**  
- **送金金額/振込先書換え**

### MITBで何ができるか(代表例)

- オンラインバンキングの送金先口座番号を書き換える  
- 送金金額をユーザの意図と異なる金額へ変更  
- 偽画面を表示し、ユーザに誤操作を誘導  
- OTP(ワンタイムパスワード)の奪取  
- トランザクション結果画面を偽装  

## MITB攻撃に使われる代表的マルウェア  

| マルウェア | 特徴 |
|------------|-------|
| Zeus | ブラウザAPIフックの代表、バンキングマルウェアの象徴 |
| SpyEye | Zeus の亜種、フォーム書換え |
| Dyreza | TLSを迂回して認証情報を盗む |
| Gozi | 金融情報窃取、ブラウザ操作の改ざん |

これらは共通して「Webブラウザ内部で動作する」点が特徴です。  

## MITB攻撃の流れ(概念図)

1. PCがマルウェア感染  
2. ブラウザ(IE/Chrome/Firefox)の API がフックされる  
3. ユーザが正規サイトへログイン  
4. 送金内容を入力  
5. ブラウザ内部で攻撃者が**送信データを書き換え**  
6. 改ざん済みデータがサーバに送信  
7. 表示画面は偽装され、ユーザは異常に気付けない  

## MITB を防ぐ仕組み：トランザクション署名(Transaction Signature)  

### 定義  

**取引(トランザクション)内容そのものに電子署名を行い、改ざんを検知する方式です。**
送信内容が書き換えられた場合、**署名値が一致しなくなり攻撃を防止できます**。  

### 署名対象の例  

これらをまとめてハッシュ化し、電子署名(RSA/ECDSA、またはHMAC)を生成します。  

- 振込先口座番号  
- 金額  
- 取引日付  
- 取引種別  

### トランザクション署名の流れ  

トランザクション署名によって、ブラウザが乗っ取られても攻撃者は正しい署名値を作れません。  

1. 取引内容(例：振込先/金額)をユーザが外部デバイス(トークン)へ入力  
2. トークンが内容をハッシュ化し署名値を生成  
3. 生成された署名値をユーザがシステムに入力  
4. サーバ側が取引内容と署名値を照合  
5. 改ざんがあれば署名検証が失敗 → 取引拒否  

## 6. トランザクション署名が MITB に強い理由  

MITB が成立するには、攻撃者が改ざんした送金内容が「正当なもの」としてサーバに受理される必要があります。  
しかし、トランザクション署名では、下記のデータが一致しないため検証に失敗することになります。  
これによって、攻撃者が変更したデータが誤って通信されてしまうことを防止します。  

1. 利用者が認証デバイスに入力した内容  
2. 攻撃者がブラウザ内部で改ざんした内容  

## 7. MITB対策の周辺技術(補完的技術)

### 7.1 多要素認証(MFA)

- パスワード + OTP  
- 生体認証(FIDO2/WebAuthn)  

※ただし MITB(ログイン後の改ざん)には不十分です。  

### 7.2 セキュアブラウザ

- 通常ブラウザと分離  
- 改ざん検知機能  
- 金融機関専用アプリなどで採用  

### 7.3 デバイス証明書

- 正当な端末からのみアクセスを許可  
- 攻撃者の環境からの不正アクセスを排除  

### 7.4 不正送金対策(銀行業界の実装例)

- 送金内容の確認通知(SMS/Push)  
- 振込先チェック(過去取引との乖離検出)  
- 行動分析(AI 不正検知)  

## 8. MITM と MITB の比較(試験頻出)

| 項目 | MITM | MITB |
|------|------|------|
| 攻撃位置 | ネットワーク経路 | ブラウザ内部 |
| HTTPS の有効性 | 有効 | 無効 |
| 攻撃影響 | 盗聴/改ざん可能 | 入力/表示/送信内容の全支配 |
| 対策 | TLS/証明書ピンニング | トランザクション署名、セキュアブラウザ |
