# Rootkit(ルートキット)

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報セキュリティスペシャリスト平成27年春期 午前Ⅱ 問12](https://www.sc-siken.com/kakomon/27_haru/am2_12.html)  

### 1. rootkit とは何か

**rootkit(ルートキット)**とは、OS やミドルウェアの機能をすり替え/隠蔽することで、マルウェアや不正活動の存在そのものを隠すためのコンポーネントを指します。  

- 元々は Unix 系 OS の **root(管理者権限)** を奪った攻撃者が侵入を隠すために使ったツール群が語源  
- 現在では Windows/Linux/macOS/モバイルOS/UEFI/ハイパーバイザなど、広いレイヤに存在しうる **「隠蔽型マルウェア」** の総称として用いられる。  

#### 1.1 rootkit の主な目的

1. **マルウェアの存在の隠蔽(ステルス性の確保)**  
2. **継続的な不正アクセス(永続化)**  
3. **追加マルウェアのインストール/制御**  
4. **認証情報/機密情報の窃取**  

### 2. rootkit の種類(レイヤ別整理)

rootkit は「どのレイヤを改ざん/フックするか」で分類されます。  

#### 2.1 ユーザモード rootkit

- DLL インジェクション/API フックなどにより、`ps`/`netstat`/タスクマネージャ等の表示から不正プロセスを隠蔽  
- アプリケーション層で完結するため実装容易だが、**OS カーネルからの検査には比較的弱い**です。  

#### 2.2 カーネルモード rootkit

- OS カーネル空間でドライバとして動作し、システムコールテーブル(SSDT)やカーネル関数をフックして隠蔽  
- プロセス/ファイル/レジストリ/ネットワーク接続を OS レベルで隠せるため、**検出が非常に困難**  

代表的技術：  

- **SSDT Hook**：システムコールテーブルを書き換え、特定API呼び出しを rootkit に転送  
- **Inline Hook**：関数先頭の命令を書き換えジャンプさせる  
- **DKOM(Direct Kernel Object Manipulation)**：カーネル内のプロセスリストなどのオブジェクトを直接書き換え、プロセスを一覧から除外  

#### 2.3 Bootkit/MBR/UEFI rootkit

- MBR/VBR/UEFI など **ブートプロセス**に侵入し、OS 起動前に自身をロードするタイプ  
- OS の保護機構が有効になる前に動作するため、検出と除去が困難  

#### 2.4 ファームウェア rootkit

- HDD/SSD/ネットワーク機器/BIOS/UEFI など、**ハードウェアファームウェア**に侵入/改変されるタイプ  
- OS 再インストール後も残存する可能性があり、実務では **機器交換やファーム再フラッシュ**が必要  

#### 2.5 ハイパーバイザ型 rootkit

- 仮想化環境の **ハイパーバイザ層**に潜り込み、ゲスト OS 全体を監視/操作  
- ゲスト OS から見えないレイヤで動作するため、非常に高いステルス性  

### 3. rootkit の代表的な隠蔽テクニック

#### 3.1 API/システムコールフック

- ファイル列挙/プロセス列挙/接続一覧取得 API の戻り値を書き換え、不正プロセス／不正ファイル／不正ポートを一覧から除外  

#### 3.2 DKOM(Direct Kernel Object Manipulation)

- `EPROCESS` などのカーネルオブジェクトのリンクリストを書き換え、対象プロセスを OS の管理テーブルから「見えなくする」  

#### 3.3 ドライバロード/偽装

- 正規ドライバに見せかけたカーネルドライバをロードし、カーネル権限で任意コードを実行/隠蔽処理  

#### 3.4 ログ改ざん

- OS ログ/監査ログ/アプリケーションログを改ざん／削除して痕跡隠滅  

### 4. rootkit の検出技術(Anti-rootkit)

#### 4.1 シグネチャベース

- 既知 rootkit のバイナリパターン/ドライバ名/レジストリ値などをもとに検出  
- 新種/亜種/難読化 rootkit には限界  

#### 4.2 整合性検査(インテグリティチェック)

- 「**信頼できる基準状態**」と比較して改ざんを検出する方式  
  - カーネルコードセクションのハッシュ  
  - システムコールテーブルの整合性  
  - ファイルシステムメタデータの比較  
- Trusted Boot/Secure Boot/File Integrity Monitoring とも関連  

#### 4.3 メモリフォレンジック

- メモリダンプを取得し、下記などを解析して検出します。  
  - 隠れプロセス  
  - 不正ドライバ  
  - フックされた関数  
- Volatility などのメモリフォレンジックツールを使用  

#### 4.4 挙動分析(ビヘイビアベース)

- 権限昇格/不審なドライバロード/カーネルAPI呼び出しパターンなどを監視  
- EDR(Endpoint Detection & Response)が代表例で、ログ/メモリアクセス/ネットワーク等を総合的に分析  

### 5. rootkit への対策

#### 5.1 侵入を防ぐための予防策

- OS/ミドルウェア/ドライバの **最新パッチ適用**  
- 不要な管理者権限の排除(最小権限の原則)  
- 正規署名ドライバのみロードする設定(Driver Signing Enforcement)  
- UEFI Secure Boot を有効化し、不正ブートローダを阻止  
- 不審なソフトウェア/クラックツール/怪しいドライバを導入しない  

#### 5.2 感染後の対応

rootkit は OS コードレベルで汚染するため、**完全駆除が非常に困難**とされます。  
実務では以下の対応が推奨されることが多いです。  

1. 信頼できる外部メディアから起動し、重要データをバックアップ  
2. ストレージの完全初期化と OS のクリーンインストール  
3. 必要に応じてファームウェア再フラッシュ/機器交換  
4. 再構築後はパッチ/設定/権限などの見直しを実施  

### 6. rootkit と他マルウェアとの関係

rootkit は単独で動作する「攻撃本体」というより、**他マルウェアのステルス化/永続化を支援するモジュール**として用いられることが多いです。  

#### 6.1 ボットネット＋rootkit

- C2(Command & Control)通信/スパム送信/DDoS 機能を持つボットに rootkit が組み合わされる  
- rootkit がボットプロセス/通信を隠蔽し、長期潜伏を実現  

#### 6.2 ランサムウェア＋rootkit

- 暗号化処理の前にセキュリティ製品を無効化し、自身の痕跡を隠すために rootkit を併用  

#### 6.3 APT 攻撃＋bootkit/UEFI rootkit

- 国家レベル/高度標的型攻撃では、ブートプロセスやファームウェアを侵害し、**数年単位の長期潜伏**を行うケースも報告されています。  

### 7. 周辺知識(試験で押さえるポイント)

#### 7.1 ステルス型ウイルス

- ファイルサイズ/タイムスタンプ/チェックサムを偽装し、既存 AV の検知を回避するウイルスです。  
- rootkit はその発展形として、より低レイヤでの隠蔽を狙います。  

#### 7.2 ユーザモード／カーネルモードの違い

| 項目 | ユーザモードマルウェア | カーネルモード rootkit |
|------|------------------------|--------------------------|
| 権限 | OSの制限あり | OS全体を支配 |
| ステルス性 | 中程度 | 非常に高い |
| 検出難易度 | 中 | 高 |

#### 7.3 Secure Boot/Trusted Boot

- UEFI Secure Boot：署名付きブートローダのみ起動を許可し、bootkit や UEFI rootkit を防ぐ仕組み  
- Trusted/Measured Boot：TPM に起動プロセスの測定値を保存し、リモートからの検証(Remote Attestation)を可能にする  

#### 7.4 EDR/XDR

- 挙動/イベントログ/メモリアクセス/ネットワーク通信を統合監視し、rootkit を含む高度な脅威を検知/対応する仕組み  
- 従来型 AV の「シグネチャ中心」から、**ふるまい/相関分析中心**へと移行  
