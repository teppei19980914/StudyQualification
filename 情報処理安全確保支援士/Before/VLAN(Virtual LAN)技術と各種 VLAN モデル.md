# VLAN(Virtual LAN)技術と各種 VLAN モデル

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報セキュリティスペシャリスト平成21年秋期 午前Ⅱ 問13](https://www.sc-siken.com/kakomon/21_aki/am2_13.html)  
[情報処理安全確保支援士平成31年春期 午前Ⅱ 問12](https://www.sc-siken.com/kakomon/31_haru/am2_12.html)  

## VLAN(Virtual LAN)とは  

VLAN とは、**物理ネットワークを仮想的に分割し、独立した複数のネットワークとして扱う技術**です。  
IEEE 802.1Q により標準化され、スイッチ全体を柔軟に論理分割します。  

### VLAN の目的

- **セキュリティ向上**(ブロードキャストドメイン分離)  
- **ネットワーク負荷軽減**  
- **運用柔軟性の向上(異動時に配線変更不要)**  
- **ネットワーク管理の容易化**  

### VLAN の分類

1. ポートベース VLAN(Port-based VLAN)  
2. アドレスベース VLAN(MAC-based/IP-based VLAN)  
3. ポリシーベース VLAN(Policy-based VLAN)  
4. タグ VLAN(IEEE 802.1Q Tag VLAN)  

### ポートベース VLAN(Port-based VLAN)

最も一般的な VLAN で、**スイッチの物理ポート単位で VLAN を割り当てる方式**です。  

例：  

- ポート 1–4 → VLAN10  
- ポート 5–8 → VLAN20  

#### 利点

- 設定が容易  
- ほぼ全機種で利用可能  

#### 欠点

- 端末を他ポートへ移動すると設定変更が必要  

### アドレスベース VLAN

端末のアドレス情報に基づいて VLAN を割り当てる方式です。  

#### MAC アドレスベース VLAN

- PC の **MAC アドレス** を基準に VLAN を割り当て  
- 端末がどのポートに移動しても VLAN が保持される  

#### IP アドレスベース VLAN  

- 端末の **IPアドレス範囲** で VLAN を割り当て  
- L3 スイッチで多く利用される方式  

#### 利点

- 端末移動に対して強い  
- 部署や利用 IP 範囲による柔軟な分類  

#### 欠点

- スイッチによる追加処理が増え負荷が高くなる  

###  ポリシーベース VLAN(Policy-based VLAN)

ネットワーク管理者が定義する **ポリシー(ルール)** に基づいて VLAN を動的割り当てする方式です。  

使用される属性例：  

- MAC アドレス  
- IP アドレス  
- プロトコル(IPv4/IPv6/IPX など)  
- ユーザ認証情報(IEEE 802.1X)  
- アプリケーション情報  

#### 利点

- **高い柔軟性**  
- BYODや大規模企業ネットワークで有効  

#### 欠点

- 構成が複雑  
- スイッチに高い処理能力が必要  

### タグ VLAN(IEEE 802.1Q VLAN)

スイッチ間で VLAN を運ぶために標準化された方式です。  
Ethernet フレームへ **4 バイトの VLAN タグ** を挿入し VLAN を識別します。  

#### タグ構造(802.1Q Tag：4 バイト)

| フィールド | ビット数 | 内容 |
|-----------|---------|------|
| **TPID** | 16bit | タグ識別子(常に 0x8100) |
| **PCP** | 3bit | 優先度(QoS) |
| **DEI** | 1bit | 破棄可否指標 |
| **VLAN ID** | 12bit | VLAN番号(1～4094) |

### アクセスポートとトランクポート

#### アクセスポート(Access Port)

- 1つの VLAN のみ所属  
- 端末(PC)接続用  
- フレームは **タグなし(untagged)**  

#### トランクポート(Trunk Port)

- 複数 VLAN を運ぶ  
- スイッチ間接続に利用  
- フレームは **タグ付き(tagged)**  

## VLAN の周辺知識

### ブロードキャストドメインの分割

VLAN を分ける＝L2 ブロードキャストが分離されます。  

### VLAN 間ルーティング(Inter-VLAN Routing)

異なる VLAN 同士は通信できないため **L3 スイッチまたはルータが必要**です。  

方式：  

- Router-on-a-stick  
- L3 スイッチの SVI(Switch Virtual Interface)  

### VLAN 登録プロトコル  

- **GVRP/MVRP**  
    → VLAN 情報を自動伝播  

### VLAN Hopping 攻撃  

攻撃者が VLAN を跨いで不正通信を行う攻撃です。  

主な手法：  

- Switch Spoofing  
- Double Tagging Attack  

対策：  

- 不要なトランクポートを閉じる  
- ネイティブ VLAN を変更  
- 802.1X 認証の利用  

### 認証VLAN

ネットワーク接続前に「MACアドレス認証」「ID+パスワードによる認証」「IEEE 802.1x」などでユーザを特定し、ユーザごとに所属すべきVLANに振り分けることで端末のグルーピングを行います。  
これにより、接続ポート単位やアドレス単位というグルーピングができない無線アクセスポイントへの接続でもVLANに対応させることができます。  

### VXLAN

イーサネットフレーム全体をIP/UDPヘッダーとVXLANヘッダーでカプセル化することで、レイヤー3ネットワーク上に論理的なレイヤー2ネットワークを構築するトンネリングプロトコルです。  
離れたサブネットに属する複数のレイヤー2ネットワークをつなぐ、共通のレイヤー2ネットワークを構築するために使用されます。  
VXLANセグメント同士はカプセル化を行うVTEP(Virtual Tunnel End Point)を経由して通信を行います。
