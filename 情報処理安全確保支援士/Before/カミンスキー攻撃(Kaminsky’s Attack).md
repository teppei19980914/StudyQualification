# カミンスキー攻撃(Kaminsky’s Attack)
― 情報処理安全確保支援士 平成29年秋期 午前Ⅱ 問6 対応 ―

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報処理安全確保支援士平成29年秋期 午前Ⅱ 問6](https://www.sc-siken.com/kakomon/29_aki/am2_6.html)  

## カミンスキー攻撃とは(概要)

### 定義(エビデンス)

- Dan Kaminsky により 2008 年に公表
- DNS の設計上の弱点を突いた **DNSキャッシュポイズニング攻撃の高度化手法**

**カミンスキー攻撃とは、DNSキャッシュサーバ(フルサービスリゾルバ)に偽のDNS応答を注入し、正規ドメインの名前解決結果を攻撃者の指定したIPアドレスに書き換える攻撃です。**

## DNSの前提知識(攻撃理解に必須)

### DNSキャッシュの仕組み

- クライアント → キャッシュDNS(リゾルバ)へ問い合わせ
- キャッシュDNSは結果を一定時間保存(TTL)
- 次回以降はキャッシュを利用

→ **キャッシュが汚染されると、多数の利用者が被害を受ける**

### 従来のDNS応答検証

DNS 応答の正当性確認は、主に以下のみです。  

- トランザクションID(16bit)
- 問い合わせ元IP/ポート
- 問い合わせ内容(ドメイン名)

→ 暗号学的な認証は存在しない(DNSSEC導入前)

## カミンスキー攻撃の核心的アイデア

### 従来型キャッシュポイズニングの問題点

- 同一ドメインへの問い合わせはキャッシュが効く
- 攻撃チャンスは TTL が切れた瞬間のみ
- 成功確率が低い

### カミンスキー攻撃のブレークスルー

**存在しないランダムなサブドメインを大量に問い合わせさせます。**

例：

```
aaaa.example.com
bbbb.example.com
cccc.example.com
```

- 毎回キャッシュミスが発生
- 毎回権威DNSへ問い合わせが行われる
- 攻撃チャンスを無限に生成できる

## 攻撃の具体的な流れ

### 攻撃ステップ

1. 攻撃者が被害DNSにランダムサブドメインを問い合わせさせる
2. キャッシュDNSは権威DNSへ再帰問い合わせ
3. 攻撃者が大量の**偽DNS応答**を先回り送信
4. トランザクションIDが一致すると偽応答がキャッシュされる
5. **NSレコードやAレコードが汚染される**

### なぜ致命的か

- 偽の **NSレコード** を注入可能
- ドメイン全体の名前解決を支配できる
- フィッシング、MITM、マルウェア配布に直結

## 攻撃成功の本質的要因

| 要因 | 説明 |
|---|---|
| トランザクションIDが16bit | 総当たり可能 |
| UDP通信 | 応答の正当性検証なし |
| キャッシュ機構 | 影響範囲が大きい |
| DNSSEC未導入 | 暗号検証不可 |

## 対策

### 送信元ポートランダム化(RFC 5452)

- 従来：UDP 53 固定
- 対策後：エフェメラルポート使用

→ 攻撃成功確率を大幅に低下

### トランザクションIDの乱数強化

- 推測困難な乱数を使用

### DNSSEC

- DNS応答に電子署名
- 正当性を暗号学的に検証

→ **カミンスキー攻撃を本質的に防止**

## 関連知識①：DNSSECとの関係

| 項目 | 内容 |
|---|---|
| DNSSEC | DNS応答に電子署名 |
| カミンスキー攻撃 | DNSSEC未導入環境で成立 |
| 試験対策 | 「DNSSECは本質対策」と覚える |

## 関連知識②：DNSアンプ攻撃との違い

| 攻撃 | 目的 |
|---|---|
| カミンスキー攻撃 | キャッシュ汚染 |
| DNSアンプ攻撃 | DDoS(帯域枯渇) |

→ **目的が全く異なる**

## 関連知識③：認証という観点での位置づけ

DNSは本来、下記の通りです。  

- 認証なし
- 信頼前提のプロトコル

→ DNSSEC は **DNSにおける認証の導入**
