# クロスサイトスクリプティング(XSS)とセキュリティ対策

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報セキュリティスペシャリスト平成21年秋期 午前Ⅱ 問7](https://www.sc-siken.com/kakomon/21_aki/am2_7.html)  

## クロスサイトスクリプティング(XSS)とは

### 定義

Webアプリケーションの入力値処理の不備を利用して、攻撃者が任意のスクリプトをWebページに埋め込み、利用者のブラウザ上で実行させる攻撃のことです。  

### XSSが成立する本質的原因

XSSは 「Webサーバ側」ではなく「利用者のブラウザ側」でスクリプトが実行される ことが最大の特徴です。  

#### 成立条件

* ユーザ入力を含むデータをHTMLに出力  
* 出力時に 適切なエスケープ処理が行われていない  
* ブラウザがそれを スクリプトとして解釈  

### XSSの主な種類

#### 反射型XSS(Reflected XSS)

入力値がレスポンスに反映され、URLパラメータなどが攻撃店となります。  

例：  
```
https://example.com/search?q=<script>alert(1)</script>
```

##### 特徴

* メールやURLリンク経由で誘導  
* 保存されない  

#### 蓄積型XSS(Stored XSS)

悪意のあるスクリプトがDB等に保存され、多数の利用者に影響します。  

例：掲示板/プロフィール欄/コメント欄等  

##### 危険性

* 被害が継続/拡大しやすい  
* 管理者権限奪取につながる可能性  

#### DOM Based XSS

JavaScriptのDOM操作の不備であり、サーバを経由せずクライアント側のみで発生します。  

##### 特徴

* サーバ側ログに残らない  
* 検知が難しい  

## XSSによって引き起こされる被害

### 主な被害例

* セッションIDの窃取(セッションハイジャック)  
* なりすまし操作  
* フィッシング画面の表示  
* マルウェア配布  

試験で重要な観点：  
```
XSSは 認証を破る攻撃ではなく、認証後の利用者を攻撃する
```

## XSSのセキュリティ対策

### 出力時エスケープ

原則：  
```
「入力時は信用しない」ではなく、「出力時に文脈に応じてエスケープする」ことが必要
```

例(HTML文脈)：  
| 文字  | エスケープ    |
| --- | -------- |
| `<` | `&lt;`   |
| `>` | `&gt;`   |
| `"` | `&quot;` |
| `'` | `&#x27;` |
| `&` | `&amp;`  |

### HTTPレスポンスヘッダによる対策

Content-Security-Policy(CSP)  
```
Content-Security-Policy: script-src 'self'
```

* 外部/インラインスクリプトの実行制御  
* XSS被害の抑止(完全防止ではない)  

### Cookieの保護(被害軽減)

| 属性       | 効果                     |
| -------- | ---------------------- |
| HttpOnly | JavaScriptからCookie取得不可 |
| Secure   | HTTPS通信時のみ送信           |
| SameSite | CSRF対策にも有効             |

**※ Cookie保護は XSS対策そのものではなく被害抑制**  

### 入力値検証

* 文字数制限  
* 形式チェック(メール、数値など)  

**入力チェックのみでは不十分**  

## XSSと他攻撃との比較

| 攻撃           | 実行場所    | 主な目的    |
| ------------ | ------- | ------- |
| XSS          | 利用者ブラウザ | セッション窃取 |
| SQLインジェクション  | DB      | データ改ざん  |
| CSRF         | 利用者ブラウザ | 意図しない操作 |
| コマンドインジェクション | OS      | コマンド実行  |

## 関連知識

### OWASP Top 10

* XSS は長年 Top10 常連  
* 現在は「Injection」カテゴリに統合傾向  

### フレームワーク対策

* Thymeleaf/JSP/React 等は自動エスケープ機能あり  
* 無効化すると脆弱性が復活  
