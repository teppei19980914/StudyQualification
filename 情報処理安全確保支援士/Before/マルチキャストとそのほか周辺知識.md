# マルチキャストとそのほか周辺知識

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報処理安全確保支援士令和5年秋期 午前Ⅱ 問19](https://www.sc-siken.com/kakomon/05_aki/am2_19.html)  

## マルチキャスト

1つの送信者が、特定の多数の受信者に効率的にデータを配信する方式です。  
RFC 1112で正式に規定され、IPv4では224.0.0.0 ~ 239.255.255.255がマルチキャストアドレスです。  
上記IPアドレスの範囲はClassDに該当します。  

### IPアドレス別の分類

|範囲|名称|説明|
|:----|:----|:----|
|224.0.0.0/24|ローカルネットワーク制御用|ルータプロトコル（OSPF, RIP2, HSRP など）|
|224.0.1.0 ～|インターネット全体に拡散可能|NTP など|
|239.0.0.0/8|組織内・プライベートマルチキャスト|社内配信など|

### IPアドレスのクラス

接続可能なホスト台数の算出では、「ホスト部をすべて「0」にしたネットワークアドレス」と「ホスト部をすべて「1」にしたブロードキャストアドレス」を2台分引きます。  

|クラス|プライベートIPアドレスの範囲|ネットワーク部|ホスト部|接続可能なホスト台数|対象ネットワーク|
|:----|:----|:----|:----|:----|:----|
|A|10.0.0.0～10.255.255.255|8ビット|24ビット|16,777,214台|大規模|
|B|172.16.0.0～172.31.255.255|16ビット|16ビット|65,534台|中規模|
|C|192.168.0.0～192.168.255.255|24ビット|8ビット|254台|小規模|

**接続可能なホスト台数 = 2^ホストのビット数 - 2**  

### ユニキャスト/ブロードキャスト/マルチキャストの違い

|種類|送信対象|特徴|
|:----|:----|:----|
|ユニキャスト|1対1|通常のIP通信|
|ブロードキャスト|同一L2ネットワーク全員|ルータを越えない|
|マルチキャスト|1対多|加入者だけが受信/ルータ越え可能|

## IGMP（Internet Group Management Protocol）

受信側がマルチキャストグループへの参加/離脱をルータに通知するプロトコルです。  
IGMPの役割としては、下記のとおりです。  

1. 受信者が参加を表明  
2. ルータは配信ツリーを構築  
3. 不要になると離脱(Leave Report)を送信  

### IGMPスヌーピング（IGMP Snooping）

Layer2スイッチが IGMP メッセージを解析して、マルチキャストフレームを必要なポートのみに転送する機能です。  
これにより、無駄なトラフィックをネットワーク全体に流さず、帯域の無駄遣いを防止します。  

## マルチキャストルーティング(PIM)

マルチキャストはユニキャストと異なり、特別なルーティングが必要です。  
PIMの役割としては下記です。  

* マルチキャスト用の転送ツリー(配信経路)を構築  
* ルータ間のマルチキャスト経路管理  

### 代表的なプロトコル

* PIM-SM(Sparse Mode)  
* PIM-DM(Dense Mode)  

## L2マルチキャスト（マルチキャストMACアドレス）

IPv4マルチキャストアドレスは特定の規則でMACアドレスに変換されます。  
仕組みとしては下記です。  

* IPマルチキャストの下位23ビットをMACに埋め込む  
* 完全な1対1マッピングではなく重複(オーバラップ)があり得る  


[変換ルール]  
```TEXT
01:00:5E:00:00:00 ～ 01:00:5E:7F:FF:FF
```

## TTLとマルチキャストの伝搬範囲

TTL(Time To Live)とは、寿命を表し、一般的には伝搬範囲を指しています。  
マルチキャストパケットにもTTLが存在し、例は下記のとおりです。  

TTL1：ローカルネット内のみ  
TTL32：組織内で利用  
TTL255：Internet全体へ  
**※ TTLを誤設定すると、局所配信のつもりが広範囲へ流れてしまうため要注意です。**  
