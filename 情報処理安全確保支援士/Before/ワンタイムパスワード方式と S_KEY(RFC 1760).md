# ワンタイムパスワード方式と S/KEY(RFC 1760)

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報セキュリティスペシャリスト平成22年春期 午前Ⅱ 問4](https://www.sc-siken.com/kakomon/22_haru/am2_4.html)  

## 1. ワンタイムパスワード(OTP：One-Time Password)とは

ワンタイムパスワードとは、**利用するたびに異なるパスワードを生成し、1 回限り使用可能な認証方式**です。  
パスワードの盗聴/漏えい/リプレイ攻撃を強力に防ぐため、多要素認証の一部として広く利用されます。  

### OTP が防ぐ脅威

- パスワード盗聴(盗み見/キーロガー)  
- ネットワーク盗聴(スニッフィング)  
- リプレイ攻撃(過去の認証情報の再利用)  
- パスワードリスト攻撃(固定パスワード依存のため)  

## 2. OTP の方式分類(標準規格に基づく)

OTP には大きく 3つの方式があります。  

| 種別 | 説明 | 主な規格 |
|------|------|-----------|
| **チャレンジ/レスポンス型 OTP** | サーバの提示する値に応じて OTP を計算 | S/KEY(RFC 1760) |
| **時間同期型 OTP** | 時刻を元に定期的に OTP 生成 | TOTP(RFC 6238) |
| **イベント同期型 OTP** | カウンタに基づき OTP 生成 | HOTP(RFC 4226) |

## 3. S/KEY(RFC 1760)とは  

S/KEY は **ハッシュ関数を連鎖的に適用することでワンタイムパスワードを生成する方式**です。  
RFC 1760 により標準化され、初期のインターネットで広く使われました。  

### 特徴

- **オフライン攻撃に強い(ハッシュ関数の逆算困難性)**  
- サーバ側は **平文パスワードではなく「最後のハッシュ値」だけを保持**  
- チャレンジレスポンス型 OTP の基本として現在の認証方式の祖となる  

## 4. S/KEY の仕組み(認証プロトコル)

ユーザが保持する秘密情報：  
```
秘密の初期パスフレーズ P
```

サーバに登録する値：  
```
H^N(P)  (ハッシュ関数を N 回適用した値)
```

## 認証時の流れ(典型例)

1. サーバは次に必要な OTP の番号「i」を通知  
2. ユーザは OTP = H^(i)(P) を計算  
3. サーバは以下を確認  
   ```
   H(OTP) = H^(i+1)(P) ?(登録されている値)
   ```
4. 一致すれば認証成功  
5. サーバ側は登録値を H^(i)(P) に更新  

従って、**ユーザが送信する値は H^(i)(P) であり、生のパスワードやそれを逆算できる情報は含まれません。**  

## 5. 具体的な例

ユーザがパスフレーズ P を設定し、サーバは H^100(P) を保存するとします。  

認証 1 回目(i = 99)  
ユーザ送信：H^99(P)  
サーバは H(H^99(P)) = H^100(P) を確認し更新。

認証 2 回目(i = 98)  
同様に検証。

これを繰り返すことで **1 回限りのパスワード**が成立します。  

# 6. S/KEY の安全性(エビデンス：ハッシュ関数の性質)

S/KEY は以下の暗号学的性質に依存します。  

- **原像困難性**(H(x) から x を求めるのは困難)  
- **第二原像困難性**  
- **衝突困難性**  

攻撃者がネットワークを盗聴して OTP(H^i(P))を取得しても、**前の値 H^(i-1)(P) を求めることはできない**ため、リプレイ攻撃が成立しません。  

## 7. 現行方式との比較(HOTP/TOTP)

| 方式 | 利点 | 欠点 |
|------|------|------|
| **S/KEY(ハッシュ連鎖)** | サーバが秘密情報を持たない／実装が簡単 | 回数管理が必須／ユーザ側計算が重い |
| **HOTP(RFC 4226)** | デバイスとサーバのカウンタ同期のみ | カウンタずれが発生 |
| **TOTP(RFC 6238)** | Google Authenticator などで主流 | デバイスとサーバの時刻同期が必要 |

## 8. OTP の周辺知識(支援士でセット問われる)

## ■ リプレイ攻撃防止  

OTP は「一度使った値は再利用不可」のため非常に強力です。  

## ■ 多要素認証(MFA)  

OTP は「所持要素」を構成し、以下と組み合わせて強化します。  

- 知識要素(パスワード)  
- 所持要素(トークン/スマホ)  
- 生体要素(指紋/顔認証)  

## ■ チャレンジレスポンス認証  

固定パスワードの送信を避けるため、サーバはチャレンジ(乱数)を提示し、クライアントは秘密鍵やハッシュで応答を生成する方式です。  
S/KEY はこの系譜に属します。  

## ■ ハッシュ関数の選定  

現在の実装では SHA-256 など安全なハッシュが推奨されます。  
