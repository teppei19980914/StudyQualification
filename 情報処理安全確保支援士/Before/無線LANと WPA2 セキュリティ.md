# 無線LANと WPA2 セキュリティ

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[平成25年秋期試験問題　午前Ⅱ 問4](https://www.sc-siken.com/kakomon/26_aki/am2_25.html)  
[情報セキュリティスペシャリスト平成28年春期 午前Ⅱ 問18](https://www.sc-siken.com/kakomon/28_haru/am2_18.html)  

## 無線LANの基本

### 無線LANとは  

無線LAN(Wireless LAN)は、**電波を用いて端末同士/端末とアクセスポイント(AP)を接続するLAN技術**です。  
代表的な規格は IEEE 802.11 系列です。  

- 802.11a/b/g/n/ac/ax … 物理層/データリンク層の規格(周波数帯/変調方式/最大スループットなど)
- 2.4GHz/5GHz/6GHz 帯を利用(国/規制に依存) 

### SSID(Service Set Identifier)

無線LANにおいて「混信」を避けるためにアクセスポイントと端末に設定するネットワーク識別子です。  
SSIDには最長32文字の任意の文字列を設定します。  

#### 必要となった経緯

通信を行う端末とスイッチがコードで接続されている有線LANと異なり、無線LANでは1つの端末が複数のアクセスポイントと通信できてしまう「混信状態」が発生し得ます。  
これを回避するため、無線LANではアクセスポイントと端末にそれぞれSSIDを設定し、SSIDが一致する機器同士しか通信ができないようにアクセス制御を行っています。  

### 無線LANが有線LANより難しい理由(セキュリティ面)

- 電波が**空間に漏れる**(壁/窓の外にも届く)  
- 盗聴/なりすまし/不正アクセスポイント(偽AP)が容易  
- パケットが**物理的に流出**しやすく、暗号化と認証が必須

そのため、無線LANでは **暗号化(Confidentiality)/完全性保護(Integrity)/認証(Authentication)** がセットで問われます。  

## 無線LANセキュリティの変遷(WEP → WPA → WPA2 → WPA3)

### WEP(Wired Equivalent Privacy)

- 802.11 初期の標準で導入された暗号化方式
- RC4 ストリーム暗号＋ 24bit IV(初期化ベクトル)
- 主な問題点：
  - IV が短く再利用されやすい → キーストリーム再利用 → 暗号解読が容易
  - 鍵管理が貧弱(共有鍵/固定鍵)
  - CRC32 による完全性保護が暗号的に弱い

現在は**完全に使用非推奨**です。  

### WPA(Wi‑Fi Protected Access)

WEP の脆弱性が顕在化したのち、**暫定対策**として Wi‑Fi Alliance が策定した方式です。  
現在は WPA2 以降に移行が推奨されています。  

- 暗号：TKIP(Temporal Key Integrity Protocol)
- 既存ハードウェアでのファーム更新を想定した「過渡期の方式」

### WPA2(本資料のメイン)

- IEEE 802.11i をベースにした**正式な強固セキュリティ方式**
- 暗号：AES‑CCMP(Counter Mode with CBC‑MAC)を必須
- キーワード：**RSN(Robust Security Network)**

### WPA3(参考)

- 2018頃から導入された新世代方式
- SAE(Simultaneous Authentication of Equals)によるパスワード認証強化
- オフライン総当たり攻撃への耐性向上

## WPA2 の方式と構成要素

WPA2 は主に以下を組み合わせて構成されています。  

1. **利用者認証／ネットワーク認証**(誰が接続できるか)  
2. **鍵交換(4-way ハンドシェイク)**  
3. **トラフィック暗号化(AES‑CCMP)**

### WPA2‑Personal(WPA2‑PSK)

- 共有パスフレーズ(Pre‑Shared Key)を全クライアントで共用
- 家庭/小規模オフィス向け
- PSK から PMK(Pairwise Master Key)を導出し、そこから PTK を生成

#### 注意点

- パスフレーズが短い／単純だと **辞書攻撃/総当たり攻撃** に脆弱
- 共有鍵なので、1人でも漏洩すると全利用者に影響

### WPA2‑Enterprise(802.1X/EAP)

- 企業環境向けの強固な方式  
- 802.1X(ポートベース認証)＋ RADIUS サーバを利用  
- 各ユーザごとに認証/鍵生成が行われる

#### 主な構成要素

- サプリカント(Supplicant)：端末(クライアント)
- オーセンティケータ(Authenticator)：AP(スイッチ)
- 認証サーバ(Authentication Server)：RADIUS サーバ

#### 利用される EAP 方式の例

- EAP‑TLS(クライアント証明書認証)
- PEAP(TLS トンネル＋内部で MS‑CHAPv2 など)

## 4-way ハンドシェイクの概要(IEEE 802.11i)

WPA2 では、AP と端末が共有している PMK(Pairwise Master Key)から、実際にパケット暗号化に使う PTK を生成するため、**4-way ハンドシェイク** を行います。

### ステップ概要

1. **Message 1**：AP → STA  
   - ランダム値 ANonce を送信

2. **Message 2**：STA → AP  
   - 端末側で SNonce を生成  
   - PMK, ANonce, SNonce, MACアドレス から PTK を計算  
   - SNonce と MIC を AP に送信

3. **Message 3**：AP → STA  
   - AP 側でも PTK を計算し、MIC を検証  
   - その後、暗号化鍵(GTK など)を送信

4. **Message 4**：STA → AP  
   - 受信確認(ACK)を返し、セッション確立

このハンドシェイクが正しく完了した後に、実際のデータフレームが AES‑CCMP で暗号化されます。

## AES‑CCMP による暗号化/完全性保護

### CCMP とは

WEP のような RC4＋CRC32 に比べて、暗号強度/完全性ともに大幅に強化されています。  

- Counter Mode with CBC‑MAC
- 暗号化：AES カウンターモード
- 完全性保護：CBC‑MAC によるメッセージ認証

### 保護される範囲

- データフレームのペイロード部分
- 一部ヘッダの保護(完全なヘッダ保護は行われない点にも注意)

## WPA2 の代表的な脅威と対策

### 弱い PSK に対するオフライン辞書攻撃

攻撃者が 4‑way ハンドシェイクをキャプチャすると、  
PSK に対する辞書攻撃/総当たり攻撃が可能となる。

#### 対策

- 長く複雑なパスフレーズ(20文字以上推奨)
- 乱数パスフレーズ＋パスワードマネージャの利用
- 可能な場合は WPA2‑Enterprise への移行

### KRACK 攻撃(Key Reinstallation Attack)

- WPA2 の 4‑way ハンドシェイク実装の脆弱性を突く攻撃
- 同じ鍵を再インストールさせることで nonce を再使用させ、暗号解析可能にする

#### 対策

- OS/無線LANドライバ/ファームウェアのアップデート
- AP／クライアント双方でパッチ適用

### 不正アクセスポイント(Rogue AP)/Evil Twin

- 正規 AP と同じ SSID を名乗る偽アクセスポイント
- 利用者を騙して接続させ、トラフィックを盗聴/改ざん

#### 対策

- 企業内では 802.1X＋証明書を使用
- 管理されていない AP を検出する WIPS/WIDS の利用
- 利用者教育(無料Wi‑Fiのリスク周知)

## 無線LANの周辺知識(試験頻出要素)

### SSID とステルスSSID

- SSID はネットワーク識別子であり、「非公開(ステルス)」設定も可能
- ただしビーコンを止めても、接続フレームなどから SSID は容易に推測できるため、**セキュリティ対策とはみなされない**

### MACアドレスフィルタリング

- AP 側に許可 MAC アドレス一覧を設定する方式
- しかし MACアドレスは容易に偽装できるため、**補助的な対策**に留まる

### 802.1X 認証との関係

- 有線LANでも利用されるポートベース認証技術  
- 無線LANに適用すると **WPA2‑Enterprise** 構成となる
- 認証後にダイナミック VLAN 割当なども可能

### WPA3 で追加されたポイント(参考)

- SAE による PSK 認証強化
- OWE(Opportunistic Wireless Encryption)によるオープンネットワーク暗号化
- 旧端末との後方互換性の課題あり
