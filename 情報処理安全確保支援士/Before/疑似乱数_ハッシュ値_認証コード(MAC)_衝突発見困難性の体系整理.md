# 疑似乱数/ハッシュ値/認証コード(MAC)/衝突発見困難性の体系整理

## はじめに

2025年10月のプロジェクトマネージャ試験受験を終え、2026年春の情報処理安全確保支援士に向けて勉強中です。  
本記事を含めた各知識のインデックスや学習の道のりについては、「[情報処理安全確保支援士への道のり(随時更新中)](https://qiita.com/teppei19980914/items/6411cb70f2937cbefdcc)」をご参照ください。  
**本記事は学習した内容を記載しています。**  

## 該当問題

[情報セキュリティスペシャリスト平成28年春期 午前Ⅱ 問9](https://www.sc-siken.com/kakomon/28_haru/am2_9.html)  
[情報処理安全確保支援士平成29年秋期 午前Ⅱ 問4](https://www.sc-siken.com/kakomon/29_aki/am2_4.html)  

## 2. 疑似乱数(PRNG：Pseudo Random Number Generator)

疑似乱数とは **決定論的アルゴリズムによって生成される乱数列** のことです。  
種(Seed)が同じであれば同じ乱数列を生成します。  

### 2.1 PRNG の分類(エビデンス：NIST SP 800-90A Rev.1)

#### ■ 非暗号学的 PRNG  

例：LCG, Mersenne Twister  

- 予測されやすい  
- 統計的には良いが、暗号用途では不適  
- 内部状態が露呈すると将来の値が推測可能  

#### ■ 暗号学的 PRNG(CSPRNG)  

例：Hash_DRBG, HMAC_DRBG, CTR_DRBG  

- 出力から内部状態が推測不能  
- Forward/Backward secrecy を満たす  
- 鍵、Nonce、IV生成に必須  

## 3. 暗号学的ハッシュ関数(NIST FIPS 180-4)

暗号学的ハッシュ関数は **任意長のデータを固定長に圧縮する一方向関数** です。  

### 3.1 暗号学的性質(3要件)

| 名称 | 意味 | 説明 |
|------|------|------|
| **原像困難性** | h = H(x) から x を求めるのが困難 | 2^n の計算量 |
| **第二原像困難性** | 同じハッシュ値を与える別の入力 x' を見つけるのが困難 | 2^n の計算量 |
| **衝突困難性(衝突発見困難性)** | 異なる x, x' で H(x)=H(x') を見つけるのが困難 | 2^(n/2) の計算量 |

## 4. 衝突発見困難性(Collision Resistance)

衝突発見困難性とは、**異なる2つの入力が同じハッシュ値になる衝突を見つけることが困難である性質**のことです。  

### 4.1 なぜ「2^(n/2)」になるのか(誕生日攻撃)

- 衝突探索問題は「誕生日のパラドックス」に基づく  
- n ビットのハッシュ値の衝突発見計算量は **2^(n/2)**  
- 例：SHA-256 → **2^128** の計算量  

### 4.2 SHA-1 が廃止された理由

Google による **SHAttered(2017)** で実際に衝突が生成されたためです。  

衝突実現は以下を可能にする危険があります。  

- 電子署名の改ざん  
- 証明書偽装  
- ファイルの完全性破壊  

## 5. ハッシュ関数の代表例

| アルゴリズム | 規格 | 安全性 |
|--------------|------|--------|
| SHA-1 | FIPS 180-4 | 衝突実証済みで非推奨 |
| SHA-2(SHA-256/512) | FIPS 180-4 | 現行の標準 |
| SHA-3 | FIPS 202 | Keccakベース |

## 6. MAC(Message Authentication Code)

MACは **メッセージの改ざん検知 + 送信元認証** を提供します。  

### 6.1 HMAC(RFC 2104)

- ハッシュ関数 + 秘密鍵  
- SHA-256 などを利用  
- TLS, IPsec などで標準使用  

### 6.2 CMAC(NIST SP 800-38B)

- AES などのブロック暗号を利用  
- 高速でハードウェア実装に向く  

### 6.3 UMAC/VMAC

- 大量データ処理向け高速MAC  

## 7. PRNG/ハッシュ/MAC の関係性

| 技術 | 関係 |
|------|------|
| PRNG | MACの鍵/Nonce/IV生成に使用 |
| ハッシュ関数 | HMACやデジタル署名の基盤となる |
| MAC | 改ざん防止と送信元認証を提供 |

## 8. 周辺知識(試験頻出)

### ● KDF(Key Derivation Function)

PBKDF2/HKDF/Argon2  
弱いパスワードから安全な鍵を導出します。  

### ● Nonce(Number used once)

チャレンジレスポンス、暗号モードで再利用が禁止されています。  

### ● MAC とデジタル署名の比較

| 項目 | MAC | デジタル署名 |
|------|------|--------------|
| 鍵 | 共通鍵 | 公開鍵/秘密鍵 |
| 機能 | 改ざん検知/送信元認証 | 否認防止/改ざん検知 |
| 代表方式 | HMAC, CMAC | RSA, ECDSA |
